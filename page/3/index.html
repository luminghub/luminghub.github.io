<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Shell编程基础" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/24/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" class="article-date">
  <time class="dt-published" datetime="2017-05-23T16:00:00.000Z" itemprop="datePublished">2017-05-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/24/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/">Shell编程基础</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Shell编程基础"><a href="#Shell编程基础" class="headerlink" title="Shell编程基础"></a>Shell编程基础</h2><p><a target="_blank" rel="noopener" href="http://wiki.ubuntu.org.cn/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80">更多详细信息</a></p>
<p><a target="_blank" rel="noopener" href="http://www.linuxplus.org/kb/">高级进阶</a></p>
<p><a target="_blank" rel="noopener" href="http://www.linuxplus.org/kb/cmdindex.html">编程参考</a></p>
<h3 id="从第一行开始"><a href="#从第一行开始" class="headerlink" title="从第一行开始"></a>从第一行开始</h3><p>我们可以使用任意一种文字编辑器，比如gedit、kedit、emacs、vi等来编写shell脚本，它必须以如下行开始（必须放在文件的第一行）：</p>
<pre><code>#!/bin/bash
</code></pre>
<p>此行称为 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/shebang">shebang</a>（就是 sharp (#) + bang (!) 的意思），会指引操作系统使用接下来指定的程序运行此文件。此处 <code>/bin/bash</code> 执行我们的文件。<br>一些人使用 <code>#!/bin/sh</code> 来让 <code>sh</code> 执行文件，按照习惯这表示任何支持 <a target="_blank" rel="noopener" href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html">POSIX shell</a> 命令语言的 <code>sh</code> 程序。为了用上我们所喜欢的 <code>bash</code> 拓展语法功能，我们就不这么用了。如果你使用别的脚本，例如 <code>/bin/tcsh</code>，照着样子加个 <code>#!</code> 就行。</p>
<hr>
<p>编辑结束并保存后，如果直接要执行该脚本，必须先使其具有可执行属性：</p>
<pre><code>chmod +x filename
</code></pre>
<p>此后在该脚本所在目录下，输入 <code>./filename&lt;tt&gt;</code> 即可执行该脚本。</p>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>Shell 变量默认全都是字符串。</p>
<h3 id="变量赋值和引用"><a href="#变量赋值和引用" class="headerlink" title="变量赋值和引用"></a>变量赋值和引用</h3><p>Shell 编程中，使用变量无需事先声明。变量名的命名遵守正则表达式 <code>&lt;tt&gt;[a-zA-Z_][a-zA-Z0-9_]+</code>，也就是由大小写字母数字和下划线组成，且不能以数字开头。请注意 shell 环境中的确有以数字和特殊符号开头的变量名，但是那些东西不可以用接下来的方式赋值。</p>
<p>需要给变量赋值时，可以这么写：</p>
<pre><code>varname=值 [var2=val2 ....]
</code></pre>
<p>请注意这边等号左右不能有空格。 要取用一个变量的值，只需在变量名前面加一个 $：</p>
<pre><code># assign
a=&quot;hello world&quot;  # 等号两边均不能有空格存在
# print
printf &#39;%s\n&#39; &quot;A is: $a&quot;
</code></pre>
<p>挑个自己喜欢的编辑器，输入上述内容，并保存为文件 first，然后执行 chmod +x first 使其可执行，最后输入 .&#x2F;first 执行该脚本。其输出结果如下：</p>
<pre><code>A is: hello world
</code></pre>
<p>有时候变量名可能会和其它文字（匹配最长的符合变量名或特殊变量名要求的内容）混淆，比如：</p>
<pre><code>num=2
echo &quot;this is the $numnd&quot;   # 输出 this is the       — shell 尝试寻找 $numnd 的值
echo &quot;this is the $&#123;num&#125;nd&quot; # 输出 this is the 2nd   — 修好了！
# 花括号可以隔开变量名，但是放歪了的话…
echo &quot;this is the &#123;$num&#125;nd&quot; # 输出 this is the &#123;2&#125;nd — 切是切开了，但是…
</code></pre>
<h3 id="变量算术"><a href="#变量算术" class="headerlink" title="变量算术"></a>变量算术</h3><p>Shell 变量默认都是字符串。这也就是说，你尝试这么做，肯定没用：</p>
<pre><code>var=1
var=$var+1
echo $var # 输出 1+1
</code></pre>
<p>我们可以用很多方法达成我们的目标。首先是好孩子的方法——C 风格表达式。</p>
<pre><code>var=0
# bash 里面可以用 (( )) 执行 C 风格的算术表达式。
# 如果你接下来还会读 if 那一段的话，你还会知道这玩意的返回和 C 的非零真假判断一致。
(( var += 1 )) # 这是一种，现在 var 是 1
(( var++ ))    # 这也是一种自增，2
(( var = var * var )) # 怎么来乘法了！var 现在是 4。
let &#39;var = var / 3&#39;   # 还是只有 bash 才能用的拓展。除法是整数除法，向 0 舍入，1。
# 来一点不一定要 bash 的方法吧，毕竟 sh 还有很多种，总不能全报错了吧。
# $(( )) 会展开成为这个 C 表达式求值的结果。以前 bash 有个 $[ ] 一样，但是别去用。
echo $((var += 2))    # echo 出 3，var 现在是 3。
var=$((var-1))        # 展开成 var=2，var 现在是……还用说吗，2。
</code></pre>
<p>以前还有人用 expr 之类的外部程序来，不过这属于杀鸡用牛刀。并且调用外部程序浪费时间性能差。</p>
<pre><code>var=1
var=$(expr &quot;$var&quot; + 1) # expr 收到三个参数 &#39;1&#39; &#39;+&#39; &#39;1&#39;，

                      # 按照 expr --help 里面写的方法运行
                      # 然后输出替换掉 $() 这里变成 var=2。

var=`expr &quot;$var&quot; + 1`  # 前面一行的老写法，千万千万不要学。
</code></pre>
<h3 id="Shell里的流程控制"><a href="#Shell里的流程控制" class="headerlink" title="Shell里的流程控制"></a>Shell里的流程控制</h3><h4 id="if-语句"><a href="#if-语句" class="headerlink" title="if 语句"></a>if 语句</h4><p>if 表达式如果条件命令组为真，则执行 then 后的部分。标准形式：</p>
<pre><code>if 
  判断命令，可以有很多个，真假取最后的返回值
then
  如果前述为真做什么
[ # 方括号代表可选，别真打进去了！
elif
  可以再来个判断，如果签名为假继续尝试这里
then
  如果前述为真做什么 ]
else
  如果全都不行做什么
fi # 结束，就是倒写的 if 啦。
</code></pre>
<p>现实生活中一般判断只有一个命令，所以你看到的一般是：</p>
<pre><code>if ....; then # 你也可以写成 if 之后换行，这样就不用分号了。
  ....
fi
</code></pre>
<p>大多数情况下，可以使用测试命令来对条件进行测试，比如可以比较字符串、判断文件是否存在及是否可读等等……在 bash 中一般采用更好用的 … 语法进行条件测试，而通用方法是 [ … ]<tt>（相当于 <tt>test …）。两者都接纳的常用测试语句有：</p>
<pre><code>-f &quot;filename&quot;
判断是否是一个文件
-x &quot;/bin/ls&quot;
判断/bin/ls是否存在并有可执行权限
-n &quot;$var&quot;
判断 $var 变量是否有值
&quot;$a&quot; == &quot;$b&quot;
判断$a和$b是否相等
</code></pre>
<p>前者可以使用 help [[ 查询用法，后者使用 help [ (bash) 或 man test 查询。下面的语句用到了这个内容：</p>
<pre><code>if [ &quot;$&#123;SHELL&#125;&quot; == &quot;/bin/bash&quot; ]; then
  echo &quot;your login shell is the bash (bourne again shell)&quot;
else
  echo &quot;your login shell is not bash but $&#123;SHELL&#125;&quot;
fi
</code></pre>
<p>变量 $SHELL 包含有登录shell的名称，我们拿它和 &#x2F;bin&#x2F;bash 进行比较以判断当前使用的shell是否为bash。你可能会问了，要是 bash 路径不是这个呢？</p>
<h4 id="和-操作符"><a href="#和-操作符" class="headerlink" title="&amp;&amp; 和 || 操作符"></a>&amp;&amp; 和 || 操作符</h4><p>熟悉C语言的朋友可能会喜欢下面的表达式：</p>
<pre><code>[ -f &quot;/etc/shadow&quot; ] &amp;&amp; echo &quot;This computer uses shadow passwords&quot;
</code></pre>
<p>这里的 &amp;&amp; 就是一个快捷操作符，如果左边的表达式为真（返回 0——“成功”）则执行右边的语句，你也可以把它看作逻辑运算里的与操作。上述脚本表示如果&#x2F;etc&#x2F;shadow文件存在，则打印“This computer uses shadow passwords”。</p>
<p>同样shell编程中还可以用或操作 (||)，例如</p>
<pre><code>#!/bin/bash

mailfolder=/var/spool/mail/james
[ -r &quot;$mailfolder&quot; ] || &#123; echo &quot;Can not read $mailfolder&quot;; exit 1; &#125;
echo &quot;$mailfolder has mail from:&quot;
grep &quot;^From &quot; $mailfolder
</code></pre>
<p>该脚本首先判断mailfolder是否可读，如果可读则打印该文件中以”From”开头的行。如果不可读则或操作生效，打印错误信息后脚本退出。需要注意的是，这里我们必须使用如下两个命令：</p>
<pre><code>&#123;
  echo &quot;Can not read $mailfolder&quot;; # 打印错误信息
  exit 1; # 退出程序
&#125;
</code></pre>
<p>我们使用花括号以组合命令的形式将两个命令放到一起作为一个命令使用。即使不用与和或操作符，我们也可以用if表达式完成任何事情，但是使用与或操作符会更便利很多。<br>要注意 Shell 中的 &amp;&amp; || 程序流操作符不表现任何优先级区别，完全是先看到谁就先处理谁的关系。</p>
<h4 id="case-语句"><a href="#case-语句" class="headerlink" title="case 语句"></a>case 语句</h4><p>case表达式可以用来匹配一个给定的字符串，而不是数字（可别和C语言里的switch…case混淆）。</p>
<pre><code>case ... in
   ...) do something here 
   ;;
esac
</code></pre>
<p>file命令可以辨别出一个给定文件的文件类型，如：file lf.gz，其输出结果为：</p>
<pre><code>lf.gz: gzip compressed data, deflated, original filename,
last modified: Mon Aug 27 23:09:18 2001, os: Unix
</code></pre>
<p>我们利用这点写了一个名为smartzip的脚本，该脚本可以自动解压bzip2, gzip和zip 类型的压缩文件：</p>
<pre><code>#!/bin/bash

ftype=&quot;$(file &quot;$1&quot;)&quot;
case &quot;$ftype&quot; in
&quot;$1: Zip archive&quot;*) #正则表达式，匹配前缀
   unzip &quot;$1&quot; ;;
&quot;$1: gzip compressed&quot;*)
   gunzip &quot;$1&quot; ;;
&quot;$1: bzip2 compressed&quot;*)
   bunzip2 &quot;$1&quot; ;;
*)
   echo &quot;File $1 can not be uncompressed with smartzip&quot;;;
esac
</code></pre>
<p>你可能注意到上面使用了一个特殊变量 $1，该变量包含有传递给该脚本的第一个参数值。也就是说，当我们运行：</p>
<pre><code>smartzip articles.zip
</code></pre>
<p>$1 就是字符串 articles.zip。</p>
<h4 id="select-循环语句"><a href="#select-循环语句" class="headerlink" title="select 循环语句"></a>select 循环语句</h4><p>select 循环语句是bash的一种扩展应用，擅长于交互式场合。</p>
<p>用户可以从一组不同的值中进行选择：</p>
<pre><code>#!/bin/bash

pocket=()
select var in &quot;跳跳糖&quot; &quot;糖&quot; &quot;很多糖&quot; &quot;企鹅糖&quot;; do
  echo &quot;除了 $var 还要什么吗？&quot;
  if ((RANDOM%4 == 0)); then
    echo &quot;呀！时间不够了，快上车！&quot;
    break # break 还是那个 break
  fi
  pocket+=(&quot;$var&quot;)
done
echo &quot;你最后说的那个 $var 弄丢了……&quot;
IFS=&#39;、&#39;
echo &quot;现在口袋里只有：$&#123;pocket[*]&#125;。&quot;
IFS=$&#39; \t\n&#39;
</code></pre>
<p>下面是一个简单的示例：</p>
<pre><code>#!/bin/bash

echo &quot;What is your favourite OS?&quot;
select var in &quot;Linux&quot; &quot;Gnu Hurd&quot; &quot;Free BSD&quot; &quot;Other&quot;; do
  break;
done
echo &quot;You have selected $var&quot;
</code></pre>
<p>该脚本的运行结果如下：</p>
<pre><code>What is your favourite OS?
1) Linux
2) Gnu Hurd
3) Free BSD
4) Other
#? 1
You have selected Linux
</code></pre>
<h4 id="while-for-循环"><a href="#while-for-循环" class="headerlink" title="while&#x2F;for 循环"></a>while&#x2F;for 循环</h4><p>在shell中，可以使用如下循环：</p>
<pre><code>while ...; do
   ....
done
</code></pre>
<p>只要测试表达式条件为真，则while循环将一直运行。关键字”break”用来跳出循环，而关键字”continue”则可以跳过一个循环的余下部分，直接跳到下一次循环中。</p>
<p>for循环会查看一个字符串列表（字符串用空格分隔），并将其赋给一个变量：</p>
<pre><code>for var in ....; do
   ....
done
</code></pre>
<p>下面的示例会把A B C分别打印到屏幕上：</p>
<pre><code>#!/bin/bash

for var in A B C ; do
   echo &quot;var is $var&quot;
done
</code></pre>
<p>下面是一个实用的脚本showrpm，其功能是打印一些RPM包的统计信息：</p>
<pre><code>#!/bin/bash

# list a content summary of a number of RPM packages
# USAGE: showrpm rpmfile1 rpmfile2 ...
# EXAMPLE: showrpm /cdrom/RedHat/RPMS/*.rpm
for rpmpackage in &quot;$@&quot;; do
   if [ -r &quot;$rpmpackage&quot; ];then
      echo &quot;=============== $rpmpackage ==============&quot;
      rpm -qi -p $rpmpackage
   else
      echo &quot;ERROR: cannot read file $rpmpackage&quot;
   fi
done
</code></pre>
<p>这里出现了第二个特殊变量$@，该变量包含有输入的所有命令行参数值。如果你运行showrpm openssh.rpm w3m.rpm webgrep.rpm，那么 “$@”(有引号) 就包含有 3 个字符串，即openssh.rpm, w3m.rpm和 webgrep.rpm。$*的意思是差不多的。但是只有一个字串。如果不加引号，带空格的参数会被截断。</p>
<h3 id="Shell里的一些特殊符号"><a href="#Shell里的一些特殊符号" class="headerlink" title="Shell里的一些特殊符号"></a>Shell里的一些特殊符号</h3><h4 id="引号"><a href="#引号" class="headerlink" title="引号"></a>引号</h4><p>在向程序传递任何参数之前，程序会扩展通配符和变量。这里所谓的扩展是指程序会把通配符（比如*）替换成适当的文件名，把变量替换成变量值。我们可以使用引号来防止这种扩展，先来看一个例子，假设在当前目录下有两个jpg文件：mail.jpg和tux.jpg。</p>
<pre><code>#!/bin/bash

echo *.jpg   # =&gt; mail.jpg tux.jpg
</code></pre>
<p>引号（单引号和双引号）可以防止通配符*的扩展：</p>
<pre><code>#!/bin/bash

echo &quot;*.jpg&quot;  # =&gt; *.jpg
echo &#39;*.jpg&#39;  # =&gt; *.jpg
</code></pre>
<p>其中单引号更严格一些，它可以防止任何变量扩展；而双引号可以防止通配符扩展但允许变量扩展：</p>
<pre><code>#!/bin/bash

echo $SHELL   # =&gt; /bin/bash
echo &quot;$SHELL&quot; # =&gt; /bin/bash
echo &#39;$SHELL&#39; # =&gt; $SHELL
</code></pre>
<p>此外还有一种防止这种扩展的方法，即使用转义字符——反斜杠\：</p>
<pre><code>echo \*.jpg   # =&gt; *.jpg
echo \$SHELL  # =&gt; $SHELL
</code></pre>
<h3 id="Here-Document"><a href="#Here-Document" class="headerlink" title="Here Document"></a>Here Document</h3><p>当要将几行文字传递给一个命令时，用here document是一种不错的方法。对每个脚本写一段帮助性的文字是很有用的，此时如果使用here document就不必用echo函数一行行输出。Here document以 &lt;&lt; 开头，后面接上一个字符串，这个字符串还必须出现在here document的末尾。下面是一个例子，在该例子中，我们对多个文件进行重命名，并且使用here document打印帮助：</p>
<pre><code>#!/bin/bash

# we have less than 3 arguments. Print the help text:
if [ $# -lt 3 ] ;; then
cat &lt;&lt; HELP

ren -- renames a number of files using sed regular expressions USAGE: ren &#39;regexp&#39; &#39;replacement&#39; files...

EXAMPLE: rename all *.HTM files in *.html:
   ren &#39;HTM$&#39; &#39;html&#39; *.HTM

HELP                #这里HELP要顶格写，前面不能有空格或者TAB制表符。如果cat一行写成cat &amp;lt;&amp;lt; -HELP，前边可以带TAB.
   exit 0
fi
OLD=&quot;$1&quot;
NEW=&quot;$2&quot;
# The shift command removes one argument from the list of
# command line arguments.
shift
shift
# $@ contains now all the files:
for file in &quot;$@&quot;; do
   if [ -f &quot;$file&quot; ]&amp;nbsp;; then
      newfile=`echo &quot;$file&quot; | sed &quot;s/$&#123;OLD&#125;/$&#123;NEW&#125;/g&quot;`
      if [ -f &quot;$newfile&quot; ]; then
　　　　   echo &quot;ERROR: $newfile exists already&quot;
      else
         echo &quot;renaming $file to $newfile ...&quot;
         mv &quot;$file&quot; &quot;$newfile&quot;
      fi
   fi
done
</code></pre>
<p>示例有点复杂，我们需要多花点时间来说明一番。第一个if表达式判断输入命令行参数是否小于3个 (特殊变量$# 表示包含参数的个数) 。如果输入参数小于3个，则将帮助文字传递给cat命令，然后由cat命令将其打印在屏幕上。打印帮助文字后程序退出。如果输入参数等于或大于3个，我们就将第一个参数赋值给变量OLD，第二个参数赋值给变量NEW。下一步，我们使用shift命令将第一个和第二个参数从参数列表中删除，这样原来的第三个参数就成为参数列表$*的第一个参数。然后我们开始循环，命令行参数列表被一个接一个地被赋值给变量$file。接着我们判断该文件是否存在，如果存在则通过sed命令搜索和替换来产生新的文件名。然后将反短斜线内命令结果赋值给newfile。这样我们就达到了目的：得到了旧文件名和新文件名。然后使用 mv命令进行重命名。</p>
<h3 id="Shell里的函数"><a href="#Shell里的函数" class="headerlink" title="Shell里的函数"></a>Shell里的函数</h3><p>如果你写过比较复杂的脚本，就会发现可能在几个地方使用了相同的代码，这时如果用上函数，会方便很多。函数的大致样子如下：</p>
<pre><code># 别笑，bash 里面函数名的确可以这样……
# (POSIX sh 函数名倒是和变量名要求差不多)
我是一个函数() &#123;
  # 函数里面 $1 $2 对应函数所接受到的第一、第二……个参数。
  这里有很多命令
&#125;
</code></pre>
<p>函数没有必要声明。只要在执行之前出现定义就行</p>
<p>下面是一个名为xtitlebar的脚本，它可以改变终端窗口的名称。这里使用了一个名为help的函数，该函数在脚本中使用了两次：</p>
<pre><code>#!/bin/bash

help()
&#123;
cat &lt;&lt; HELP
xtitlebar -- change the name of an xterm, gnome-terminal or kde konsole
USAGE: xtitlebar [-h] &quot;string_for_titelbar&quot;
OPTIONS: -h help text
EXAMPLE: xtitlebar &quot;cvs&quot;
HELP
exit 0
&#125;
# in case of error or if -h is given we call the function help:
if [[ $1 == &#39;&#39; || $1 == &#39;-h&#39; ]]; then
  help
fi
# send the escape sequence to change the xterm titelbar:
echo -e &quot;\033]0;$1\007&quot;
#
</code></pre>
<p>在脚本中提供帮助是一种很好的编程习惯，可以方便其他用户（和自己）使用和理解脚本。</p>
<h3 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h3><p>我们已经见过 $* 和 $1, $2 … $9 等特殊变量，这些特殊变量包含了用户从命令行输入的参数。迄今为止，我们仅仅了解了一些简单的命令行语法（比如一些强制性的参数和查看帮助的-h选项）。但是在编写更复杂的程序时，您可能会发现您需要更多的自定义的选项。通常的惯例是在所有可选的参数之前加一个减号，后面再加上参数值 (比如文件名)。</p>
<p>有好多方法可以实现对输入参数的分析，但是下面的使用case表达式的例子无疑是一个不错的方法。</p>
<pre><code>#!/bin/bash
 
help()
&#123;
   cat &amp;lt;&amp;lt; HELP
   This is a generic command line parser demo.
   USAGE EXAMPLE: cmdparser -l hello -f -- -somefile1 somefile2
HELP
   exit 0
&#125;
  
while [ -n &quot;$1&quot; ]; do
case &quot;$1&quot; in
   -h) help;shift 1;; # function help is called
   -f) opt_f=1;shift 1;; # variable opt_f is set
   -l) opt_l=$2;shift 2;; # -l takes an argument -&amp;gt; shift by 2
   --) shift;break;; # end of options
   -*) echo &quot;error: no such option $1. -h for help&quot;;exit 1;;
   *) break;;
esac
done
 
echo &quot;opt_f is $opt_f&quot;
echo &quot;opt_l is $opt_l&quot;
echo &quot;first arg is $1&quot;
echo &quot;2nd arg is $2&quot;
</code></pre>
<p>你可以这样运行该脚本：</p>
<pre><code>cmdparser -l hello -f -- -somefile1 somefile2
</code></pre>
<p>返回结果如下：</p>
<pre><code>opt_f is 1
opt_l is hello
first arg is -somefile1
2nd arg is somefile2
</code></pre>
<p>这个脚本是如何工作的呢？脚本首先在所有输入命令行参数中进行循环，将输入参数与case表达式进行比较，如果匹配则设置一个变量并且移除该参数。根据unix系统的惯例，首先输入的应该是包含减号的参数。</p>
<h3 id="Shell脚本示例"><a href="#Shell脚本示例" class="headerlink" title="Shell脚本示例"></a>Shell脚本示例</h3><h4 id="一般编程步骤"><a href="#一般编程步骤" class="headerlink" title="一般编程步骤"></a>一般编程步骤</h4><p>现在我们来讨论编写一个脚本的一般步骤。任何优秀的脚本都应该具有帮助和输入参数。写一个框架脚本（framework.sh），该脚本包含了大多数脚本需要的框架结构，是一个非常不错的主意。这样一来，当我们开始编写新脚本时，可以先执行如下命令：</p>
<pre><code>cp framework.sh myscript
</code></pre>
<p>然后再插入自己的函数。</p>
<p>让我们来看看如下两个示例。</p>
<h4 id="二进制到十进制的转换"><a href="#二进制到十进制的转换" class="headerlink" title="二进制到十进制的转换"></a>二进制到十进制的转换</h4><p>脚本 b2d 将二进制数 (比如 1101) 转换为相应的十进制数。这也是一个用expr命令进行数学运算的例子：</p>
<pre><code>#!/bin/bash
# vim: set sw=4 ts=4 et:
help()
&#123;
   cat &lt;&lt; HELP
   
b2d -- convert binary to decimal
 
USAGE: b2d [-h] binarynum
 
OPTIONS: -h help text
 
EXAMPLE: b2d 111010
will return 58
HELP
   exit 0
&#125;
 
error()
&#123;
   # print an error and exit
   echo &quot;$1&quot;
   exit 1
&#125;
 
lastchar()
&#123;
   # return the last character of a string in $rval
   if [ -z &quot;$1&quot; ]; then
      # empty string
      rval=&quot;&quot;
      return
   fi
   # wc puts some space behind the output this is why we need sed:
   numofchar=`echo -n &quot;$1&quot; | sed &#39;s/ //g&#39; | wc -c ` 
   #sed &#39;s/ //g&#39;  所有空白去掉  sed &#39;s/ /\t/g&#39; 所有空白用t代替
   # now cut out the last char  抓取第numofchar个字节
   rval=`echo -n &quot;$1&quot; | cut -b $numofchar`
&#125;
 
chop()
&#123;
   # remove the last character in string and return it in $rval
   if [ -z &quot;$1&quot; ]; then
      # empty string
      rval=&quot;&quot;
      return
   fi
   # wc puts some space behind the output this is why we need sed:
   numofchar=`echo -n &quot;$1&quot; | wc -c | sed &#39;s/ //g&#39; `
   if [ &quot;$numofchar&quot; = &quot;1&quot; ]; then
      # only one char in string
      rval=&quot;&quot;
      return
   fi
   numofcharminus1=`expr $numofchar &quot;-&quot; 1`
   # now cut all but the last char:
   rval=`echo -n &quot;$1&quot; | cut -b -$numofcharminus1` 
   #原来的 rval=`echo -n &quot;$1&quot; | cut -b 0-$&#123;numofcharminus1&#125;`运行时出错.
   #原因是cut从1开始计数，应该是cut -b 1-$&#123;numofcharminus1&#125;
&#125;
 
while [ -n &quot;$1&quot; ]; do
case $1 in
   -h) help;shift 1;; # function help is called
   --) shift;break;; # end of options
   -*) error &quot;error: no such option $1. -h for help&quot;;;
   *) break;;
esac
done

# The main program
sum=0
weight=1
# one arg must be given:
[ -z &quot;$1&quot; ] &amp;amp;&amp;amp; help
binnum=&quot;$1&quot;
binnumorig=&quot;$1&quot;
 
while [ -n &quot;$binnum&quot; ]; do
   lastchar &quot;$binnum&quot;
   if [ &quot;$rval&quot; = &quot;1&quot; ]; then
      sum=`expr &quot;$weight&quot; &quot;+&quot; &quot;$sum&quot;` 
      # $expr 10 + 10    20 expr提示是计算操作
   fi
   # remove the last position in $binnum
   chop &quot;$binnum&quot;
   binnum=&quot;$rval&quot;
   weight=`expr &quot;$weight&quot; &quot;*&quot; 2`
done
 
echo &quot;binary $binnumorig is decimal $sum&quot;
#
</code></pre>
<p>该脚本使用的算法是利用十进制和二进制数权值 (1,2,4,8,16,..)，比如二进制”10”可以这样转换成十进制：</p>
<pre><code>0 * 1 + 1 * 2 = 2
</code></pre>
<p>为了得到单个的二进制数我们是用了lastchar 函数。该函数使用wc –c计算字符个数，然后使用cut命令取出末尾一个字符。Chop函数的功能则是移除最后一个字符。</p>
<p>但是还记得前面怎么说的吗？进制转换哪需要这么麻烦：</p>
<pre><code>#!/bin/bash
while read -p &#39;input a binary...&#39; num; do
  if [[ $num == *[!01]* ]]; then
    echo &quot;含有 0 1 之外的字符&quot;
  fi
  echo &quot;$((0x$num))&quot;      # 在 num 头上糊一个 0x 然后跑数学计算——就完事了！
  printf &quot;%d\n&quot; &quot;0x$num&quot;    # printf 也可以凑热闹啊
done
</code></pre>
<p>如果你喜欢自己算的话，其实也可以从左到右来（反正数学计算不要有事没事玩 expr 啦）：</p>
<pre><code>#!/bin/bash
# 人人皆知的 Horner 规则
value=0
echo &quot;写一堆 1 0 完了回车&quot;
while read -n 1 char; do
  case $char in
    (0|1) ;;      # 好
    (&#39;&#39;)  break;; # 没了
    (*)   echo &quot;你说啥？&quot;; break;;
  esac
  ((value *= 2))
  ((value += char))
done
echo &quot;$value&quot;
</code></pre>
<h4 id="文件循环移动"><a href="#文件循环移动" class="headerlink" title="文件循环移动"></a>文件循环移动</h4><p>你可能有这样的需求并一直都这么做：将所有发出邮件保存到一个文件中。但是过了几个月之后，这个文件可能会变得很大以至于该文件的访问速度变慢；下面的脚本 rotatefile 可以解决这个问题。这个脚本可以重命名邮件保存文件（假设为outmail）为outmail.1，而原来的outmail.1就变成了 outmail.2 等等…</p>
<pre><code>#!/bin/bash
# vim: set sw=4 ts=4 et:
 
ver=&quot;0.1&quot;
help()
&#123;
   cat &lt;&lt; HELP
   rotatefile -- rotate the file name
   USAGE: rotatefile [-h] filename
   OPTIONS: -h help text
   EXAMPLE: rotatefile out
 
   This will e.g rename out.2 to out.3, out.1 to out.2, out to out.1
   and create an empty out-file
 

   version $ver

HELP

   exit 0
&#125;

if [[ $1 == &#39;-h&#39; || $1 == &#39;&#39; ]]; then
  help
fi

filename=$1

# 我们先找到最大的数字再说。
max=0
while [ -f &quot;$filename.$((++max))&quot; ]; do
  : # 什么都不用做，我们已经顺手用 ++max 自增了 max 了。
done

# 然后从最大的一路重命名下来。
for ((i=max; i&gt;0; i--)); do
  # 数字加个 1，好给前一个让位子。
  mv &quot;$filename.$i&quot; &quot;$filename.$((i+1))&quot;
done
 
# 最后我们点名要重命名的：
if [ -f &quot;$filename&quot; ]; then
   mv &quot;$filename&quot; &quot;$filename.1&quot;
fi

# 重新创建一下。
: &gt; &quot;$filename&quot;　
</code></pre>
<h4 id="脚本调试"><a href="#脚本调试" class="headerlink" title="脚本调试"></a>脚本调试</h4><p>最简单的调试方法当然是使用echo命令。你可以在任何怀疑出错的地方用echo打印变量值，这也是大部分shell程序员花费80%的时间用于调试的原因。Shell脚本的好处在于无需重新编译，而插入一个echo命令也不需要多少时间。<br>shell也有一个真正的调试模式，如果脚本”strangescript”出错，可以使用如下命令进行调试：</p>
<pre><code>sh -x strangescript
</code></pre>
<p>上述命令会执行该脚本，同时显示所有变量的值。</p>
<p>shell还有一个不执行脚本只检查语法的模式，命令如下：</p>
<pre><code>sh -n your_script
</code></pre>
<p>这个命令会返回所有语法错误。</p>
<p>我们希望你现在已经可以开始编写自己的shell脚本了，尽情享受这份乐趣吧！ :)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/24/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/" data-id="cllui4qyr000gq0jad4yr30th" data-title="Shell编程基础" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-微服务开发与使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/22/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2017-05-21T16:00:00.000Z" itemprop="datePublished">2017-05-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/22/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E4%BD%BF%E7%94%A8/">微服务使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h2><p>Microservice架构模式就是将整个Web应用组织为一系列小的Web服务。这些小的Web服务可以独立地编译及部署，并通过各自暴露的API接口相互通讯。它们彼此相互协作，作为一个整体为用户提供功能，却可以独立地进行扩容。</p>
<h2 id="spring-cloud"><a href="#spring-cloud" class="headerlink" title="spring cloud"></a>spring cloud</h2><p>Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等。</p>
<h2 id="基础环境搭建"><a href="#基础环境搭建" class="headerlink" title="基础环境搭建"></a>基础环境搭建</h2><p>目前微服务基础环境由三部分组成，包括服务中心、配置中心和网关。</p>
<p>服务中心用来有效管理服务的注册信息；配置中心用来集中管理各服务的配置信息；网关统一向外系统提供REST API服务。</p>
<p>使用的Spring Boot版本为 1.5.2.RELEASE。</p>
<h3 id="服务中心-【Netflix-Eureka】"><a href="#服务中心-【Netflix-Eureka】" class="headerlink" title="服务中心 【Netflix Eureka】"></a>服务中心 【Netflix Eureka】</h3><p>服务注册与发现，用到的是Spring Cloud Netflix，主要内容是对Netflix公司一系列开源产品的包装，它为Spring Boot应用提供了自配置的Netflix OSS整合。通过一些简单的注解，开发者就可以快速的在应用中配置一下常用模块并构建庞大的分布式系统。它主要提供的模块包括：服务发现（Eureka），断路器（Hystrix），智能路由（Zuul），客户端负载均衡（Ribbon、Feign）等。</p>
<p>创建一个基础的Spring Boot工程，并在pom.xml中引入需要的依赖内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在的Spring Boot应用中添加<code>@EnableEurekaServer</code>注解启动服务注册中功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(Application.class).web(<span class="literal">true</span>).run(args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在默认设置下，该服务注册中心也会将自己作为客户端来尝试注册它自己，所以我们需要禁用它的客户端注册行为，在application.properties添加<code>ureka.client.register-with-eureka=false</code>和<code>eureka.client.fetch-registry=false</code>。完整的application.properties配置信息如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server<span class="selector-class">.port</span>=<span class="number">8081</span></span><br><span class="line">eureka<span class="selector-class">.client</span><span class="selector-class">.register-with-eureka</span>=false</span><br><span class="line">eureka<span class="selector-class">.client</span><span class="selector-class">.fetch-registry</span>=false</span><br><span class="line">eureka<span class="selector-class">.client</span><span class="selector-class">.serviceUrl</span><span class="selector-class">.defaultZone</span>=http://localhost:$&#123;server<span class="selector-class">.port</span>&#125;/eureka/</span><br></pre></td></tr></table></figure>

<p>启动后，服务中心地址<code>http://host:port/</code></p>
<h3 id="配置中心-【Spring-Cloud-Config】"><a href="#配置中心-【Spring-Cloud-Config】" class="headerlink" title="配置中心 【Spring Cloud Config】"></a>配置中心 【Spring Cloud Config】</h3><p>Spring Cloud Config为服务端和客户端提供了分布式系统的外部化配置支持。配置服务器为各应用的所有环境提供了一个中心化的外部配置。配置服务器默认采用git来存储配置信息，这里我们使用mongodb来存储配置信息<a target="_blank" rel="noopener" href="https://github.com/spring-cloud-incubator/spring-cloud-config-server-mongodb">(更多信息)</a>。</p>
<p>创建Config Server工程，在pom.xml中引入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建Spring Boot的程序主类，并添加<code>@EnableConfigServer</code>注解，开启Config Server</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(Application.class).web(<span class="literal">true</span>).run(args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>继承org.springframework.cloud.config.server.environment.EnvironmentRepository类，重写findOne方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Environment <span class="title function_">findOne</span><span class="params">(String application, String profile, String label)</span> &#123;</span><br><span class="line">  <span class="comment">//TODO </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="网关-【Netflix-Zuul】"><a href="#网关-【Netflix-Zuul】" class="headerlink" title="网关 【Netflix Zuul】"></a>网关 【Netflix Zuul】</h3><p>通过服务网关统一向外系统提供REST API的过程中，除了具备服务路由、均衡负载功能之外，它还具备了权限控制等功能。Spring Cloud Netflix中的Zuul就担任了这样的一个角色，为微服务架构提供了前门保护的作用，同时将权限控制这些较重的非业务逻辑内容迁移到服务路由层面，使得服务集群主体能够具备更高的可复用性和可测试性。</p>
<p>引入依赖spring-cloud-starter-zuul、spring-cloud-starter-eureka。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>应用主类使用<code>@EnableZuulProxy</code>注解开启Zuul</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="meta">@SpringCloudApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">   <span class="keyword">new</span> <span class="title class_">SpringApplicationBuilder</span>(Application.class).web(<span class="literal">true</span>).run(args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@SpringCloudApplication</code>注解整合了<code>@SpringBootApplication</code>、<code>@EnableDiscoveryClient</code>、<code>@EnableCircuitBreaker</code></p>
<p>配置zuul通过serviceId映射，将网关注册到服务中心。</p>
<pre><code>eureka.client.serviceUrl.defaultZone=http://host:port/eureka/
</code></pre>
<p>自定义过滤器，继承ZuulFilter，需要实现四个方法：</p>
<p>filterType：返回一个字符串代表过滤器的类型，在zuul中定义了四种不同生命周期的过滤器类型，具体如下：</p>
<pre><code>pre：可以在请求被路由之前调用
routing：在路由请求时候被调用
post：在routing和error过滤器之后被调用
error：处理请求时发生错误时被调用
</code></pre>
<p>filterOrder：通过int值来定义过滤器的执行顺序</p>
<p>shouldFilter：返回一个boolean类型来判断该过滤器是否要执行，所以通过此函数可实现过滤器的开关。在上例中，我们直接返回true，所以该过滤器总是生效。</p>
<p>run：过滤器的具体逻辑。需要注意，这里我们通过ctx.setSendZuulResponse(false)令zuul过滤该请求，不对其进行路由，然后通过ctx.setResponseStatusCode(401)设置了其返回的错误码，当然我们也可以进一步优化我们的返回，比如，通过ctx.setResponseBody(body)对返回body内容进行编辑等。</p>
<p><img src="https://luminghub.github.io/images/imgs/microservice/koalaService/003.png"></p>
<p>实现了自定义过滤器之后，实例化该过滤器使其生效。</p>
<h2 id="开发者使用"><a href="#开发者使用" class="headerlink" title="开发者使用"></a>开发者使用</h2><h3 id="项目层次结构"><a href="#项目层次结构" class="headerlink" title="项目层次结构"></a>项目层次结构</h3><p>在顶层项目KOALA下面，创建对应的微服务module，命名规范为<code>koala-$&#123;servicename&#125;</code>。下面是服务提供者和服务消费者，命名规范为<code>koala-$&#123;servicename&#125;-service</code>、<code>koala-$&#123;servicename&#125;-sharelib</code>。具体结果如下图所示：</p>
<p><img src="https://luminghub.github.io/images/imgs/microservice/koalaService/001.png"></p>
<p>其依赖关系如下图所示：</p>
<p><img src="https://luminghub.github.io/images/imgs/microservice/koalaService/002.png"></p>
<h3 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h3><p>将koala-servicename-service注册到服务中心。</p>
<h4 id="在pom-xml中引入maven依赖："><a href="#在pom-xml中引入maven依赖：" class="headerlink" title="在pom.xml中引入maven依赖："></a>在pom.xml中引入maven依赖：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="在启动类中引入-EnableDiscoveryClient注解"><a href="#在启动类中引入-EnableDiscoveryClient注解" class="headerlink" title="在启动类中引入@EnableDiscoveryClient注解"></a>在启动类中引入@EnableDiscoveryClient注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DisasterServerApp</span> &#123;</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(DisasterServerApp.class, args);</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置application-properties"><a href="#配置application-properties" class="headerlink" title="配置application.properties"></a>配置application.properties</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring<span class="selector-class">.application</span><span class="selector-class">.name</span>：注册的微服务SERVICEID</span><br><span class="line">spring<span class="selector-class">.cloud</span><span class="selector-class">.config</span><span class="selector-class">.profile</span>：配置文件profile属性，可以用来区分环境</span><br><span class="line">eureka<span class="selector-class">.client</span><span class="selector-class">.serviceUrl</span><span class="selector-class">.defaultZone</span>：微服务注册中心地址</span><br></pre></td></tr></table></figure>

<h4 id="使用客户端负载均衡"><a href="#使用客户端负载均衡" class="headerlink" title="使用客户端负载均衡"></a>使用客户端负载均衡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="服务配置"><a href="#服务配置" class="headerlink" title="服务配置"></a>服务配置</h3><p>将微服务配置信息写入配置中心。</p>
<h4 id="在pom中引入maven依赖："><a href="#在pom中引入maven依赖：" class="headerlink" title="在pom中引入maven依赖："></a>在pom中引入maven依赖：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="将application-properties修改成bootstrap-properties，并加入下列配置项"><a href="#将application-properties修改成bootstrap-properties，并加入下列配置项" class="headerlink" title="将application.properties修改成bootstrap.properties，并加入下列配置项"></a>将application.properties修改成bootstrap.properties，并加入下列配置项</h4><p>spring.cloud.config.label：服务端依赖的资源文件标记<br>spring.cloud.config.discovery.enabled：使用注册中心生效<br>spring.cloud.config.discovery.serviceId&#x3D;注册中心SERVICEID</p>
<h4 id="将配置信息写入配置中心"><a href="#将配置信息写入配置中心" class="headerlink" title="将配置信息写入配置中心"></a>将配置信息写入配置中心</h4><p>目前只能通过接口写入，写入的json格式实例如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;application&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SERVICEID-1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MICROSERVICE&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;MASTER&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;postgre.driverClass&quot;</span><span class="punctuation">:</span> <span class="string">&quot;org.postgresql.Driver&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jdbc:postgresql://10.10.10.10:5432/pql&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.user&quot;</span><span class="punctuation">:</span> <span class="string">&quot;username&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;password&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.initialPoolSize&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.minPoolSize&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.maxPoolSize&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.acquireIncrement&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.maxIdleTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;60&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;postgre.acquireRetryAttempts&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;postgre.acquireRetryDelay&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;postgre.breakAfterAcquireFailure&quot;</span><span class="punctuation">:</span> <span class="string">&quot;false&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="health组件配置"><a href="#health组件配置" class="headerlink" title="health组件配置"></a>health组件配置</h3><p>health组件为公司内部基础组件，目前最新版本为：1.0.5。health的主要作用是将app注册到zookeeper中。报警程序通过监控zookeeper上注册的app状态及health接口判断app是否健康存活。</p>
<h4 id="引入health的maven依赖"><a href="#引入health的maven依赖" class="headerlink" title="引入health的maven依赖"></a>引入health的maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mlog<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharelibs-health<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置appinfo-properties"><a href="#配置appinfo-properties" class="headerlink" title="配置appinfo.properties"></a>配置appinfo.properties</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">productName：项目组名</span><br><span class="line">appGroup：服务组名</span><br><span class="line">appName：服务名称</span><br><span class="line">ip：注册IP</span><br><span class="line">port：服务端口</span><br><span class="line">frameWork：项目框架</span><br><span class="line">language：开发语言</span><br><span class="line">register<span class="selector-class">.zk</span><span class="selector-class">.servers</span>：zookeeper集群地址</span><br><span class="line">baseSleepTimeMs：注册间隔时间</span><br><span class="line">maxRetries：重试次数</span><br></pre></td></tr></table></figure>

<h4 id="通过javaagent方式启动"><a href="#通过javaagent方式启动" class="headerlink" title="通过javaagent方式启动"></a>通过javaagent方式启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -f lib/sharelibs-health*.jar ];<span class="keyword">then</span></span><br><span class="line">  healthAgent=`<span class="built_in">ls</span> -lrt lib/sharelibs-health-*.jar |awk -F<span class="string">&quot; &quot;</span> <span class="string">&#x27;&#123;print $NF&#125;&#x27;</span>`</span><br><span class="line">  AGENT_OPTS=<span class="string">&quot;<span class="variable">$AGENT_OPTS</span>  -javaagent:<span class="variable">$healthAgent</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="exception组件配置"><a href="#exception组件配置" class="headerlink" title="exception组件配置"></a>exception组件配置</h3><p>exception为公司内部基础组件，目前最新版本为：1.0.2。exception组件的主要作用是为服务端提供统一的异常处理机制。目前有<br><code>AuthorityException：权限异常</code>、<code>DataException：数据异常</code>、<code>ParamException：参数异常</code>、<code>RequestException：请求异常</code>、<code>ServerException：服务异常</code>五种异常类型。</p>
<h4 id="引入exception的maven依赖"><a href="#引入exception的maven依赖" class="headerlink" title="引入exception的maven依赖"></a>引入exception的maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mlog<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharelibs-exception<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="编写BaseController类继承ServerExceptionHandle"><a href="#编写BaseController类继承ServerExceptionHandle" class="headerlink" title="编写BaseController类继承ServerExceptionHandle"></a>编写BaseController类继承ServerExceptionHandle</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseController</span> <span class="keyword">extends</span> <span class="title class_">ServerExceptionHandle</span> &#123;</span><br><span class="line">	</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 异常处理</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> ex</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@ExceptionHandler</span></span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line">  <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">exceptionHandle</span><span class="params">(Exception ex, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;MissingServletRequestParameterException&quot;</span>.equals(ex.getClass().getSimpleName())) &#123;</span><br><span class="line">      ex = ParamException.build(ParamError.ParamLosedError);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;MethodArgumentTypeMismatchException&quot;</span>.equals(ex.getClass().getSimpleName())) &#123;</span><br><span class="line">      ex = ParamException.build(ParamError.ParamTypeError);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.exceptionHandle(ex, response);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="controller继承BaseController，并在rest-api方法中抛出异常"><a href="#controller继承BaseController，并在rest-api方法中抛出异常" class="headerlink" title="controller继承BaseController，并在rest-api方法中抛出异常"></a>controller继承BaseController，并在rest-api方法中抛出异常</h4><p>可以通过五个异常类的build方法创建并抛出异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DataException.build(DataError.StatusError);</span><br><span class="line">DataException.build(DataError.StatusError, <span class="string">&quot;指定范围内不存在强对流天气&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="log组件配置"><a href="#log组件配置" class="headerlink" title="log组件配置"></a>log组件配置</h3><p>mlog-log组件为公司内部基础组件，目前最新版本为1.0.6。log组件的作用是将日志及异常信息用logstash抓取到指定目录，提供日志的可视化检索。</p>
<h4 id="引入log的maven依赖"><a href="#引入log的maven依赖" class="headerlink" title="引入log的maven依赖"></a>引入log的maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mlog.log<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mlog-log<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置log4j-properties配置文件"><a href="#配置log4j-properties配置文件" class="headerlink" title="配置log4j.properties配置文件"></a>配置log4j.properties配置文件</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#root</span></span><br><span class="line">log4j<span class="selector-class">.rootLogger</span>= INFO, console</span><br><span class="line">	</span><br><span class="line"><span class="selector-id">#your</span> app conf</span><br><span class="line">log4j<span class="selector-class">.logger</span><span class="selector-class">.com</span><span class="selector-class">.mlog</span><span class="selector-class">.koala</span><span class="selector-class">.aqi</span>=INFO, console, file</span><br><span class="line">log4j<span class="selector-class">.additivity</span><span class="selector-class">.com</span><span class="selector-class">.mlog</span><span class="selector-class">.koala</span><span class="selector-class">.aqi</span>=false</span><br><span class="line">	</span><br><span class="line"><span class="selector-id">#console</span></span><br><span class="line">log4j<span class="selector-class">.appender</span><span class="selector-class">.console</span>=org<span class="selector-class">.apache</span><span class="selector-class">.log4j</span><span class="selector-class">.ConsoleAppender</span></span><br><span class="line">log4j<span class="selector-class">.appender</span><span class="selector-class">.console</span><span class="selector-class">.Threshold</span>=INFO</span><br><span class="line">log4j<span class="selector-class">.appender</span><span class="selector-class">.console</span><span class="selector-class">.layout</span>=com<span class="selector-class">.mlog</span><span class="selector-class">.log</span><span class="selector-class">.layout</span><span class="selector-class">.EasyPatternLayout</span></span><br><span class="line">log4j<span class="selector-class">.appender</span><span class="selector-class">.console</span><span class="selector-class">.layout</span><span class="selector-class">.ConversionPattern</span>=%d&#123;yyyy-MM-<span class="selector-tag">dd</span> HH:mm:ss&#125; %<span class="number">5</span>p <span class="selector-attr">[%8t]</span> %<span class="number">50.50</span>c : %m%n</span><br><span class="line">	</span><br><span class="line">#file to be caught</span><br><span class="line">log4j.appender.file=com.mlog.log.appender.RollingFileAppender</span><br><span class="line">log4j.appender.file.Threshold=info</span><br><span class="line">log4j.appender.file.layout=com.mlog.log.layout.NullPatternLayout</span><br><span class="line">	</span><br><span class="line">#your log default product and app</span><br><span class="line">mlog.product：项目名</span><br><span class="line">mlog.app：app名字</span><br><span class="line">mlog.flag：app分类</span><br><span class="line">#your error uncaught to</span><br><span class="line">mlog.err.dir：错误日志列印位置</span><br><span class="line">#your log file to</span><br><span class="line">mlog.log.dir：日志列印位置</span><br><span class="line">#alertcenter http url</span><br><span class="line">mlog.alertcenter.url：服务地址</span><br></pre></td></tr></table></figure>

<h4 id="获取日志对象"><a href="#获取日志对象" class="headerlink" title="获取日志对象"></a>获取日志对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogManager.getLogger(Class.class)</span><br></pre></td></tr></table></figure>

<h3 id="swagger文档"><a href="#swagger文档" class="headerlink" title="swagger文档"></a>swagger文档</h3><p>Swagger 是一个规范和完整的框架，用于生成、描述、调用和可视化 RESTful 风格的 Web 服务。</p>
<h4 id="在pom-xml中引入swagger的maven依赖"><a href="#在pom-xml中引入swagger的maven依赖" class="headerlink" title="在pom.xml中引入swagger的maven依赖"></a>在pom.xml中引入swagger的maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="实例化Docket对象"><a href="#实例化Docket对象" class="headerlink" title="实例化Docket对象"></a>实例化Docket对象</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2).apiInfo(apiInfo()).select()</span><br><span class="line">	      .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.mlog.koala.disaster.controller&quot;</span>))</span><br><span class="line">	      .paths(PathSelectors.any()).build();</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>().title(<span class="string">&quot;强对流天气临近预报查询在线API文档&quot;</span>).description(<span class="string">&quot;由@象辑科技发布&quot;</span>)</span><br><span class="line">	      .license(<span class="string">&quot;Apache 2.0&quot;</span>).licenseUrl(<span class="string">&quot;http://www.apache.org/licenses/LICENSE-2.0.html&quot;</span>)</span><br><span class="line">	      .termsOfServiceUrl(<span class="string">&quot;http://www.mlogcn.com/&quot;</span>).contact(<span class="string">&quot;象辑科技&quot;</span>).version(<span class="string">&quot;1.0.1&quot;</span>).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="swagger注解简介"><a href="#swagger注解简介" class="headerlink" title="swagger注解简介"></a>swagger注解简介</h4><h5 id="Api"><a href="#Api" class="headerlink" title="@Api"></a>@Api</h5><p>value </p>
<blockquote>
<p>controller的描述信息；</p>
</blockquote>
<p>tags </p>
<blockquote>
<p>controller的名称；</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(value = &quot;提供用户基本信息的增删改查操作接口&quot;, tags = &#123; &quot;用户接口&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ApiOperation"><a href="#ApiOperation" class="headerlink" title="@ApiOperation"></a>@ApiOperation</h5><p>produces</p>
<blockquote>
<p>返回的格式类型</p>
</blockquote>
<p>consumes</p>
<blockquote>
<p>接收的格式类型</p>
</blockquote>
<p>value</p>
<blockquote>
<p>主要描述信息</p>
</blockquote>
<p>notes</p>
<blockquote>
<p>详细描述信息</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;获取用户列表&quot;, notes = &quot;获取当前数据库中存储的全部用户信息&quot;, produces=&quot;application/json&quot;, consumes = &quot;application/json&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getAllUserList</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<h5 id="ApiImplicitParams-ApiImplicitParam"><a href="#ApiImplicitParams-ApiImplicitParam" class="headerlink" title="@ApiImplicitParams @ApiImplicitParam"></a>@ApiImplicitParams @ApiImplicitParam</h5><p>paramType</p>
<blockquote>
<p>有3种类型，query、path、body；分别对应spring中的@RequestParam 、@PathVariable 、@RequestBody</p>
</blockquote>
<p>name</p>
<blockquote>
<p>参数名称</p>
</blockquote>
<p>value</p>
<blockquote>
<p>参数描述信息</p>
</blockquote>
<p>defaultValue</p>
<blockquote>
<p>默认值</p>
</blockquote>
<p>required</p>
<blockquote>
<p>是否必传</p>
</blockquote>
<p>dataType</p>
<blockquote>
<p>数据类型</p>
</blockquote>
<p>allowableValues</p>
<blockquote>
<p>允许输入的值；目前好像只针对String类型的有效</p>
</blockquote>
<p>示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">  @ApiImplicitParam(allowableValues = &quot;zhangsan, lisi&quot;, paramType = &quot;query&quot;, name = &quot;username&quot;, value = &quot;用户姓名&quot;, defaultValue = &quot;zhangsan&quot;, required = true, dataType = &quot;String&quot;),</span></span><br><span class="line"><span class="meta">  @ApiImplicitParam(paramType = &quot;path&quot;, name = &quot;id&quot;, value = &quot;用户ID&quot;, defaultValue = &quot;1001&quot;, required = true, dataType = &quot;Long&quot;),</span></span><br><span class="line"><span class="meta">  @ApiImplicitParam(paramType = &quot;body&quot;, name = &quot;user&quot;, value = &quot;用户详细信息&quot;, required = true, dataType = &quot;User&quot;) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">updateUser</span><span class="params">(<span class="meta">@RequestParam(name = &quot;username&quot;)</span> String username, <span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> User user)</span>;</span><br></pre></td></tr></table></figure>

<h5 id="ApiParam"><a href="#ApiParam" class="headerlink" title="@ApiParam"></a>@ApiParam</h5><p>同@ApiImplicitParams @ApiImplicitParam，不过更简化，推荐使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiParam(&quot;开始时间，格式yyyyMMddHHmm&quot;)</span></span><br></pre></td></tr></table></figure>

<h5 id="ApiResponses-ApiResponse"><a href="#ApiResponses-ApiResponse" class="headerlink" title="@ApiResponses @ApiResponse"></a>@ApiResponses @ApiResponse</h5><p>code</p>
<blockquote>
<p>httpCode编码</p>
</blockquote>
<p>message</p>
<blockquote>
<p>描述信息</p>
</blockquote>
<p>response</p>
<blockquote>
<p>返回数据类型</p>
</blockquote>
<p>responseContainer</p>
<blockquote>
<p>返回数据类型容器，可以选择 List Set Map</p>
</blockquote>
<p>示例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiResponses(value = &#123;@ApiResponse(code = 400, message = &quot;参数异常&quot;, response = ErrorBean.class),</span></span><br><span class="line"><span class="meta">@ApiResponse(code = 500, message = &quot;服务异常&quot;, response = ErrorBean.class),</span></span><br><span class="line"><span class="meta">@ApiResponse(code = 401, message = &quot;权限异常&quot;, response = ErrorBean.class),</span></span><br><span class="line"><span class="meta">@ApiResponse(code = 404, message = &quot;数据异常&quot;, response = ErrorBean.class)&#125;)</span></span><br></pre></td></tr></table></figure>

<h5 id="ApiModelProperty"><a href="#ApiModelProperty" class="headerlink" title="@ApiModelProperty"></a>@ApiModelProperty</h5><p>实体类属性上使用的注解，建议只使用value属性。</p>
<p>value</p>
<blockquote>
<p>属性列描述信息</p>
</blockquote>
<h5 id="ApiIgnore"><a href="#ApiIgnore" class="headerlink" title="@ApiIgnore"></a>@ApiIgnore</h5><p>用来标注不使用swagger的API方法。</p>
<p>完整示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/mete/disaster/forecast&quot;)</span></span><br><span class="line"><span class="meta">@Api(value = &quot;DISASTER&quot;, tags = &#123;&quot;强对流天气临近预报查询API&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DisasterDataController</span> <span class="keyword">extends</span> <span class="title class_">BaseController</span> &#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> IDisasterDataService disasterDataService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ApiOperation(value = &quot;雷电预报全量查询&quot;, produces = &quot;application/json&quot;,</span></span><br><span class="line"><span class="meta">	      notes = &quot;查询输入的时间区间（闭区间）范围内全部的雷电预报数据&quot;)</span></span><br><span class="line">  <span class="meta">@ApiResponses(value = &#123;@ApiResponse(code = 400, message = &quot;参数异常&quot;, response = ErrorBean.class),</span></span><br><span class="line"><span class="meta">  @ApiResponse(code = 500, message = &quot;服务异常&quot;, response = ErrorBean.class),</span></span><br><span class="line"><span class="meta">  @ApiResponse(code = 401, message = &quot;权限异常&quot;, response = ErrorBean.class),</span></span><br><span class="line"><span class="meta">  @ApiResponse(code = 404, message = &quot;数据异常&quot;, response = ErrorBean.class)&#125;)</span></span><br><span class="line">  <span class="meta">@RequestMapping(value = &quot;/thunder/all&quot;, method = RequestMethod.GET)</span></span><br><span class="line">  <span class="keyword">public</span> List&lt;DisasterItem&gt; <span class="title function_">queryAllThunderDisaster</span><span class="params">(</span></span><br><span class="line"><span class="params">	    <span class="meta">@ApiParam(&quot;开始时间，格式yyyyMMddHHmm&quot;)</span> <span class="meta">@RequestParam(&quot;start&quot;)</span> <span class="meta">@DateTimeFormat(</span></span></span><br><span class="line"><span class="meta"><span class="params">	        pattern = &quot;yyyyMMddHHmm&quot;)</span> Date startTime,</span></span><br><span class="line"><span class="params">	    <span class="meta">@ApiParam(&quot;结束时间，格式yyyyMMddHHmm&quot;)</span> <span class="meta">@RequestParam(&quot;end&quot;)</span> <span class="meta">@DateTimeFormat(</span></span></span><br><span class="line"><span class="meta"><span class="params">	        pattern = &quot;yyyyMMddHHmm&quot;)</span> Date endTime)</span></span><br><span class="line">	    <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> disasterDataService.queryAllDisaster(<span class="string">&quot;thunder&quot;</span>, startTime, endTime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="generator代码生成"><a href="#generator代码生成" class="headerlink" title="generator代码生成"></a>generator代码生成</h3><p>generator是专门为微服务生成对应的java SDK的，目前最新版本为1.1.0。</p>
<h4 id="引入generator及feign的maven依赖"><a href="#引入generator及feign的maven依赖" class="headerlink" title="引入generator及feign的maven依赖"></a>引入generator及feign的maven依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mlog.koala<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>koala-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="编写生成类MicroServiceGenerator"><a href="#编写生成类MicroServiceGenerator" class="headerlink" title="编写生成类MicroServiceGenerator"></a>编写生成类MicroServiceGenerator</h4><p>需要配置的4个参数：</p>
<p>appName：微服务的SERVICEID;</p>
<p>scanPackage：需要扫描的controller的包路径；</p>
<p>targetPackage：需要生成的SDK service路径；</p>
<p>creatPath：SDK service生成的跟目录；</p>
<p>完整示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MicroServiceGenerator</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">appName</span> <span class="operator">=</span> <span class="string">&quot;DISASTERSERVICE-1&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">scanPackage</span> <span class="operator">=</span> <span class="string">&quot;com.mlog.koala.disaster.controller&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">targetPackage</span> <span class="operator">=</span> <span class="string">&quot;com.mlog.koala.disaster.service&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">	<span class="type">String</span> <span class="variable">creatPath</span> <span class="operator">=</span> filePath.replaceAll(<span class="string">&quot;service&quot;</span>, <span class="string">&quot;sharelib&quot;</span>);</span><br><span class="line">	<span class="type">SDKGreneratorServer</span> <span class="variable">server</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SDKGreneratorServer</span>(appName, scanPackage, targetPackage, creatPath);</span><br><span class="line">	server.creat();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="消费者使用"><a href="#消费者使用" class="headerlink" title="消费者使用"></a>消费者使用</h2><p>目前微服务支持以下两种调用方式：</p>
<p>通过ServiceID走微服务网关调用；通过java SDK调用。</p>
<h3 id="网关调用"><a href="#网关调用" class="headerlink" title="网关调用"></a>网关调用</h3><p>通过SERVICEID及服务的url地址，从网关中调用rest-api服务。<br>调用规则为</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://api-gateway/SERVICEID/VERSION/path</span><br></pre></td></tr></table></figure>

<p>如：<br>假设微服务网关host地址为 <a href="http://10.10.10.10:8080，">http://10.10.10.10:8080，</a><br>微服务A的SERVICEID为:APP-1，其中有一个接口地址为 &#x2F;hello&#x2F;world，那么网关的调取地址为：</p>
<p><code>http://10.10.10.10:8080/APP/v1/hello/world</code></p>
<p>注意：为了规范url调取路径，serviceid和版本将统一转换为小写</p>
<h3 id="java-SDK调用"><a href="#java-SDK调用" class="headerlink" title="java SDK调用"></a>java SDK调用</h3><p>在pom.xml中引入对应的微服务发布的SDK包（sharelib），注意不能使用@ComponentScan扫描Feigin接口<br>&#x2F;&#x2F; @EnableFeignClients(basePackageClasses &#x3D; NationStationService.class)<br>@EnableFeignClients(basePackages &#x3D; “com.mlog.koala.meta.service*”)<br>@EnableEurekaClient</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="comment">// @EnableFeignClients(basePackageClasses = NationStationService.class)</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.mlog.koala.meta.service*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestMicroApp</span> &#123;</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    SpringApplication.run(TestMicroApp.class, args);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置文件中加入服务中心的地址，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eureka.client.serviceUrl.defaultZone</span><br></pre></td></tr></table></figure>

<p>自动注入Service接口对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> NationStationService nationStationService;</span><br></pre></td></tr></table></figure>





      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/22/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%BC%80%E5%8F%91%E4%B8%8E%E4%BD%BF%E7%94%A8/" data-id="cllui4qz70040q0jaafaqa5yt" data-title="微服务使用" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring-Cloud/" rel="tag">Spring Cloud</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-java反射" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/20/java%E5%8F%8D%E5%B0%84/" class="article-date">
  <time class="dt-published" datetime="2017-05-19T16:00:00.000Z" itemprop="datePublished">2017-05-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/20/java%E5%8F%8D%E5%B0%84/">java反射</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="获取某个类的构造方法"><a href="#获取某个类的构造方法" class="headerlink" title="获取某个类的构造方法"></a>获取某个类的构造方法</h3><ul>
<li>Constructor getConstructor(Class[] params)     根据构造函数的参数，返回一个具体的具有public属性的构造函数</li>
<li>Constructor getConstructors()     返回所有具有public属性的构造函数数组</li>
<li>Constructor getDeclaredConstructor(Class[] params)     根据构造函数的参数，返回一个具体的构造函数（不分public和非public属性）</li>
<li>Constructor getDeclaredConstructors()    返回该类中所有的构造函数数组（不分public和非public属性）</li>
</ul>
<h3 id="获取成员方法"><a href="#获取成员方法" class="headerlink" title="获取成员方法"></a>获取成员方法</h3><ul>
<li>Method getMethod(String name, Class[] params)    根据方法名和参数，返回一个具体的具有public属性的方法</li>
<li>Method[] getMethods()    返回所有具有public属性的方法数组</li>
<li>Method getDeclaredMethod(String name, Class[] params)    根据方法名和参数，返回一个具体的方法（不分public和非public属性）</li>
<li>Method[] getDeclaredMethods()    返回该类中的所有的方法数组（不分public和非public属性）</li>
</ul>
<h3 id="获取成员属性"><a href="#获取成员属性" class="headerlink" title="获取成员属性"></a>获取成员属性</h3><ul>
<li>Field getField(String name)    根据变量名，返回一个具体的具有public属性的成员变量</li>
<li>Field[] getFields()    返回具有public属性的成员变量的数组</li>
<li>Field getDeclaredField(String name)    根据变量名，返回一个成员变量（不分public和非public属性）</li>
<li>Field[] getDelcaredField()    返回所有成员变量组成的数组（不分public和非public属性）</li>
</ul>
<h3 id="获取类注解"><a href="#获取类注解" class="headerlink" title="获取类注解"></a>获取类注解</h3><p> Annotation[] annotations &#x3D; clazz.getAnnotations();</p>
<h3 id="方法返回类型"><a href="#方法返回类型" class="headerlink" title="方法返回类型"></a>方法返回类型</h3><pre><code> Type tp = method.getGenericReturnType();
if(tp instanceof ParameterizedType)&#123;
    tp =(ParameterizedType) method.getGenericReturnType();
&#125;
// 返回类型名称
System.out.println(tp.getTypeName());
</code></pre>
<h3 id="方法形参名字"><a href="#方法形参名字" class="headerlink" title="方法形参名字"></a>方法形参名字</h3><pre><code>//org.springframework.core.LocalVariableTableParameterNameDiscoverer
 LocalVariableTableParameterNameDiscoverer parameterNameDiscoverer =
          new LocalVariableTableParameterNameDiscoverer();
  String[] paramNames = parameterNameDiscoverer.getParameterNames(method);
</code></pre>
<h3 id="形参类型"><a href="#形参类型" class="headerlink" title="形参类型"></a>形参类型</h3><pre><code>  Type[] parameterTypes = method.getGenericParameterTypes();
</code></pre>
<h3 id="包扫描"><a href="#包扫描" class="headerlink" title="包扫描"></a>包扫描</h3><p>获取jar中的class</p>
<pre><code>  public static void getJarClass(JarFile jarFile, String filepath, Set&lt;Class&lt;?&gt;&gt; clazzs)
      throws IOException &#123;
    List&lt;JarEntry&gt; jarEntryList = new ArrayList&lt;JarEntry&gt;();
    Enumeration&lt;JarEntry&gt; enumes = jarFile.entries();
    while (enumes.hasMoreElements()) &#123;
      JarEntry entry = (JarEntry) enumes.nextElement();
      // 过滤出满足我们需求的东西
      if (entry.getName().startsWith(filepath) &amp;&amp; entry.getName().endsWith(&quot;.class&quot;)) &#123;
        jarEntryList.add(entry);
      &#125;
    &#125;
    for (JarEntry entry : jarEntryList) &#123;
      String className = entry.getName().replace(&#39;/&#39;, &#39;.&#39;);
      className = className.substring(0, className.length() - 6);
      try &#123;
        clazzs.add(Thread.currentThread().getContextClassLoader().loadClass(className));
      &#125; catch (ClassNotFoundException e) &#123;
        e.printStackTrace();
      &#125;
    &#125;
  &#125;
</code></pre>
<p>获取文件中的class</p>
<pre><code>public static void getFileClass(String packName, String filePath, Set&lt;Class&lt;?&gt;&gt; clazzs) &#123;
    File dir = new File(filePath);
    if (!dir.exists() || !dir.isDirectory()) &#123;
      System.out.println(&quot;包目录不存在!&quot;);
      return;
    &#125;
    File[] dirFiles = dir.listFiles(new FileFilter() &#123;
      public boolean accept(File file) &#123;
        boolean acceptDir = file.isDirectory();// 接受dir目录
        boolean acceptClass = file.getName().endsWith(&quot;.class&quot;);// 接受class文件
        return acceptDir || acceptClass;
      &#125;
    &#125;);
    for (File file : dirFiles) &#123;
      if (file.isDirectory()) &#123;
        getFileClass(packName + &quot;.&quot; + file.getName(), file.getAbsolutePath(), clazzs);
      &#125; else &#123;
        String className = file.getName().substring(0, file.getName().length() - 6);
        try &#123;
          Class&lt;?&gt; clazz =
              Thread.currentThread().getContextClassLoader().loadClass(packName + &quot;.&quot; + className);
          clazzs.add(clazz);
        &#125; catch (ClassNotFoundException e) &#123;
          e.printStackTrace();
        &#125;
      &#125;
    &#125;
 &#125;
</code></pre>
<p>扫描指定包下的class</p>
<pre><code> public static Set&lt;Class&lt;?&gt;&gt; findFileClass(String packName) &#123;
    Set&lt;Class&lt;?&gt;&gt; clazzs = new LinkedHashSet&lt;Class&lt;?&gt;&gt;();
    String packageDirName = packName.replace(&#39;.&#39;, &#39;/&#39;);
    Enumeration&lt;URL&gt; dirs;
    try &#123;
      dirs = Thread.currentThread().getContextClassLoader().getResources(packageDirName);
      while (dirs.hasMoreElements()) &#123;
        URL url = dirs.nextElement();
        String protocol = url.getProtocol();
        if (&quot;file&quot;.equals(protocol)) &#123;// 扫描file包中的类
          String filePath = URLDecoder.decode(url.getFile(), &quot;UTF-8&quot;);
          getFileClass(packName, filePath, clazzs);
        &#125; else if (&quot;jar&quot;.equals(protocol)) &#123;// 扫描jar包中的类
          JarFile jarFile = ((JarURLConnection) url.openConnection()).getJarFile();
          getJarClass(jarFile, packageDirName, clazzs);
        &#125;
      &#125;
    &#125; catch (Exception e) &#123;
      e.getStackTrace();
    &#125;
    return clazzs;
 &#125;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/20/java%E5%8F%8D%E5%B0%84/" data-id="cllui4qz1002kq0ja5og11wop" data-title="java反射" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVA/" rel="tag">JAVA</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-软件架构师的12项修炼2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/01/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC2/" class="article-date">
  <time class="dt-published" datetime="2017-04-30T16:00:00.000Z" itemprop="datePublished">2017-05-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/improve/">improve</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/01/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC2/">关系技能修炼篇&lt;二&gt;</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="沟通"><a href="#沟通" class="headerlink" title="沟通"></a>沟通</h3><p><code>听得好是一种沟通与影响他人的有力手段，与说得好同样重要。 - 约翰·马歇尔</code></p>
<p><code>我只希望我能找到一个学院，在那里向人讲授如何听别人说话。行业人士至少应听得与他们需要说的一样多。太多的人没有意识到真正的沟通其实是双向的过程。 - Lee Iacocca</code></p>
<p><code>你可以有非常不错的主意，但如果不能让别人听明白，这些主意就不可能让你有所成就。 - Lee Iacocca</code></p>
<p>在架构师的角色中，沟通是要求有效果的必备技能与工具。</p>
<p>架构师通常没有对为其项目工作的他人的直接管理权。他们的项目往往是跨部门的，也可能会跨好多个行业单位。由于不能直接管理他人，所以架构师指示别人或群体完成特定行动的能力就受到限制。他们唯一真正有效的手段就是其影响力。</p>
<p>靠技术晋级的人主要关注在技术性的专业知识上。成为技术专家，沟通技术知识对于他们往上爬来说非常关键的技能。这种技能通常意味着维护你的职位，明确特定项目的潜在风险和当前问题。在单位等级结构的这一层上，你应该阻止产生问题，寻找问题并解决问题。你的上级都在盯着看你的每一步动作。压力往往会非常大。</p>
<p>对于靠技术吃饭的人来说，若想迈出跳至管理的第一步（我认为架构师已经在进行部分管理工作了），阶梯上的下个台阶的特性已经大大变化了。尤其是，首先要求的技能是沟通范围、数量大大地拓宽了。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part2/01.png"></p>
<blockquote>
<p>架构师的沟通首先基于沟通原则，其实是沟通策略，在此之上是与执行官的有效沟通</p>
</blockquote>
<h4 id="2-1-沟通原则"><a href="#2-1-沟通原则" class="headerlink" title="2.1 沟通原则"></a>2.1 沟通原则</h4><p>学习有效沟通是一个终身的过程 - 永远都有改善的余地。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part2/02.png"></p>
<blockquote>
<p>要学习的沟通原则包括：先听后说、专心致志（人和心思在一处）、正面思考等，这些原则有助于建立与别人的信任关系，使你成为更高超的沟通者。</p>
</blockquote>
<h5 id="2-1-1-先听后说"><a href="#2-1-1-先听后说" class="headerlink" title="2.1.1 先听后说"></a>2.1.1 先听后说</h5><p>你有没有发现自己在某次谈话中总是想寻求一次讲话的机会，而没有真正的在听别人说什么？当你没有听时，你传递给那个对你讲话的人什么信息呢？</p>
<p>至少表面上，你显得不在乎别人说什么。大部分人会很快厌倦这样的谈话，因为他们说的话白白在空气中传播却没人去听。说话的人也许回想他还有更好的事要做，而结束此次谈话。如果你只是偶尔这样做，这种行为没什么大不了的。如果这是你的习惯做法，那么你是在自己与别人之间构筑一道墙。</p>
<p>你听的时候，是不是在找机会纠正对方？即便谈话的人对你很在乎，从其忙碌的工作中抽出时间，为你提供这些宝贵的信息，所以应该认真去听他说什么。</p>
<p>当有人与你说话时，要看着他说，并试着理解他想沟通的内容。给对方足够的时间来表达他的观点，然后再向其询问要澄清的问题。向他表达非语言的反馈，例如点头，让他知道你在关注这次谈话。</p>
<p>我认为罗马人Epictetus说得好：“我们有两个耳朵，一个嘴巴，所以我们应该多听少说。”</p>
<h5 id="2-1-2-专心致志"><a href="#2-1-2-专心致志" class="headerlink" title="2.1.2 专心致志"></a>2.1.2 专心致志</h5><p>不管你在哪里，都应专心致志。生活中有许多事情要分身，例如这个周末你要做什么，几分钟前开会回来如何解决会上的问题，怎样找个办法告诉老板某个负面的消息，小孩今晚的英式足球比赛几点开场…所有这些琐事都很容易让你想入非非。</p>
<p>一般来说，人在任何时刻最多只能同时处理5~9件那么多的事。如果你的脑袋全是一些无关紧要的琐事，你就无法专心致志地做事。要是有人对你说话，你就会完全听不到他在讲什么，倘若他在问你问题，你可能要他们再说一遍。这种情况下，你其实是在浪费别人的时间，他们不会高兴的。如果房间里有个执行官，你就会给人家留下一个持久的坏印象：真是个浪费钱的家伙！</p>
<p>请你读这些时间管理上的书，列出每天需要关注事情的清单计划。在计划中安排好任务的优先级（当天、本周等），并标识每个任务准备投入的时间。这个办法能够让你通过计划安排好每件事，节省你的精力去记忆周围各种正在发生的事。</p>
<p>如果某个会议不是真的需要你参加，你就不要去；假如确实需要你参加，就一定要去，而且人和心思都花在那里。</p>
<p>我发现，坐直，将脚放在座位正下方、做笔记、直视正在讲话的人，能够自然而然的全神贯注于会议正在进行的事情，从说话和肢体语言两方面都给人以积极参与的正面印象。</p>
<p>不管你做什么，都需要专心致志！</p>
<h5 id="2-1-3-正面思考"><a href="#2-1-3-正面思考" class="headerlink" title="2.1.3 正面思考"></a>2.1.3 正面思考</h5><p>当你表达信息时，总有许多种方法去传递它们。信息需要真实和准确，然而表现出其意义的方式可以多种多样。</p>
<p>你可以以积极意义或者消极意义提供信息。你可以基于所期望的结果选择某种方法。也可以采用不偏不倚的方式，不带情绪地列举事实，尽管这通常很难做到。</p>
<p>从沟通的观点来看，人们容易注意负面的东西。通常负面消息总会带来恐惧（当我感觉恐惧临近时，我会把它当作“要求集中精力的行动”的信号）。</p>
<p>作为架构师，你需要避免不必要的偏见信息，让别人能够选择他们要关注的信息。你可以提供若干种替代方案，但这些方案应当是客观平等的。你需要察觉可能的办法，而不是为别人留下疑惑。</p>
<h5 id="2-1-4-尽早道歉"><a href="#2-1-4-尽早道歉" class="headerlink" title="2.1.4 尽早道歉"></a>2.1.4 尽早道歉</h5><p>在一天的事务中，你可能注意到对他人做的某个事情不合适或不正确。记住放下自尊去给受影响的对方道一个歉。向别人诚心道歉并不是好玩或者容易之举，但你可以赢得别人的尊敬，展示你在尽力成长，尝试变得更好的意图。</p>
<p>如果你道歉，对方就有可能重新审视事情，而原谅你带来的任何苦恼伤痛。有些让人尴尬的事情转而有了积极意义。你与那人的关系就有了增进的机会，而不是就此冷淡。</p>
<p>人的本能倾向就是让冒犯别人后的情势不了了之。遗憾的是，你可能埋下了让它长大成祸患的种子，以致对你造成长期的影响。被得罪的人可能耿耿于怀，在很长很长时间内记住这件事。那个人也许会把这件事告诉别人，说你是个什么类型的人。你和此人及周围其他人的交往能力可能大打折扣。最后，或许你已经忘记做过的事，但是对方却没有忘记。</p>
<p>道歉时，你要清楚地表达出要道歉的是什么，你说的是什么意思。如果你不是诚心道歉，虚假的说辞可能把事情弄的更早。如果你不能表达诚意，就不要道歉，但你的目标应当是努力与你交往的人修缮积极的关系。避免让道歉使你向错误的方向发展，限制你的个人成长。</p>
<h5 id="2-1-5-不要在缺陷上招致恼羞成怒"><a href="#2-1-5-不要在缺陷上招致恼羞成怒" class="headerlink" title="2.1.5 不要在缺陷上招致恼羞成怒"></a>2.1.5 不要在缺陷上招致恼羞成怒</h5><p>当你在开评审会（例如产品概念评估、需求评审、设计评审、代码评审、测试评审、产品发布评审）时，通常会检查出评审项目的一些缺陷。评审项目的作者对于这些暴露出的缺陷当然会感到不自在。</p>
<p>出于通常的礼貌，一旦在特定领域发现了三四个问题，就不要再过高、过深的批评了。如果你需要指出再多的条目，可以将其写下来，让被困扰的人随后能仔细看到这些要点。否则这些事情会招致对方恼羞成怒。由于被评审人成了众矢之的，在效率上会极大地影响评审的后续进展。</p>
<p>对于评审，有下列一些有效的办法：</p>
<ul>
<li>确保对评审项目的关注，而评价不是针对生产或创造评审项目的人或单位。换句话说，评审应针对事物、方法，而不是针对人。</li>
<li>避免用“你”，“你的”这类个人化的评价。</li>
<li>设法表达你要求修改的愿意是想达成什么目标：确定修改与时长策略有关，基于一般的架构原则，抑或是公司或部分的目标。</li>
<li>评审应关注改善评审项目的方法，不仅仅因为没有遵循某个编码指导原则，而是修改后为什么有用。评审项目的人不仅需要知道怎样把事情做的更好，还要知道为什么这种改进是有用的。</li>
<li>找机会说出已做出的工作的积极成分。大多数人被指出暴露的缺陷后，都会非常想要辩解，而找到工作好的方便能够软化这种态势。所有与会者都应明白，目标是创造优秀的工作成果，每个人都要求用同样的标准 - 这是集体的势力。</li>
<li>确保会上的每个人都参与进来。以局外人的身份参加会议室在浪费公司的时间。</li>
<li>模仿你在寻求的行为。拿出当评审你的工作，且结果是“很好，继续干吧”时的行为。目标是创造优秀的工作并持续改进它。换句话说，不是关于你的事，而是关于如何奋力争取优秀的事。</li>
<li>举止文雅：倘若角色互换，作为被评审人，你希望别人怎样给你反馈意见？</li>
</ul>
<p>任何问题都应记录在案 - 不只是你感兴趣要追踪的事，还包括其他人提出的记录。如果确有一大串条目需要引起注意，可能随后还要再进行一次评审。</p>
<h4 id="沟通策略"><a href="#沟通策略" class="headerlink" title="沟通策略"></a>沟通策略</h4><p>在我们研究了沟通的核心原则后，现在你可以应用一些了策略来展示恒定、高效的沟通风格。</p>
<h5 id="2-2-1-多说“是”，少说“不是”"><a href="#2-2-1-多说“是”，少说“不是”" class="headerlink" title="2.2.1 多说“是”，少说“不是”"></a>2.2.1 多说“是”，少说“不是”</h5><p>架构师经常会被咨询到某个项目的可行性，并提供从战略到战术的多个替代方案，附带若干成本选项，以使商务伙伴能根据特定项目的投资进行判断。架构师与项目评估团队的角色不是决定要构建什么，而是决定怎样构建。</p>
<p>我们试图说出的答案是“对”，我们能构建这个项目，“这些是相关的信息”。产生的信息需要包括诸如所考虑的各种替代方案、项目风险（以及可能的规避策略）、基于的假设条件，以及需要指出的突出问题。</p>
<p>我们不是在寻找这样的答案：“不行，这个项目不可行，但我们能构建另一个项目（通过消除原困难项目中的难题，而代之以我们想构建的那些特性）。”</p>
<blockquote>
<p>作为架构师，我们要寻求说“是”的方法。</p>
</blockquote>
<p>但是，如果一个项目或任务不可行，我们需要立即巧妙地指出评估结果、解释原因，并提供替代方案。这通常归结于法律法规、行规等原因，以致“不”是正确的回答。当然了，还有一些例外情况：提出需求的人是想逃避工作，需求违反了公司的政策，或者你手头有优先级更高的工作，无法让你有足够的时间来对需求做出满意的答复。这些情况下，你要清楚地告诉人家你说“不”的原因。</p>
<p>如果执行官要求你做某件事，你要确信这个要求的优先级。如果是高优先级要求，你一定要分析不做其他任务的影响，并反馈给执行官。这将让高一级的经理在确定任务的孰重孰轻时有足够的信息。它也有助于你免于日后陷入两难境地无法自拔 - 如果你不得不解释为什么不让另一位经理知道就耽误了其他重要的任务。</p>
<p>学会说“是”可以采用多种替代形式。通常，它涉及为某人或某个项目找到继续前行的办法。没有必要你自己来承担任务或需求。也许你可以提供一套合理的替代方案，或者引导提出需求的人找到其他人，后者能够解决项目当前面临的问题。</p>
<p>对于需要可行性信息的多数项目而言，最值得期望的方法就是提供一个自助餐式的选项，详细罗列出成本、风险、战略影响以及有效的组合等信息。这种策略让需求者处于决定者的地位，使他可以选取最能产生商业价值的解决方案。</p>
<p>提供一组方案供客户和同事选择，这种做法能让你自然而然的与他们建立友好关系。</p>
<h5 id="2-2-2-在销售过程中建立起信任关系"><a href="#2-2-2-在销售过程中建立起信任关系" class="headerlink" title="2.2.2 在销售过程中建立起信任关系"></a>2.2.2 在销售过程中建立起信任关系</h5><p>想想你上次购买一辆车、盖房或者购置一个大物件的情形。这次购买的成就感或挫折感很大限度上取决于你所打交道的销售员或签约人。</p>
<p>销售员总是仔细听你想要什么东西，通过提供下列信息，让你能够以决策者的身份决定你想买的东西：</p>
<ul>
<li>可用的选择方案；</li>
<li>各选择方案的开销；</li>
<li>各选择方案的好处；</li>
<li>各选择方案能够如何组合；</li>
<li>各选择方案涉及的风险；</li>
<li>每种选择方案已知的问题。</li>
</ul>
<p>销售员不大可能强行把你往这个或那个方向引导，但会帮助你理清需求，为你寻找以最低花费得到最高价值的解决方案。为做到这一点，他的自身利益只能退而求其次。</p>
<p>通过将你置于第一位，销售员能够建立与你的信任关系。这种信任让你感觉你是在有足够信息的情况下做决定，而他是你的伙伴。</p>
<p>当有人问起你新购置的物件时，你很可能不只对这个物品的方方面面滔滔不绝，还会提到那个了不起的销售员，并推荐他给你周围那些想购买类似物件的人，因而又开启了一个销售周期。</p>
<p>作为架构师，你应当成为那个销售员，值的别人信任。</p>
<h5 id="2-2-3-特殊场合才说“不”"><a href="#2-2-3-特殊场合才说“不”" class="headerlink" title="2.2.3 特殊场合才说“不”"></a>2.2.3 特殊场合才说“不”</h5><p>从架构师的前景来看，只有在若干种情况下你可以简单的说“不”。大多数时候，你必须提供能让事情完成的替代方案（涉及费用、风险和每种方法的好处）。最后的决定取决于项目的主人（即掌握购买权的人）。</p>
<p>在其他时候，说“不”是合适的。通常这种拒绝需要有足够合理的深度来支撑。以应付所有必要的质疑。争论的领域很可能与任何项目都存在的关键限制因素，如效果、成本、时间和范围。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part2/03.png"></p>
<blockquote>
<p>爱惜你的“不”，而只把它用到礼仪场合 - 不要轻易用它</p>
</blockquote>
<p>下面是说“不”和不说“不”的一些考虑因素：</p>
<ul>
<li>对于项目的最后期限，当要求违反“物理法则”，即无法执行项目给定最后期限内的所有步骤（例如：硬件的获取和供应、规划、开发、要求的培训、测试、修正错误和部署）时，说“不”是可接受的。但不能因为工作看起来困难、你不大喜欢它或者有其他不能同时进行的优先级（也许当前需求会很快成为最高优先级 - 值的将此列为一个风险）。中性的陈述各竞争优先级的任务，从而让执行官能根据各自的相对重要性安排它们。</li>
<li>问自己这些问题：</li>
</ul>
<ol>
<li>我表现正直吗？我在会议上公开说的话与我在门廊中说的话一致吗？如果你真的对需求有疑问，应当将它们摆到台面上，即便对你并没有什么好处。与通常一样，这种行动应当以文雅、令人尊敬的方式做出。</li>
<li>有没有替代方案能消除“物理法则”问题？脱开思维框框的束缚。如果这是你的公司，你如何解决问题？（当然了，答案不是解雇你周围的所有人。）如果你在特定领域中没有专业知识，你能引入有这方面专业知识的外包人员吗？其他人有没有解决过类似问题？你能将他引入项目，或者至少请教他一些问题吗？是否有一些概念证明能迅速实施来降低项目在某些地方的风险？你需要更多的时间来评估项目吗？</li>
<li>有没有其他人可以和你一起进行头脑风暴，以找出解决方案？</li>
<li>你能分阶段定义项目，每个阶段都有可发布的东西（主要的发布）吗？这个分阶段的办法使你能够分别为每个阶段寻求资金，也能够定位你首先要了解什么内容。随着你了解情况的深入，你可以评估下一个阶段，倘若发现下一阶段不可行，或者不能提供足够商业价值来继续推进的话，你可能退出项目。</li>
</ol>
<ul>
<li>如果你说“不”，你可能注定是在“死亡行军”（death march） - 项目已经有了高度可见性，无休止的加班，客户永远不怎么满意。要求有适当的期望值来避免这种结果。</li>
<li>特定的环境有时会影响说“是”或“不”的决定。例如，在停业期（layoff）或外包期（outsourcing）期间，可能需要更微妙的方法。每个人在此气氛下都很紧张急躁，项目协商变得很具挑战性。</li>
</ul>
<p>你要相信所提到的解决方案。如果你并不真正相信你所推销的东西，你的肢体语言和眼睛会说实话的。你的不诚实如同水中的血腥味那样：你很可能被问及更详细的一些问题，如同鲨鱼在攻击一样。在某种意义上，你是将自己置身于未曾准备好的问题。你需要了解足够多的细节来相信这种解决方案。在你向人们提出某种解决方案时，你也需要自我提问和回答有关的难题。</p>
<p>在所有可能情况下，避免真的说“不”。事实上，根据你所交互的人或群体的语境，解释决定所基于的原因。</p>
<h5 id="2-2-4-抑制想自卫的冲动"><a href="#2-2-4-抑制想自卫的冲动" class="headerlink" title="2.2.4 抑制想自卫的冲动"></a>2.2.4 抑制想自卫的冲动</h5><p>通常在交谈中，当我们听到并不完全对自己有正面意义的事情时，我们可能会找借口，我们可能会找办法转移话题，并责怪他人，以使自己脱离干系。或者我们想强词夺理，以阐述那些语句。应当避免做出次反应的冲动。相反，代之以等待，并接受别人所说的话。</p>
<p>在上一段描述的反应中，会谈的真正兴趣已经从对别人转移到你身上。听别人说话的行为至少暂时结束了，我们开始与会谈者发出警示信号：“我们把话题引向另一个方向吧，一个和我没关系的方向。”注意你正在用的肢体语言 - 胳膊交叉在胸前或者头转向一边告诉别人“我不想听了”。</p>
<p>问自己这个问题：“我能从这个人说的话中学到什么？”通常，他给出的信息也许并不是你乐意听到的，但其动机是好的，仍是你接受信息并获得个人成长的机会。</p>
<p>抑制想自卫的冲动的一个例外就是当手头的问题涉及企业政策或你的正直时。如果别人说的话使你真正涉及与公司政策冲突或你出于正直未做某事（假如，你已经正确做出了行动）时，你需要立即抨击这些说法。你可能想用澄清问题的办法来明确要点，比如“你的意思是我做过某事吗”。如果别人说“是的”，你就以“这并不准确”来明确回应；倘若人家回答“不是”，要感谢他澄清了此事。</p>
<h5 id="2-2-5-倾听建议来改善合作"><a href="#2-2-5-倾听建议来改善合作" class="headerlink" title="2.2.5 倾听建议来改善合作"></a>2.2.5 倾听建议来改善合作</h5><p><code>先寻求理解别人，再寻求被人理解。 - Stephen Covey</code></p>
<p>从软件开发的角度看，批评别人和被批评的情况经常发生。因为有软件评审、设计评审、单元测试、功能测试、缺陷跟踪，或者只是简单地向别人寻求帮助，与上司一对一地谈话，这个列表不断在进行。在所有情况下，总有机会将别人说的话特定到你身上。</p>
<p>一旦你把谈话话题转移到自己身上，而不是工作成果或某些事件上，你本能的自卫意识就来了。这时，你听进去任何事情的能力就变得有限，“要么拼命，要么逃跑”的本能反应开始占据上风，而你的大脑指挥身体开始变得激动，以准备自我保护。所沟通的用于改善工作成果的有价值信息烟消云散。从商业角度看，将一项工作产品做的尽可能优秀以符合每个人的最大利益。因为我们越能为产品增加价值，公司越有机会从投资中得到回报。</p>
<p>如果你能避免在谈话中个人化，你听取别人说话的能力就大大提升了。要试着找出他说话的真正用意（即便你不同意他说的话）。以适当的方式取得他想传递的本意，复述一遍要点。一般情况下，别人只是想被理解，他并不是在寻求你同意他的观点。当你倾听并能理解对方表达的要点时，你就能和他心灵相通。</p>
<blockquote>
<p>通过倾听并复述所说过的话，来理清自己的理解。</p>
</blockquote>
<h5 id="2-2-6-了解别人和自己的沟通需求"><a href="#2-2-6-了解别人和自己的沟通需求" class="headerlink" title="2.2.6 了解别人和自己的沟通需求"></a>2.2.6 了解别人和自己的沟通需求</h5><p>在架构师的世界中，你需要例行的与许多人交流。你可能在上一次会议上与有些人谈过话，也可能没有和这些人谈话。挑战就是快速了解人们在说什么，他们怎么说这些话，来“读懂”本次会议。</p>
<p>观察关键的时刻，即做出决定的时刻是一个要点。以此识别人们提出的问题和关心的地方，来加强核心概念，帮助你关注会议的方向以及把会议引向一个成功的结论。为了认识这些关键时刻，我们需要吸收所有信息，包括提供给我们的语言或非语言信息。</p>
<p>观察别人的举止能够告诉我们如何与每个人最好的沟通。由于每个人都不相同，并且对沟通也有不同的需求，架构师必须让传递信息的方式适应这些需求，以确保有效沟通。</p>
<p>关键点就是我们要基于每个听众成员的沟通需求来匹配交流风格。有些人的反应是能够看出来的，他们的偏好能够用诸如“我明白你的意思”之类的话辨别。另外有些人需要倾听、并吸纳语言细节，他们的偏好能够用诸如“我在听你说”之类的话辨别。还有一些人在交谈中比较情绪化，他们的偏好能够用诸如“我觉得怎样怎样”之类的话辨别。</p>
<p>除此之外，大部分人的肢体语言（如无精打采、坐姿端正、胳膊交叉、与别人交谈，或者说话时用手势）都能给你关于此人的线索，表明此人在本次会议或集会上是专心致志还是心不在焉的。事实上，电话会议的一个主要麻烦就是你无法看到电话另一端人们的肢体语言。后果就是你不能取得同样多的反馈信息来帮助引导会谈。而一般会谈中很容易看出需要谈到或考察的问题、人们关心的地方及思路。如果仔细倾听，你还是能够从与会者的语言、语调及说话的速度等方面观察出端倪 - 来自所有这些方面的反馈有助于了解沟通的效果。</p>
<p>电话会议的另一个挑战就是你可能不了解电话另一端的所有人，也无法琢磨其沟通方式、语境。要克服这类知识的匮乏，应在会议开始时做到下列事情：</p>
<ul>
<li>收集电话另一端所有人的名字。</li>
<li>重视每个人的响应。</li>
<li>注意所有与会者的交流方式、开会的方法（如态度、言辞、语调）及角色。</li>
<li>在将来的电话会议上使用这些知识来引导交互过程。</li>
</ul>
<p>诸如WebEx之类的在线开会，比电话会议效果好，至少你能够看到他人当前如何反应。这些可视性也有助于主导会谈。</p>
<p>在视频会议中，每个人都能看到自己，这是对电话会议或在线会议的重大改进。我们能够看到活生生的对方，或者说是某个人的图像，使得交互更具人性化，能够大大改善与其他参会者的沟通能力。</p>
<p>要记住这种交谈的一个关键方面就是，在交谈中别人不仅以多种方式将他们的所思所想告诉你，你也在给他们传递类似的信息。在会议中，你需要本能地意识到你的身体正在给别人传递信息。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part2/04.png"></p>
<blockquote>
<p>你的肢体语言会“大声说话” - 所以要谨慎你说的“内”容</p>
</blockquote>
<p>在会议中记住这些事项：</p>
<ul>
<li>你在微笑吗？</li>
<li>你坐姿端正吗？</li>
<li>你赞成时点头吗？</li>
<li>你的眼神对着正在讲话的人吗？</li>
<li>你的声音或者说话语调是抑扬顿挫的吗？</li>
<li>你参加会议室的装束风格和别人类似吗？</li>
<li>你真的在倾听并理解别人说的话吗？</li>
<li>你做笔记吗？</li>
<li>你主张对抗吗？</li>
</ul>
<p>所有这些条目组合在一起，可以让别人知道或确认你要发出的消息的一致性。你是在笑着讲诉一个伤心的故事吗？如果是这样，这种不一致性就会剥夺你所试图发出消息的完整性。</p>
<p>对于同样的一个消息，要努力发展自己说什么、怎么说的技巧。这种持之以恒的表现会增强你有效沟通的能力。</p>
<h5 id="2-2-5-才思敏捷"><a href="#2-2-5-才思敏捷" class="headerlink" title="2.2.5 才思敏捷"></a>2.2.5 才思敏捷</h5><p>随时准备好回答别人的提问。当人们提问时，不大可能先给出预告。也就是说，你不会有任何时间去准备理由充分的答案。问题可能来自任何方面（单位中职务比你高的、和你平级的或者低于你的）。</p>
<p>作为架构师，你需要对迅速切换语境游刃有余。即记住头脑中每个活跃的事情，将其压入要记忆的栈中，然后集中全部注意力来快速处理面前的语境。这种活动称作“才思敏捷”。</p>
<p>在这种情况发生时，试用下列模式来处理此形式：</p>
<ul>
<li>关注是谁在问此问题。这个人的背景如何？他需要知道什么信息来理解你的反应？倘若你对他的问题有所反应，这是否合适？</li>
<li>想出三点解释，如果可能的话，暂停并思考你要说的话对单位的影响。因为这项决定将在单位中贯彻，别的群体将如何反应？</li>
<li>如果你已经安抚寻求决定的人，也清楚地知道其他群体将对决定的影响有所反应，你应当认识到不就后的日程上将有一系列不令人愉快的会谈。</li>
<li>你也许在考虑做出一项决定，这一决定会导致涉及的每个组都不太高兴。通常，如果你能做到这一点，你就是协商的高手。当每个人在这场游戏中都有利益关系时，所有参与方会在未来更好的合作。如果没有相关的利益，他们会认为自己并未被挑选出来，现在可以集中精力解决手头的现实问题。</li>
<li>有意思的是，在这个所有人都不太高兴的时刻，每个人都变得更通情达理。想出更多的可替代方案来使问题以更简单、更快速、更省钱的方式解决。当答案浮出水面时 - 可能是真正革新型的解决方案，就准备说“是”吧。</li>
<li>如果你的答案有消极影响，要展示别的答案也是“有问题”的。陈词滥调过后，大家同病相怜 - 一起共享不快，滋味总比吞咽药丸感觉好一些。</li>
<li>当然了，能让每个利益相关者高兴的决定有时可能存在的，也总是最可取的。</li>
</ul>
<h4 id="2-3-与执行官沟通"><a href="#2-3-与执行官沟通" class="headerlink" title="2.3 与执行官沟通"></a>2.3 与执行官沟通</h4><p>执行官在任何公司都是独特的个人。他们的职责很广。执行官的沟通能力、领导能力和关系技能都经过刻苦磨练。学习与执行官沟通需要花费时间和经过实践，但你只有一次机会来取得第一印象，所以务必准备好。</p>
<h5 id="2-3-1-执行官需要信任、忠诚和连贯性"><a href="#2-3-1-执行官需要信任、忠诚和连贯性" class="headerlink" title="2.3.1 执行官需要信任、忠诚和连贯性"></a>2.3.1 执行官需要信任、忠诚和连贯性</h5><p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part2/05.png"></p>
<blockquote>
<p>执行官特别需要信任、忠诚和连贯性，你应给予他这些东西</p>
</blockquote>
<p>当你在与执行官沟通时（特别是那些对你工作领域不甚了解的执行官），你需要注重与之建立信任和忠诚关系。在你继续与之工作的过程中，你给出的信息应当具备一致性：你不能某天告诉高级经理一个故事，而第二天却是个完全不同的故事。不要对呈交的信息有偏见，以显得你是对的，而别人不好。关心的事实应尽可能简洁且开门见山，要知道执行官都是一些大忙人。</p>
<p>当你会见执行官时，不要嘲笑那些不在场的人。这样的行为只能证明你不值得信任，也不够忠诚。</p>
<p>当你呈交信息时，提供事实，而不是关于人们的观点。事实是能够理性处理的东西，即便是不在场的人也能够理性处理的事实。要确保你适当的传递了信息，这样当执行官向有关人员索要事实信息时，即便原先不在场的人也不会措手不及。</p>
<p>我曾经有过一些这样参加会议的经历，执行官召集其他的人一起进入房间讨论，来验证我所给出的所有信息。要确保你讲的故事是想在别人面前重复的，因为你可能有机会立即这么做。</p>
<h5 id="2-3-2-清晰性甚于完整性"><a href="#2-3-2-清晰性甚于完整性" class="headerlink" title="2.3.2 清晰性甚于完整性"></a>2.3.2 清晰性甚于完整性</h5><p>作为一般性的经验方法，给人提供细节信息的数量应当反比于此人在单位中的级别。换句话说，开发者可能需要海量的信息来构建某个东西，而执行官在项目定期更新状态时，只需要有关项目的高度概括性信息。但信息需要清晰、简明扼要。你需要给执行官提供正确的信息，并提供适当的背景，多些商务信息的成分，少些技术信息的成分。</p>
<p>执行官不大可能会顾及所有技术信息。他们想知道你精通技术，但他们没有时间关心所有的项目细节。这样过滤的一个主要原因就是执行官受时间限制，必须工作于信任的基础上。他们寻求将所有权、执行权和照看项目的责任委派给你。他们希望你处理问题、做好规划，以及照顾项目的其他方方面面。</p>
<p>执行官想知道的就是如下这些东西：</p>
<ul>
<li>有哪些风险会导致项目无法如期完成或者按预算完成？风险是否已经得到烤制？</li>
<li>能创造什么战略资产来支持当前或未来项目的需求？</li>
<li>单位中谁是“升起的新星”？</li>
</ul>
<p>执行官要求你提供的是准确的信息。他们希望你保持一致性。一旦你给出一个答案，就应坚持它，所以要谨慎选择你的答案。</p>
<p>有的执行官可能会深入项目的特定方面。你至少应该准备探索这方面。执行官可能借此找出你知识的边界及疏忽在哪里。</p>
<p>开会时，倘若你处于你不知道或不确信某些信息的境地，要明确表达自己不知道，但声明自己随后会关注被问及的这些信息。永远记住：如果你不这样做，你可能会将自己辛苦挣得的信任关系付诸东流。</p>
<p>你和执行官最好的交互过程就是把你的扑克牌都放在桌面上。也就是说，让他们能看清你所有的东西（好的、坏的、丑的）。你可能因为彻底袒露、容易被人挑刺而感觉不踏实。但这样的行为能让你在信任和忠诚方面 - 至少执行官最看重的 - 增加好感。</p>
<h5 id="2-3-3-不要让执行官感到惊讶"><a href="#2-3-3-不要让执行官感到惊讶" class="headerlink" title="2.3.3 不要让执行官感到惊讶"></a>2.3.3 不要让执行官感到惊讶</h5><p>谈到不断积累的问题时，执行官不喜欢惊讶，尤其是那种惊讶：他们必须在很短时间做出行动、剩下的选择少之又少，而结果是他们必须将坏消息通知给单位的其他部门。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part2/06.png"></p>
<blockquote>
<p>执行官不喜欢惊讶。如果你有坏消息，就早些告诉他们</p>
</blockquote>
<p>绝大多数项目的风险是逐渐累积的。从事或接近项目的参与者知道这些风险。如果仔细倾听，你会知道到处都在反映这些信息。遗憾的是，风险发出的隆隆声并不总能让需要听到的人听见。</p>
<p>当人们与高层的管理人员和执行官说话时，他们在本能上会报喜不报忧。结果就是，他们不太想把一些看起来不妙的事情呈递上去。</p>
<p>中层经理不会在来不及处理风险的情况下，乐意被人将风险暴露给他们的上司或其上司的上司 - 那就是，围绕风险的推销问题。如果风险会随时间而膨胀，应尽早暴露出来。通常要有个判断过程来确定何时告诉别人这个生长着的麻烦。没有捷径知道确切的时间。作为一个经验规则，早些暴露远比问题发生为时已晚要好得多，因为后者要迫使高级经理人员和执行官去处理善后事宜。</p>
<p>如果你发现你的上司或管理人员没有将所需的信息沟通给执行官，你可能需要自己呈递这些信息（倘若你决定采取行动，必须极度小心，也许有些你未意识到的因素导致别人那样做）。当你真的呈送消息时，确信所有中层管理人员都意识到了风险。他们需要有机会拟定行为计划来处理这些风险。这仍然是关于信任和忠诚的问题。</p>
<p>当执行官越早知道存在的风险，他们就越能够成功应付它们，并最大限度的降低负面影响。如果执行官被搞得很惊讶，他们不会高兴的。假如你还没有破坏他们对你的信任（你工作非常努力才换来的信任），你可能已经在朝这个方向做了。当晋升机会到来时，你可能不会得到执行官的多少支持，因为你曾经引起他的不快。</p>
<h4 id="2-4-小结"><a href="#2-4-小结" class="headerlink" title="2.4 小结"></a>2.4 小结</h4><p>成为一名杰出沟通者的道路从下列步骤开始。</p>
<ul>
<li>沟通原则：</li>
</ul>
<ol>
<li>先听后说。</li>
<li>专心致志。</li>
<li>正面思考。</li>
<li>尽早道歉。</li>
<li>不要招致恼羞成怒。</li>
</ol>
<ul>
<li>沟通策略：</li>
</ul>
<ol>
<li>多说“是”，少说“不是”；</li>
<li>特殊场合才说“不”；</li>
<li>抑制想自卫的冲动；</li>
<li>倾听建议来改善合作；</li>
<li>了解别人和自己沟通的需求；</li>
<li>才思敏捷。</li>
</ol>
<ul>
<li>与执行官沟通：</li>
</ul>
<ol>
<li>执行官需要信任、忠诚和连贯性；</li>
<li>清晰性甚于完整性；</li>
<li>不要让执行官感到惊讶。</li>
</ol>
<p>对于倾向于做技术的人，例如我自己而言，要成为一名出色的沟通者是充满挑战的。我总是想在分析问题、彻头彻尾地考虑问题的方方面面时，与外界隔绝。通过注重成为一名更熟练的沟通者，不仅使我的职业生活更加有趣，推动了我事业的发展，还丰富了我的个人生活。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/01/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC2/" data-id="cllui4qz9004eq0jabszq4aaf" data-title="关系技能修炼篇&lt;二&gt;" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC/" rel="tag">软件架构师的12项修炼</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-软件架构师的12项修炼1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/04/30/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC1/" class="article-date">
  <time class="dt-published" datetime="2017-04-29T16:00:00.000Z" itemprop="datePublished">2017-04-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/improve/">improve</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/04/30/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC1/">关系技能修炼篇&lt;一&gt;</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="12-Essential-Skills-for-Software-Architects"><a href="#12-Essential-Skills-for-Software-Architects" class="headerlink" title="12 Essential Skills for Software Architects"></a>12 Essential Skills for Software Architects</h1><p>和其他技术人员一样，程序员在钻研技术的时候都很拿手，但往往在与人打交道时比较欠缺，而且做事情时时关注细节，难以对事情形成总体的把握。如何突破由此带来的事业发展瓶颈，是每个技术人员早晚要面临的问题。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part1/01.png"></p>
<p>人们普遍认为西方国家的人好像“不近人情”，其实不论在哪里，“关系甚于正确性”都是成立的。“人情”者，“人之常情”也，每个人都希望被尊重，被认可。同样一件事，说的方式不同，尽管表达同样的意思，却可能会起到截然不同的效果，所以说话是一种很讲技巧的艺术 - 说的委婉动听，对方就乐意接受，心甘情愿按你的意思去办；说的生硬难听，即便再慷慨激昂，真理明明在你手里，对方不愿意听，你的努力还是白搭。我们很多人吃过这样的亏，却茫然不知原因所在。</p>
<p>工作中不仅有技术，不能只埋头于技术，还要有大的眼光、能为公司创造效益，人生才能有所成就。而对这些方面认识浅薄，会对我们的事业发展造成很严重的障碍而不自知。</p>
<p>古文《触龙说赵太后》中就体现了先建立友好氛围才能施加影响的重要性。我们在为人处事的时候，一方面要尽早为自己得罪别人的行为道歉；另一方面，不要对别人的冒犯斤斤计较，耿耿于怀。即便别人不道歉也不要计较。但凡有人的地方，都有“人情”存在，都要讲究人际关系。人与人之间相处的方式，都有共同的为人处世原则。</p>
<p><code>软的东西总是比硬的东西还硬。 - 罗杰·恩里科</code></p>
<h2 id="Part-1-关系技能修炼"><a href="#Part-1-关系技能修炼" class="headerlink" title="Part 1 关系技能修炼"></a>Part 1 关系技能修炼</h2><p><code>“技术”不能让一个企业运转起来，而“关系”能。 - Parricia Fripp</code></p>
<p><code>成功公式的一个最重要因素就是要明白如何与人相处。 - 西奥多·罗斯福</code></p>
<p><code>我确信再也没有什么事情比雇佣人并开发人的潜能更重要了。最终，你是靠人来决胜，而不是靠战略。 - Larry Bossidy</code></p>
<p><code>如果你想让某个人与你为敌，只要告诉他“是你错了”。这个办法屡试不爽。 - Henry C.Link</code></p>
<p><code>交谈的真正艺术在于不仅在正确的地方说出正确的事情，还在于冲动的时候不要说出错误的事情。 - Dorothy Nevill</code></p>
<ol>
<li><p>文雅的举止：要在任何处境下都应保持与别人文雅相处。</p>
</li>
<li><p>沟通：与他人有效交互。</p>
</li>
<li><p>协商：讨论将事情办成。</p>
</li>
</ol>
<h3 id="文雅的举止"><a href="#文雅的举止" class="headerlink" title="文雅的举止"></a>文雅的举止</h3><p><code>行为是每个人展示自身形象的镜子。 - 约翰·沃尔夫冈·冯·歌德</code></p>
<p><code>对人品的整整考验并非是我们知道怎么做，而是当我们不知道怎么做时如何做。 - John W.Holt,Jr.</code></p>
<p><code>按你想的方式行事，不久你就会有你自己的行事方式。 - George W.Crane</code></p>
<p>作为一名架构师，你需要和单位中的各色人等打交道。要在这个位置上真正取得成功，你需要从你所遇到的每个人那里汲取上级的主意和思想。调动所有人（包括你不赞同，甚至不愿相处的人）积极性的最好办法之一是你在任何环境中都举止文雅、专业。</p>
<p>举止文雅是FIRST Robotics要求的基本技能。FIRST Robotics是一个致力于激励年轻人成为科技领头人的机构。“举止文雅”主张人们工作时显得文雅、专业。</p>
<h4 id="１-１-别人怎么评价你"><a href="#１-１-别人怎么评价你" class="headerlink" title="１.１　别人怎么评价你"></a>１.１　别人怎么评价你</h4><p>如果我准备去见一些了解你的人，例如你的邻居、同事、家人等，他们会怎样评价你呢？</p>
<ul>
<li>他们会说你工作努力吗？</li>
<li>他们会说你正直诚实吗？</li>
<li>他们会说你举止文雅吗？</li>
<li>或者，他们会列出一长串软技能清单，认为你是个典型的技术人员，在技术领域没得说，但在软技能方面不怎么样？</li>
</ul>
<h4 id="1-2-技术之天花板"><a href="#1-2-技术之天花板" class="headerlink" title="1.2 技术之天花板"></a>1.2 技术之天花板</h4><p>对于技术非常棒的人（当你遇到难题必须解决时，向这些高手求助总能圆满解决）而言，一个挑战就是他们通常很难相处。他们与人沟通的方式或方法完全集中在细枝末节的正确性上。这种描述是不是听着有些耳熟？</p>
<p>通常，你很少能坚持到谈话结束，因为这些人对最小的错误变化都详细地进行分析。当你听完问题的解释，你可能已经很累了。</p>
<p>在他们回来时，问题以得体的方式解决了，客户很高兴。但下次你需要请他们做事时，你总是会权衡要解决问题所花费的个人成本。你会扪心自问：“这样做真的值的吗？”</p>
<p>到了考核的时候，这些技术牛人总是因其卓越的工作得到如潮的评价，可是通常没人注意到对他们那点糟糕的软技能的反馈，或者只是很少提及。年复一年，他们实现工作的方式被当作是游戏的。然而遗憾的是，他们在单位内往上爬的技术障碍也变得越来越大。</p>
<p>随着时间推移，在这个情形下的人会寻求升职，他将面临一些挑战。一个关键的困难在于，高级别的管理者不愿意被低职位的人批评。结果是，位于这种人和执行官之间的经理或主管不大乐意结交那些会揭露其短处给执行官的人。</p>
<p>吃技术饭的人无疑是很有才能的，他的问题在于总需要单位中有人牵头才会向前迈动一步。如果经理或者主管打算利用某个机会让这个“有才能”的人参加某个会议，执行官却在会上被嘲讽，那么执行官会对这种人的第一印象就是负面的，可能要经历数年才能摆脱这种糟糕的第一印象。经理会由衷的后悔给予他的这个机会，而不想重复类似事件。于是，有技术才能的人的升职天花板变得更厚了。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part1/02.png"></p>
<blockquote>
<p>大多数时候所谓的“技术之玻璃天花板”其实只是缺乏软技能而已。这些技能可以学到，缺乏的知识可以通过决定改变的努力来弥补</p>
</blockquote>
<p>对于技术上的某些人，这样的灾难也使他们认为技术上没有才能的人爬上了管理岗位。在某种程度上，这种想法是真实的，尽管社交能力强的人步入管理岗位依靠的不仅仅是这个因素。特别是，这些人比其他人有更合适的技能，更善于沟通。</p>
<p>对于更高职位的人而言，深谙技术细节固然有用，但能力已经开始向与别人成功交互方向倾斜，为了将事情办成而推销其观点。从技术专家的角度看，他们提出的解决方案只是纯技术性的，足以被人接受 - 事实仅此而已。他们经常相信解决方案无需推销，所有人都应该赞叹该解决方案的完美。</p>
<p>有些时候，技术人员会无法理解：任何一个项目其实都需要考虑方方面面的因素。在许多案例中，解决方案仅仅要满足用户的需求，并不需要被镀金 - 尽管反复修改，再修改以趋近完美在技术上是很有趣的。</p>
<p>产品需要使支付账单的人的投资得到最大可能的回报。这通常意味着需要挤入更多可能“并不完美”的功能，但事实上只要成本控制的足够好，能够赚到足够多的钱，并在适当时间内满足市场需求就行了。通常竞争的产品都是在开发中的，公司需要首先推向市场，以赢得领先地位，以便令产品卖个好价钱。其他时候，其他一些因素也会同时发挥作用，例如重新为产品设定平台、维护品质、保持成本可控等，这些也会成为主要的驱动力。</p>
<h4 id="1-3-变得文雅、专业的途径"><a href="#1-3-变得文雅、专业的途径" class="headerlink" title="1.3 变得文雅、专业的途径"></a>1.3 变得文雅、专业的途径</h4><p>通过以下步骤实现文雅的举止：</p>
<ul>
<li>注重关系甚于争执孰对孰错</li>
<li>学会委派</li>
<li>认识到生活是有反作用的</li>
<li>说到做到</li>
<li>与别人相处时真诚、正直、不呆板</li>
<li>以适时的行为应对问题</li>
<li>提供专业的服务</li>
<li>原谅、遗忘别人以往的冒犯</li>
</ul>
<h5 id="1-3-1-关注关系甚于争执孰对孰错"><a href="#1-3-1-关注关系甚于争执孰对孰错" class="headerlink" title="1.3.1 关注关系甚于争执孰对孰错"></a>1.3.1 关注关系甚于争执孰对孰错</h5><p>学习变得文雅、专业的首个原则就是注重关系甚于争执孰对孰错。</p>
<p>在职场中，关系就是一切。它们决定了哪些项目或工作可以进行，也决定了如何激励人们为你的“高优先级”项目工作。</p>
<p>在日常经历中，我们不得不提高嗓门，以便别人听到。我们认为自己的思想、计划、设计、方法、事实、假设都是正确的，以此为出发点来行事。通常在谈话中间，我们会听到感觉不对的地方，并有强烈的欲望来纠正错误的想法。在分享我们的“正确”时，要记住有人曾说过“等待是智慧”。</p>
<p>从软件开发和工程观点来看，我们被训练成要“挑刺”（挑那些不完美之处），并迅速去除这些瑕疵（我们都有各种办法来应对这些任务，例如结对编程、单元测试、功能测试、压力测试、代码走查等）。挑战来自不争的事实，那就是“人并非软件”，我们不能把它们的不足赶走 - 何况大多数时候，我们对他们缺点的感觉来自于自己的主管臆断。</p>
<p>请扪心自问以下几个问题：</p>
<ul>
<li>这样纠正真的重要吗？</li>
<li>如果我不提的话，公司会为此付出很大成本吗？</li>
</ul>
<p>答案通常都是“不是”。你最好的做法就是保持平静，即便你是正确的。寻求对他人维持正直与权威，在别人愿意的时候提供有价值的深入分析，以及找个机会，供别人以一种相对平静的行为来了解。最好的指导原则是让别人产生发自内心的很大兴趣，并使用你最好的判断能力来想出如何处理的方法。</p>
<p>就我自己的工作而言，我发现以自己的有限视角看世界，即注重关系甚于注重“正确性”，能使我很自然的以协作的氛围开始工作，它自然而然的让我进入一个状态，能倾听别人说的话，使别人乐意将我的假设条件可变的摆在台面上，因为简历关系比争执孰对孰错更重要。</p>
<blockquote>
<p>注重关系甚于孰对孰错：以人为本</p>
</blockquote>
<p>会谈开始后，这样的结果能够起到增效作用。这样的氛围能鼓励人们提出、检查最好的想法，潜在的舍弃或重组为新的、更好的思路，这比哪个人（包括我自己）独自构想要好得多。</p>
<p>一旦人们相信你是担着风险提出想法的，并愿意开诚布公地让别人自由地改进这一想法，他们就会聚集到台面旁，发挥主人翁的作用。关键时刻，你的那些伙伴突然变得感觉安全起来，开始贡献他们的聪明才智。</p>
<p>相反的情况也会出现。事实上，如果你不够开放，不愿意让你的金点子做任何改动，你大声说其他人都应该靠边站，这就是在筑篱笆。你就会变得令人敬畏。“要尊敬、不要碰” - 这有点像是在博物馆看展览。记住一个关键的考虑点就是，优雅的正确性和责任只在一线之间 - “情人眼里出西施”。</p>
<p>你要追求的氛围应当是大家共享的花园，思路在这里百花齐放，百家争鸣，而野草也允许被剔除。通过这种办法，你会看到别人带上台面的价值。他们独特的看法能够消除某个思路的软肋，而这也是作为开发者的你还没有察觉到的。在太多的实例中，我们观察世界的角度很容易就让我们对所提出解决方案的潜在错误熟视无睹。</p>
<p>在某个特定点上，我们需要选择方向。这时，所有人都应参与，审视所做出的决定，即便最终选择的方向并不是他们最初选择的。</p>
<p>只要一个想法不是只游动于开发者自己的认知世界中，这样的想法几乎总是能够得到改进。我一直对大家拥有的海量思路感到很吃惊。只要这些人觉得自己是在安全的环境中，他们总是愿意与别人分享他们的想法。</p>
<p>每个人都乐于交谈，乐于将其想法添加到这个“生态系统”中。一旦你的同事愿意奉献，他们就会有主人翁的态度，并期望贡献更多的想法。通常，人们最先提出的少数几个想法是“安全”的，他们是在试水，看看水里有没有鲨鱼。如果水是安全的，他们就会提出他们最好、最聪明的思路。</p>
<p>我曾经吃惊的发现，一个最初看起来很弱智的想法如何逐步成为增强某个麝香的关键因素，这是解决方案的多维本质所积聚的力量。想想一块胶合板吧，并不是其中哪一单独的层使板子很结实，而是所有这些层叠压在一起，才使板子强度很大。</p>
<blockquote>
<p>据我以往的观察，某些人被解雇的前几条原因之一就是其关系搞的很差。从现实意义来说，最大的利益在于学会简历关系，选择注重关系而非正确性。</p>
</blockquote>
<p>当你注重关系甚于正确性时，你就能水到渠成地建立和维护一个专业网络，使你能够在未来的机会中有资本可用，并在艰难时段中维持有安全裕度。</p>
<h5 id="1-3-2-学会委派"><a href="#1-3-2-学会委派" class="headerlink" title="1.3.2 学会委派"></a>1.3.2 学会委派</h5><p>当你在事业中有所进展，并担当个更高的领导职位时，你必须不可避免的允许别人接手项目的一部分并将其完成。</p>
<p>要实现这一进化，一个关键的概念是允许别人参与决定解决问题。如果允许某人贡献思路，他就会有主人翁的态度，他就会接手项目运作它。从现实意义来说，这成了他自己的事情。</p>
<p>架构师通常只能建议某些思路，他们不像主管或经理有直接管理的权力。这使得他们只好去推销自己的架构想法。</p>
<h5 id="1-3-3-生活是有反作用的"><a href="#1-3-3-生活是有反作用的" class="headerlink" title="1.3.3 生活是有反作用的"></a>1.3.3 生活是有反作用的</h5><p>你是否注意过你的言辞和行动对你是有反作用的？如果你想过这个问题，哪怕只想过一点，你的行为就会永久改变。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part1/03.png"></p>
<blockquote>
<p>反作用就像一面镜子，你的所作所为都会反射到你自己身上</p>
</blockquote>
<p>在生活中，我们选择如何与我们打交道的人产生反应。他人如何说、如何做其实并不重要，重要的是，我们能否选择反应文雅。</p>
<p>倘若我们不管怎样都能表现文雅，我们就会在离开这个处境时感觉到自己的宽宏大量。在许多环境中，脱离所处的环境就有可能误解别人的意图。这个人的生硬或者感觉迟钝的评价可能和半小时前他（她）经历的糟糕交谈有关，而这个人现在还带着情绪。</p>
<p>对文雅举止特别不利的一种情况是，在我们已经做了某件事，且充满热情的期待好的评价时，却得到了消极的反馈。许多时候，一个人仔细检查工作后，并不想收到消极评价，他会把消极批评看作是个人攻击而不是对工作的评价。</p>
<blockquote>
<p>工作时建立合适的期望值，以供别人反馈和审视，这有助于你建立信任的气氛。</p>
</blockquote>
<p>建立合适的期望值有利于提出最好的思路。允许别人提出建议的改正办法而没有冒犯之意。通过开放式的交谈，提出新的、创造性的替代办法 - 将帮助工作成果真正得到改进。</p>
<p>当进行审查（任何审查）时，在情理上做好下列准备：</p>
<ul>
<li>听。准备接受反馈，并期望改变 - 如果合适的话，配合别人的反馈，直到此人有机会完全表达出其思想后，再有所反应。在最大限度上请求审查者澄清或解释他（她）所说的话，以确保你已经理解这些话语了。</li>
<li>不要狡辩。狡辩是个自然的反应，你会丧失有价值的信息，得罪试图帮助你的人（是的，所有审查者都在试着提供帮助）。</li>
<li>举止文雅。你应当压倒一切的保持这个想法。在你反应之前仔细想好，以免有讽刺挖苦效果。你可能认为尖锐的评论滑稽可笑（很可能会一笑了之），这样不会与你所评论的人建立良好的关系。你不经心的一句话语可能伤及别人的感情，让他们对你有消极的看法。所以要扪心自问：“这么评论真的值得吗？”</li>
</ul>
<p>如果我们不对事情抱以文雅的态度，就会得不到文雅的回应。</p>
<p>准备一场评审的最好方式就是预先基于所公布的条目设定你对会议的期望值。确保每个人都明白“所有”反馈都是受欢迎的。</p>
<p>然而糟糕的是，由于出席会议人员的关系，某次会议的负面印象可能对你的事业有着长远的影响。如果你发现自己身处于无法举止文雅的态势，就要立即谦逊的道歉，并且诚心诚意。如果日后你认识到自己在先前某个会议上得罪过某人，就去找他认错。这样做起来很难，你会感觉不自在，而且你的尊严会被伤害一点儿（别担心，很快就会恢复的）。</p>
<p>但是，倘若我们没有道歉，就会在人际关系方面筑起一道墙，这将成为以后晋升的障碍。更糟糕的是，我们可能丧失升职的基石。关系对于这个世界的事业成功时必须的，所以应该用心去经营它们。</p>
<blockquote>
<p>经营关系的一部分就是文雅的接受反馈</p>
</blockquote>
<blockquote>
<p>才能与讨人喜欢之间的关系</p>
</blockquote>
<blockquote>
<p>2005年，哈佛大学的Tiziana Casciaro和杜克大学的Miguel Sousa进行了一项寻找人望与才能之间的关系的研究。他们的发现很有意思：“如果哪个人惹人讨厌，他（她）是不是有才能都几乎没区别，因为人们不愿意和他共事。对照起来，倘若某个家伙人见人爱，他的同事就会想方设法的找出他的哪怕一丁点儿才能。”</p>
</blockquote>
<p>从我的经历来看，在一个单位中表现刻薄的人会导致人们不愿意与他沟通，并且不信任他，他自己也会越来越焦虑。造成的结果是，与单位里的其他伙伴一道工作的能力极大下降。整个团队的生产效率下降，问题解决的质量降低。最后，刻薄的人会离开这个单位，或者他们影响别人的能力大打折扣。</p>
<p>我们应理解一个关键的概念是，学会将我们需要的举止、行为和言辞反射回我们，如此我们才能逐渐成为文雅的专业人士。</p>
<blockquote>
<p>记住这个黄金法则“你怎样对待别人，别人就会怎样对待你”（《马太福音》7.12）</p>
</blockquote>
<h5 id="1-3-4-有效沟通之生与死"><a href="#1-3-4-有效沟通之生与死" class="headerlink" title="1.3.4 有效沟通之生与死"></a>1.3.4 有效沟通之生与死</h5><p>在你说话的时候，你其实是在为你的沟通发出生与死的话题。它们可以筑起高墙，也可以使墙倒塌 - 所以应当小心你所说的话。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part1/04.png"></p>
<blockquote>
<p>你想要什么样的庄稼？那就播下相应的种子吧</p>
</blockquote>
<p>不要说某人的坏话。尖酸刻薄的话语会对你和那人的关系有负面影响。这种行为就像野草那样生根发芽成长。所以一定要谨慎你的说辞。这些话是积极的还是消极的（应该选积极的），它们会增进关系还是破坏关系（应该选增进关系）。</p>
<p>通常情况下，你应当找机会去增进关系。在你进行沟通时，可以表达出许多方式如思路、概念、信息等。要选用哪些表达你想表达出消息内容的恰当词语，还要顾及你所沟通的人所处的环境。</p>
<p>你要发出的消息应当根据他人或群体的情绪而精心准备。如果你有机会在某天与执行官一起走路，你很可能会发现这个人在沟通技巧上是个高手。</p>
<blockquote>
<p>执行官与他们个人化的沟通风格</p>
</blockquote>
<blockquote>
<p>几年前，我与一位执行官沿着门廊走路。路上，我们遇到了几个人，每个人都需要与她说会儿话。让我吃惊的是，她用的语言、所选择的对话风格以及她的语调因人而变。她切换语境完全依据特定的人，使每段谈话对此人富有意义。<br>有趣的是，在门廊里遇到的人的级别是从一个软件开发者开始的。在我们沿着门廊走过时，职员的级别越来越高，直到老板。给我印象深刻的是，她迅速切换语境是在这5~10分钟完成的。我感觉到说什么不重要，重要的是怎样以一种适当的途径来给对方传递信息。<br>许多成功的权力人士如比尔·克林顿，马格莱特·莱特切都有个共同点，就是他们有基于谁在场来动态切换语境的能力。</p>
</blockquote>
<p>我是一个认为技术是宇宙中心的人。我喜欢思考，考虑技术的方方面面，并沉迷于其中。“推销”这个词 - 根据我要对话的人来改变我想传递消息的语境 - 对我来说，是个遥远、模糊的话题，我不得不有意这么做好多年。</p>
<p>当你听到别人说的话时，可以有许多方法来解释其消息。通常我们倾向于听取话语里的“负面”内容，以我们的立场来解释他们表达的意思，我们甚至常常不综合理解所听到的信息。</p>
<p>通常，最好的办法就是从正面理解别人说的东西。即便你不能管控那些事情，但还是应当试着忽略或者忘掉看来是负面的内容。如果你收到负面的评价，并让它们生根，久而久之就会影响你和那个人沟通的方式。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part1/05.png"></p>
<blockquote>
<p>即便收到消极的消息，仍要做出积极的反应</p>
</blockquote>
<p>总是以文雅的方式来做出反应（不要试图对别人以牙还牙，这样无济于事）。如果对方的消息真的有冒犯之意，直接处理之，让对方知道你不赞同或不喜欢类似的这种评论或行为。如果对方一而再、再而三的做出这种评论或行为，你可以要求其上司介入。</p>
<p>对于架构师这样的角色，其实推广至一般的生活，维护、积累良好的人际关系是必不可少的。实现这个目标的最好的方法之一，就是发表和听取有正面影响的话语。</p>
<h5 id="1-3-5-要正直诚实而不是率直"><a href="#1-3-5-要正直诚实而不是率直" class="headerlink" title="1.3.5 要正直诚实而不是率直"></a>1.3.5 要正直诚实而不是率直</h5><p>在架构师的世界里，正直与信任对成功时非常重要的。其挑战就是如何以某种不得罪人的方式来表达你的信息。两种截然不同的挑战是：</p>
<ul>
<li>以“正直诚实”而非率直的方式来表达信息。否则，由于你的直言不讳，你想帮助的人也许被彻底得罪，以致不愿再听你说的任何有用信息。</li>
<li>为了小心翼翼不得罪某个人，你为要说的话裹上糖衣，以致需要的信息没有被表达出来。</li>
</ul>
<p>我们来更仔细的看看率直的方面。在表达完信息后，你还想与此人保持良好的关系。人们时常会收到不必要的冒犯，或者表现出自我防护，仅仅因为重要信息以一种糟糕的形式表达出来。</p>
<blockquote>
<p>正直不能用蛮力实现</p>
</blockquote>
<p>这里是一些关键的问题，在你感觉要“绝对诚实”的表达时考虑：</p>
<ul>
<li>这些信息会对将来事件有深远影响吗？（如果没有，为什么要翻旧账呢？过去的事情就让它过去吧。）</li>
<li>信息是否会被误解？（你需要确保摆明了清楚的语境。）</li>
<li>在此问题上，你在避免个人化情绪吗？（好像你想攻击这个人，而不是解决问题。）</li>
<li>这次谈话后，你还想保持与这个人或群体的宝贵关系吗？（终其一点，关系总是比单独的问题重要。如果这个问题总是发生，你可能有必要直接一些。）</li>
<li>如果情况逆转，你会感觉如何？</li>
<li>这个人或群体是否已经意识到你要表达的信息了？他们是否采取了纠正的措施？（不要让业已指出的情况继续存在。相反，要找到切人的办法并提供帮助。）</li>
</ul>
<p>当你要求采取纠正措施时，应提供关键性的信息，否则对方容易情绪化，不假思索的脱口说出一些“生硬”话语。</p>
<ul>
<li>你是在与恰当的人或群体交谈吗？如果不是，你是在尝试获取怎样处理这一形势的建议，或者仅仅与别人闲聊而已？</li>
<li>你是否掌握了所有必要的信息？</li>
<li>你所拥有的信息准确吗？</li>
<li>你是否从所有相关方面听取信息？</li>
<li>你是在呈现事实而不是结论？（也许你得出的结论并无现实依据）</li>
<li>这件事情是否在以及时的方式处理？在一个月内是否会有问题？人们会不会记住你所谈到的话？</li>
<li>你为何赞成做这个任务（例如：只是为了避免冲突、避免承担责任，或者你被要求这么做）？</li>
<li>你在咖啡机旁边还是在会议上“抱怨”这个情形？在会议上以得体的方式与别人分享你的想法，会后向别人抱怨则没什么用。但如果问题是关于某个人的，有必要与那个人私下交流。）</li>
<li>当你在会议上被问起有什么要发言时，你是将未解决的问题和关心的问题拿上台面，还是以后在门廊谈话时抱怨两句。如果你提不出问题，你能指望永久平静下去吗？</li>
</ul>
<p>在许多方面，问题就像花园里的杂草。你不比总是立即清除它们，但通常情况下你最好赶快处理它们，以免后患。</p>
<h5 id="1-3-6-不要掩盖问题-它们以后还会冒出来"><a href="#1-3-6-不要掩盖问题-它们以后还会冒出来" class="headerlink" title="1.3.6 不要掩盖问题 - 它们以后还会冒出来"></a>1.3.6 不要掩盖问题 - 它们以后还会冒出来</h5><p>你会不会因为惧怕后果而避免处理某个特定的问题？你是否害怕面对它？通常情况下，事实并没有我们想像的可怕。我们在生活中面临的许多问题都像是考试，直到通过了考试，直到能自信的对付它，我们才会得到反复处理这一问题的机会。</p>
<p>当你开会时，在会上被问及你是否赞同对一个项目所提出的执行方向。在你的意识中，你听到有个柔弱的声音在说“不赞成”，然而你却点头表示赞成？会议结束后5分钟，你和一小簇人在一起，他们谈到会议敲定的方向，指出它在若干情形下的毛病，而你也会插嘴，说出所选方向的更多问题（这些问题正是你在内心里不赞成的原因）。</p>
<p>数月过去了，项目遇到了大问题。你回忆起在门廊谈话时已经谈到的那些问题，此时你就会意识到，当前的困难和艰苦其实是可以避免的，前提是会议结束后在门廊谈话的其中一位能在会上大胆提出这些问题。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part1/06.png"></p>
<blockquote>
<p>掩盖了的问题最终会演变成现实的问题，所以我们现在就处理掉它们</p>
</blockquote>
<p>这些听起来是不是很熟悉？我就有这样的亲身经历，在我的职业生涯中不止一次。</p>
<p>久而久之，我学会听取那个纤弱声音“不要这样”的意见。现在，当开会要表决时，会有一个最终的点名。如果我不赞成，我会说“不”，然后我们会审查这些问题。有些时候，这只是证明我们都达成了同意，仅有一些细节需要澄清；有些时候，也证明我们并不都同意，但是同意所选的方向是摆在面前的最好选择。</p>
<p>会后，如果我听到他人在讨论有关会上决定的“问题”，我会记下必要的问题点，供每个人将来听到，然后建议在下次会议上讨论，或者重新召集会议来审视决定。</p>
<p>处理面临的困难：如果不处理这个问题，它将会长大，变成真正的问题。面对难题并不是有趣的事，但如果现在不提它们，他们就会在未来发展成切肤之痛。</p>
<h5 id="1-3-7-提供专业的服务"><a href="#1-3-7-提供专业的服务" class="headerlink" title="1.3.7 提供专业的服务"></a>1.3.7 提供专业的服务</h5><p>架构师的角色就是提供服务的人。你需要提供最高品质的服务，不管你如何感受，别人如何对待你，或者你脑海中有多少种不同的思路在活跃。这里只有别人和你要试图提供的服务，而不是你自己。</p>
<p>你是否已经注意到，大多数管理层的人都曾经在这个行业工作了多年？</p>
<p>你是否有过需要直接与客户定期交流的情况？我有过，我可以确定这样的经历会直接影响你与别人交流的方式。我自己的一些经历包括邻居的院子除草，作为职业高尔夫商店的店员，作为药店的店员，教授数学课，及当过饭店的侍者。我当时并未意识到，但所有这些工作都对我产生了影响，而且至今还以我从未想到的方式继续影响我。</p>
<p>回想一下，上次你去购买东西时，为这次购买交易而感到非常高兴。那个售货员怎么样呢？他或她表现得如何？现在你试着模仿他（她）的举止。有些你能做到，有些不能 - 但你至少要试试。</p>
<p>让我们回忆一下一些基本点：</p>
<ul>
<li>学会微笑（让人觉得平易近人）。</li>
<li>学会正确的姿势（站直或左下，脚在正下方，抬头挺胸）。</li>
<li>学会在小规模谈话时让别人参与（预先准备好谈话内容，让别人感觉自在，开始建立关系）。</li>
<li>学会关注别人，而不只是你自己（关注周围的其他人）。</li>
<li>在什么地方说什么话（对你而言，最重要之处在于你所处的位置，不然你在这儿做什么呢）。</li>
<li>学会为别人提供帮助（别人需要什么，你如何最好的帮助别人）。</li>
<li>学会关心他人（这个世界不只有你自己一个人）。</li>
<li>学会友好（成为朋友，你交往的人越多，越能从工作中得到更多的乐趣）。</li>
<li>学会建立信任关系（说到做到；如果你与某人有过节，直接与那人处理问题，而不是拿这与别人说事）。</li>
<li>学会说“是”（不要找借口逃避责任或困难，有没有替代方案让你说“是”）。</li>
<li>学会倾听（重复你听到的话，不要下结论，问一些真正有用的问题）。</li>
<li>要知识渊博，共享信息而非结论。</li>
<li>允许对方选择（引导决定的最好方法之一就是不要“我说了算”，而是提供几种可选的替代方案 - 这样会让别人以主人翁的态度参与。如果你下次去餐馆的话，观察一下你与服务员的交流过程）。</li>
<li>不要不务正业，走入歧途。</li>
<li>把握讨论的整体语境，不重复不必要的信息，或者跑题。</li>
<li>对于更高级的架构师，记住执行官也是人，他们与你一样对沟通有同样的期望、恐惧和忧虑。把他们看作普通人，他们也是如此反应的。如果会议看起来要发展的斥责的情况，试着说：“我不想说话鲁莽，但这样争吵斥责有助于我们解决问题吗？”</li>
</ul>
<p>当你把架构活动看做一项服务时，你对于想要达成的东西就有了正确的认识：为别人服务是想生产卓越的产品，从而使你的公司有所进账。</p>
<h5 id="1-3-8-忘掉以前的冒犯"><a href="#1-3-8-忘掉以前的冒犯" class="headerlink" title="1.3.8 忘掉以前的冒犯"></a>1.3.8 忘掉以前的冒犯</h5><p>作为架构师，你需要能够与别人一道工作，不管你喜欢他们还是讨厌他们，或者他们对你好还是不好。</p>
<p>如果你与某个人有了不快的经历，你应该原谅他，将此“冒犯”驱除出你的大脑。如果你总惦记着这种不快的事，你就像背着一个包袱。背着一小袋包袱也许没什么，但日积月累到一大麻袋石头就不好办了，它会影响你甚于影响别人。</p>
<p>在你觉得被得罪时，请想想下列这些事情：</p>
<ul>
<li>过了一两天，如果对方不大可能记住那些得罪你的评论或行为，说明这个人已经将注意力转移到别的事上，你也应当这样。</li>
<li>对方的行为可能在所有地方重复着，可能这是他（她）对人普遍的一种坏做法，而不只是针对你这样。这个人也许只不过出于习惯，而不是故意想得罪谁。他并没有意识到其行为对别人的影响。</li>
<li>也许是对方对刚刚发生的某件事做出的反应，而你“正好”是他要打交道的下一个人。</li>
<li>对方的话语或想法也许没经过深思熟虑，也许还在考虑中，没有表达正确而已。</li>
<li>即使对方果真是要用话语或行为表达破坏作用，但是你的状况仍然不错 - 至少没有收到毒药，将它留给侵犯者吧（倘若需要的话，可以减少与此人的接触，直到你能与之平静的交往）。</li>
<li>大多数情形能够随着时间而逐渐恢复，尽管可能要花几年时间。最后，这个人会改变或者被改变。</li>
<li>有时，你想着是事实（宇宙中的一些道理）的东西最终证明完全不正确。你猜想这个人做了某事，实际上他并没有做。对于某人的一些行为，你想到的“原因”纯粹是主观臆断。那个人也许只是出于本能才这么做，从来不是故意冒犯。出现问题是因为你基于有限的信息而对情形做出了不当反应。</li>
</ul>
<p>如果你手头只有有限的语境信息，就应对所发生的事往好的方面解释。在我们有限的感知中，我们仿佛是宇宙的中心。而事实上，你周围的每个人都以其自己的语境行事。而你只有有限的影响力，所以你受到的冒犯只是你自己的感觉罢了。</p>
<p>当有人得罪时，应选择轻装前进。这个办法会让你快速容易地处理新机遇。其实别人并不在乎你所背的包袱，既然如此，就不要背任何包袱。即便你不对特定的某个人述说你的包袱，这仍然会影响你以后与他打交道的方式。你的肢体语言和眼睛会告诉他们的。</p>
<p>所以，就像好的WEB服务一样，你应采用“无状态”的方式 - 只对当前输入做出反应（而不是对很久很久之前被你不正确对待的经历，也许别人早忘了这事儿）。毕竟你的脑子只能立即处理有限的几件事。不要将你的有限精力浪费到过时的、无用的信息上（即要做到“无状态”）。</p>
<p>在心里记住别人的最佳利益。因为生活是有反射的，你的最佳利益可以反射回你自己，照顾好它们。生活就是那么奇怪。大多数有价值的事物都需要曲折的路径。也就是说，别人对你很好，正是因为你对他们好。不要对别人以牙还牙来实现友好，这样不可能做到。</p>
<p>即便你所交往的人真的是垃圾，你也应该因为自己宽宏大量而感觉良好。如果没有别的东西，纯粹出于自私的原因，也因该以积极的态度响应。这样能帮助你确保心智健全，而避免去找心理医生。</p>
<p>将每天看成新的一天，充满新的挑战。记住你沿路学到的知识，而不是那些不快的事情。你会真正成为一个幸福的人。</p>
<h4 id="1-4-小结"><a href="#1-4-小结" class="headerlink" title="1.4 小结"></a>1.4 小结</h4><p>通往文雅举止之路要经过以下几步：</p>
<ul>
<li>选择关系甚于争执孰对孰错；</li>
<li>学会委派；</li>
<li>生活是有反射性的；</li>
<li>说到做到；</li>
<li>与他人相处时真诚、正直、不呆板；</li>
<li>以适时的行动应对问题；</li>
<li>提供专业的服务；</li>
<li>原谅、遗忘别人以往的冒犯。</li>
</ul>
<p>对于倾向于做技术的人，举止专业、文雅不仅使人生活的更加有意思，还能创造成长和进步的新机会。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/04/30/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC1/" data-id="cllui4qz80048q0ja51h565bj" data-title="关系技能修炼篇&lt;一&gt;" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC/" rel="tag">软件架构师的12项修炼</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Nginx配置https" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/04/27/Nginx%E9%85%8D%E7%BD%AEhttps/" class="article-date">
  <time class="dt-published" datetime="2017-04-26T16:00:00.000Z" itemprop="datePublished">2017-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/04/27/Nginx%E9%85%8D%E7%BD%AEhttps/">Nginx配置Https</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、生成证书"><a href="#1、生成证书" class="headerlink" title="1、生成证书"></a>1、生成证书</h2><p>用java jdk自带的keytool生成keystore密钥文件，<a target="_blank" rel="noopener" href="http://www.micmiu.com/lang/java/keytool-start-guide/">更多信息</a></p>
<pre><code>keytool -genkey -alias casserver -keyalg RSA -keysize 1024 -keypass lumingclient -validity 365 -keystore d:\sso\casserver.keystore -storepass lumingclient
</code></pre>
<p><img src="http://i.imgur.com/hXp5XSB.png"></p>
<blockquote>
<p>截图中需要输入的姓名和上面hosts文件中配置的一致（也可以是主机名） ;</p>
</blockquote>
<blockquote>
<p>keypass 和 storepass 两个密码要一致，否则下面tomcat 配置https 访问失败。</p>
</blockquote>
<h2 id="2、导出私钥（需要安装openssl）"><a href="#2、导出私钥（需要安装openssl）" class="headerlink" title="2、导出私钥（需要安装openssl）"></a>2、导出私钥（需要安装openssl）</h2><p>包括pem证书和key密钥。</p>
<h3 id="1、用keytool将keystore文件转换为PKCS12-文件"><a href="#1、用keytool将keystore文件转换为PKCS12-文件" class="headerlink" title="1、用keytool将keystore文件转换为PKCS12 文件"></a>1、用keytool将keystore文件转换为PKCS12 文件</h3><pre><code>keytool -importkeystore -srckeystore d:/sso/casserver.keystore -destkeystore d:/sso/newkeystore.p12 -deststoretype PKCS12
</code></pre>
<p><img src="http://i.imgur.com/wHdz5fC.png"></p>
<p>如果需要查看新的密钥中的列表内容，可以用</p>
<pre><code>keytool -deststoretype PKCS12 -keystore d:/sso/newkeystore.p12 -list
</code></pre>
<p>进行查看。</p>
<p><img src="http://i.imgur.com/vyqBzD7.png"></p>
<h3 id="2、用openssl生成pem公钥文件"><a href="#2、用openssl生成pem公钥文件" class="headerlink" title="2、用openssl生成pem公钥文件"></a>2、用openssl生成pem公钥文件</h3><pre><code>openssl pkcs12 -nokeys -in d:/sso/newkeystore.p12 -out certfile.pem
</code></pre>
<h3 id="3、用openssl生成key私钥文件"><a href="#3、用openssl生成key私钥文件" class="headerlink" title="3、用openssl生成key私钥文件"></a>3、用openssl生成key私钥文件</h3><pre><code>openssl pkcs12 -nocerts -nodes -in d:/sso/newkeystore.p12 -out keyfile.key
</code></pre>
<h3 id="3、配置nginx密钥"><a href="#3、配置nginx密钥" class="headerlink" title="3、配置nginx密钥"></a>3、配置nginx密钥</h3><p>找到nginx主配置文件，然后依次按如下步奏操作：</p>
<ol>
<li><p>找到https位置</p>
</li>
<li><p>放开https注释– “#”为注释</p>
</li>
<li><p>默认https端口为443</p>
</li>
<li><p>为nginx配置密钥和私钥（即上述步骤生成的pem和key文件）<br> <code>ssl_certificate       D:/sso/casserver.pem;</code><br> <code>ssl_certificate_key   D:/sso/casserver.key;</code></p>
</li>
</ol>
<h3 id="4、配置访问规则"><a href="#4、配置访问规则" class="headerlink" title="4、配置访问规则"></a>4、配置访问规则</h3><p>配置nginx的访问规则即可。<br>https配置相关内容如下：</p>
<pre><code>server &#123;
    listen       443 ssl;
    server_name  127.0.0.1;

    ssl_certificate       D:/sso/casserver.pem;
    ssl_certificate_key   D:/sso/casserver.key;

    #ssl_session_cache    shared:SSL:1m;
    #ssl_session_timeout  5m;

    #ssl_ciphers  HIGH:!aNULL:!MD5;
    #ssl_prefer_server_ciphers  on;


     location / &#123;
         charset UTF-8;
         proxy_set_header Host $host;
         proxy_set_header X-Real-IP $remote_addr;
         proxy_pass https://127.0.0.1:8443/$uri$is_args$args;
      &#125;
&#125;
</code></pre>
<h3 id="5、配置日志"><a href="#5、配置日志" class="headerlink" title="5、配置日志"></a>5、配置日志</h3><pre><code>if ($time_iso8601 ~ &quot;^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&quot;) &#123;
    set $year $1;
    set $month $2;
    set $day $3;
    &#125;
   access_log /var/log/nginx/$year-$month-$day-access.log;
</code></pre>
<h3 id="6、负载均衡"><a href="#6、负载均衡" class="headerlink" title="6、负载均衡"></a>6、负载均衡</h3><h4 id="简单的http负载均衡"><a href="#简单的http负载均衡" class="headerlink" title="简单的http负载均衡"></a>简单的http负载均衡</h4><pre><code>  upstream  myslb &#123;
        server    127.0.0.1:8080;
        server    127.0.0.1:8081;
    &#125;

    server &#123;
        listen       8000;
        server_name  127.0.0.1;

        location / &#123;
            add_header &#39;Access-Control-Allow-Origin&#39; *;
            charset UTF-8;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_pass http://myslb/$uri$is_args$args;
        &#125;

    &#125;
</code></pre>
<h3 id="https的负载均衡"><a href="#https的负载均衡" class="headerlink" title="https的负载均衡"></a>https的负载均衡</h3><pre><code> upstream  myhttpsslb &#123;
        server    127.0.0.1:8443;
        server    127.0.0.1:8444;
  &#125;

  server &#123;
       listen 8883 ssl;
       server_name 127.0.0.1;
       ssl_certificate /home/ubuntu/keystore/prod_certfile.pem;
       ssl_certificate_key /home/ubuntu/keystore/prod_keyfile.key;
       ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
       root html;
       index index.html index.htm;

       location /&#123;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_pass https://myhttpsslb$uri$is_args$args;
       &#125;

  &#125;
</code></pre>
<h3 id="完整配置"><a href="#完整配置" class="headerlink" title="完整配置"></a>完整配置</h3><pre><code>  upstream  myhttpsslb &#123;
        server    127.0.0.1:8443;
        server    127.0.0.1:8444;
  &#125;

  server &#123;
       listen 8883 ssl;
       server_name 127.0.0.1;
       ssl_certificate /home/ubuntu/keystore/prod_certfile.pem;
       ssl_certificate_key /home/ubuntu/keystore/prod_keyfile.key;
       ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
       root html;
       index index.html index.htm;
       
       if ($time_iso8601 ~ &quot;^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&quot;) &#123;
         set $year $1;
         set $month $2;
         set $day $3;
      &#125;
      access_log /var/log/nginx/$year-$month-$day-access.log;

      location /&#123;
             proxy_set_header Host $host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_pass https://myhttpsslb$uri$is_args$args;
       &#125;

  &#125;
</code></pre>
<h3 id="7、访问黑名单"><a href="#7、访问黑名单" class="headerlink" title="7、访问黑名单"></a>7、访问黑名单</h3><p>在conf.d目录下，创建 blockips.conf文件，并加入黑名单IP，如下所示</p>
<p>查看<code>cat blockips.conf</code></p>
<pre><code>deny 210.14.155.215;
deny 61.4.185.194;
deny 54.223.167.94;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/04/27/Nginx%E9%85%8D%E7%BD%AEhttps/" data-id="cllui4qyq000bq0ja52e099oc" data-title="Nginx配置Https" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Tomcat配置https" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/04/27/Tomcat%E9%85%8D%E7%BD%AEhttps/" class="article-date">
  <time class="dt-published" datetime="2017-04-26T16:00:00.000Z" itemprop="datePublished">2017-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/04/27/Tomcat%E9%85%8D%E7%BD%AEhttps/">Tomcat配置Https</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1、生成证书"><a href="#1、生成证书" class="headerlink" title="1、生成证书"></a>1、生成证书</h2><p>用java jdk自带的keytool生成keystore密钥文件</p>
<p><a target="_blank" rel="noopener" href="http://www.micmiu.com/lang/java/keytool-start-guide/">更多信息</a></p>
<pre><code>keytool -genkey -alias casserver -keyalg RSA -keysize 1024 -keypass lumingclient -validity 365 -keystore d:\sso\casserver.keystore -storepass lumingclient
</code></pre>
<p><img src="http://i.imgur.com/hXp5XSB.png"></p>
<blockquote>
<p>截图中需要输入的姓名和上面hosts文件中配置的一致（也可以是主机名） ;</p>
</blockquote>
<blockquote>
<p>keypass 和 storepass 两个密码要一致，否则下面tomcat 配置https 访问失败。</p>
</blockquote>
<h2 id="2、导出证书"><a href="#2、导出证书" class="headerlink" title="2、导出证书"></a>2、导出证书</h2><p>从keystore文件中导出crt证书。</p>
<pre><code>keytool -export -alias casserver -keystore d:\sso\casserver.keystore -file d:\sso\casserver.crt -storepass lumingclient
</code></pre>
<p><img src="http://i.imgur.com/SeZDz9v.png"></p>
<h2 id="3、将证书导入到jre"><a href="#3、将证书导入到jre" class="headerlink" title="3、将证书导入到jre"></a>3、将证书导入到jre</h2><p>将生成的crt证书导入到部署服务器的jre中。</p>
<pre><code>keytool -import -keystore %JAVA_HOME%\jre\lib\security\cacerts -file d:\sso\casserver.crt -alias casserver
</code></pre>
<p>或者在JAVA_HOME路径下：</p>
<pre><code>keytool -import -keystore ../jre/lib/security/cacerts -file d:\sso\casserver.crt -alias casserver
</code></pre>
<blockquote>
<p>该命令中输入的密码和上面输入的不是同一个密码；如果是多台机器演示，需要在每一台客户端导入该证书。<br>如果JAVA_HOME路径中含有空格，可以将含空格的文件名用双引号包裹起来。<br>如：Program File 用 “Program File”</p>
</blockquote>
<p><img src="http://i.imgur.com/G9DMZ0A.png"></p>
<p>默认password：</p>
<pre><code>changeit
</code></pre>
<h2 id="4、配置tomcat"><a href="#4、配置tomcat" class="headerlink" title="4、配置tomcat"></a>4、配置tomcat</h2><p>在tomcat的conf&#x2F;server.xml文件中，找到</p>
<pre><code> &lt;!--
    &lt;Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11Protocol&quot;
               maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot; scheme=&quot;https&quot; secure=&quot;true&quot;
               clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; /&gt;
 --&gt;
</code></pre>
<p>将其修改成</p>
<pre><code>&lt;Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11Protocol&quot;
               maxThreads=&quot;150&quot; SSLEnabled=&quot;true&quot; scheme=&quot;https&quot; secure=&quot;true&quot;
               clientAuth=&quot;false&quot; sslProtocol=&quot;TLS&quot; 
    keystoreFile=&quot;/home/ubuntu/keystore/weatherserver.keystore&quot; keystorePass=&quot;mlogcn@2016&quot; URIEncoding=&quot;UTF-8&quot;
/&gt;
</code></pre>
<p><img src="http://i.imgur.com/rdqkeq9.png"></p>
<h2 id="5、验证"><a href="#5、验证" class="headerlink" title="5、验证"></a>5、验证</h2><p>启动tomcat，打开浏览器输入配置的https地址<code>https://www.cas.server.mlog.com:8443</code></p>
<p><img src="http://i.imgur.com/gn2udMP.png"></p>
<p><img src="http://i.imgur.com/fc8L9l9.png"></p>
<p>出现上述画面，表示https配置成功。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/04/27/Tomcat%E9%85%8D%E7%BD%AEhttps/" data-id="cllui4qyt000sq0jafpjdg0k1" data-title="Tomcat配置Https" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Spring相关" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/04/17/Spring%E7%9B%B8%E5%85%B3/" class="article-date">
  <time class="dt-published" datetime="2017-04-16T16:00:00.000Z" itemprop="datePublished">2017-04-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/04/17/Spring%E7%9B%B8%E5%85%B3/">springBoot常用配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Jackson序列化配置"><a href="#Jackson序列化配置" class="headerlink" title="Jackson序列化配置"></a>Jackson序列化配置</h2><h3 id="spring"><a href="#spring" class="headerlink" title="spring"></a>spring</h3><pre><code>@Bean
public MappingJackson2HttpMessageConverter customJackson2HttpMessageConverter() &#123;
    MappingJackson2HttpMessageConverter jsonConverter = new MappingJackson2HttpMessageConverter();
    ObjectMapper mapper = new ObjectMapper();
    mapper.setSerializationInclusion(Include.NON_NULL); 
    jsonConverter.setObjectMapper(mapper);
    return jsonConverter;
&#125;
</code></pre>
<h3 id="springboot"><a href="#springboot" class="headerlink" title="springboot"></a>springboot</h3><pre><code> @Bean
 public Jackson2ObjectMapperBuilder objectMapperBuilder() &#123;
    Jackson2ObjectMapperBuilder builder = new Jackson2ObjectMapperBuilder();
    builder.serializationInclusion(JsonInclude.Include.NON_NULL);
    return builder;
 &#125;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/04/17/Spring%E7%9B%B8%E5%85%B3/" data-id="cllui4qyt000pq0ja9f1k1sw5" data-title="springBoot常用配置" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/" rel="tag">spring</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-gradle" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/04/14/gradle/" class="article-date">
  <time class="dt-published" datetime="2017-04-13T16:00:00.000Z" itemprop="datePublished">2017-04-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/04/14/gradle/">gradle 在windows环境下快速搭建</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="windows-环境下快速搭建Gradle"><a href="#windows-环境下快速搭建Gradle" class="headerlink" title="windows 环境下快速搭建Gradle"></a>windows 环境下快速搭建Gradle</h2><h3 id="1、下载最新Gradle版本"><a href="#1、下载最新Gradle版本" class="headerlink" title="1、下载最新Gradle版本"></a>1、下载最新Gradle版本</h3><p>gradle版本下载地址<a target="_blank" rel="noopener" href="https://gradle.org/releases">https://gradle.org/releases</a>，目前官网最新版本为v3.5。</p>
<p>下载说明：Binary-only、Complete (含源码和文档)</p>
<h3 id="2、解压"><a href="#2、解压" class="headerlink" title="2、解压"></a>2、解压</h3><blockquote>
<p>windows</p>
</blockquote>
<p>创建C:\Gradle目录，将下载好的文件gradle-3.5-bin.zip拷贝到该目录并解压。</p>
<blockquote>
<p>mac、linux</p>
</blockquote>
<pre><code>$ mkdir /opt/gradle
$ unzip -d /opt/gradle gradle-3.5-bin.zip
$ ls /opt/gradle/gradle-3.5
LICENSE  NOTICE  bin  getting-started.html  init.d  lib  media
</code></pre>
<p><img src="http://i.imgur.com/ZlnpxqS.png"></p>
<h3 id="3、配置系统环境变量"><a href="#3、配置系统环境变量" class="headerlink" title="3、配置系统环境变量"></a>3、配置系统环境变量</h3><blockquote>
<p>windows </p>
</blockquote>
<p>首先，右击<code>我的电脑</code>或者<code>计算机</code>图标，然后单机选择<code>属性</code>选项，选择<code>系统设置</code>，选择<code>环境变量</code>。在系统变量中，找到<code>path</code>项，新增<code>C:\Gradle\gradle-3.5\bin</code>，然后保存，退出。</p>
<blockquote>
<p>mac、linux</p>
</blockquote>
<pre><code> $ export PATH=$PATH:/opt/gradle/gradle-3.5/bin
</code></pre>
<p><img src="http://i.imgur.com/u0KW4KW.png"></p>
<h3 id="4、验证"><a href="#4、验证" class="headerlink" title="4、验证"></a>4、验证</h3><p>在控制台运行 <code>gradle -v</code></p>
<pre><code>gradle -v
</code></pre>
<p><img src="http://i.imgur.com/K3hJ1Zb.png"></p>
<p>更多有用的信息，请访问：</p>
<p><a target="_blank" rel="noopener" href="https://gradle.org/">gradle官网</a></p>
<p><a target="_blank" rel="noopener" href="https://gradle.org/install">gradle安装</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.gradle.org/current/userguide/userguide.html">gradle使用手册</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/04/14/gradle/" data-id="cllui4qyx001kq0jaepqz1twa" data-title="gradle 在windows环境下快速搭建" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gradle/" rel="tag">gradle</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-swagger" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/04/12/swagger/" class="article-date">
  <time class="dt-published" datetime="2017-04-11T16:00:00.000Z" itemprop="datePublished">2017-04-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/04/12/swagger/">spring boot + swagger 快速简单集成</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="微服务API-DOC-中-swagger-注解使用简单整理"><a href="#微服务API-DOC-中-swagger-注解使用简单整理" class="headerlink" title="微服务API DOC 中 swagger 注解使用简单整理"></a>微服务API DOC 中 swagger 注解使用简单整理</h2><p>spring boot + swagger的简单集成。</p>
<blockquote>
<p>因为在不同版本中，注解会被解析成不同的含义，因此以2.2.2版本为基准。</p>
</blockquote>
<p>部署后api-doc的json返回链接</p>
<pre><code>http://localhost:8080/v2/api-docs
</code></pre>
<p>部署后api-doc的页面返回链接</p>
<pre><code>http://localhost:8080/swagger-ui.html
</code></pre>
<p>springfox-swagger2 版本</p>
<pre><code>2.2.2
</code></pre>
<p>springfox-swagger-ui 版本</p>
<pre><code>2.2.2
</code></pre>
<p>maven依赖为：</p>
<pre><code> &lt;dependency&gt;
        &lt;groupId&gt;io.springfox&lt;/groupId&gt;
        &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
        &lt;version&gt;2.2.2&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.springfox&lt;/groupId&gt;
        &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;
        &lt;version&gt;2.2.2&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre>
<h3 id="类注解"><a href="#类注解" class="headerlink" title="类注解"></a>类注解</h3><h4 id="Api"><a href="#Api" class="headerlink" title="@Api"></a>@Api</h4><p>value </p>
<blockquote>
<p>controller的描述信息；</p>
</blockquote>
<p>tags </p>
<blockquote>
<p>controller的名称；</p>
</blockquote>
<p>示例：</p>
<pre><code>@Api(value = &quot;提供用户基本信息的增删改查操作接口&quot;, tags = &#123; &quot;用户接口&quot; &#125;)
public class UserController &#123;&#125;
</code></pre>
<p>在接口中返回的数据值段：</p>
<pre><code>tags: [
    &#123;
        name: &quot;用户接口&quot;,
        description: &quot;提供用户基本信息的增删改查操作接口&quot;
    &#125;
]
</code></pre>
<h3 id="方法注解"><a href="#方法注解" class="headerlink" title="方法注解"></a>方法注解</h3><h4 id="ApiOperation"><a href="#ApiOperation" class="headerlink" title="@ApiOperation"></a>@ApiOperation</h4><p>produces</p>
<blockquote>
<p>返回的格式类型</p>
</blockquote>
<p>consumes</p>
<blockquote>
<p>接收的格式类型</p>
</blockquote>
<p>value</p>
<blockquote>
<p>主要描述信息</p>
</blockquote>
<p>notes</p>
<blockquote>
<p>详细描述信息</p>
</blockquote>
<p>示例：</p>
<pre><code>@ApiOperation(value = &quot;获取用户列表&quot;, notes = &quot;获取当前数据库中存储的全部用户信息&quot;, produces=&quot;application/json&quot;, consumes = &quot;application/json&quot;)
public List&lt;User&gt; getAllUserList();
</code></pre>
<p>在接口中返回的数据值段：</p>
<pre><code>summary: &quot;获取用户列表&quot;,
description: &quot;获取用户的信息&quot;,
operationId: &quot;getUserListUsingGET_1&quot;,
consumes: [
    &quot;application/json&quot;
],
produces: [
    &quot;application/json&quot;,
    &quot;*/*&quot;
]
</code></pre>
<h3 id="ApiImplicitParams-ApiImplicitParam"><a href="#ApiImplicitParams-ApiImplicitParam" class="headerlink" title="@ApiImplicitParams @ApiImplicitParam"></a>@ApiImplicitParams @ApiImplicitParam</h3><p>paramType</p>
<blockquote>
<p>有3种类型，query、path、body；分别对应spring中的@RequestParam 、@PathVariable 、@RequestBody</p>
</blockquote>
<p>name</p>
<blockquote>
<p>参数名称</p>
</blockquote>
<p>value</p>
<blockquote>
<p>参数描述信息</p>
</blockquote>
<p>defaultValue</p>
<blockquote>
<p>默认值</p>
</blockquote>
<p>required</p>
<blockquote>
<p>是否必传</p>
</blockquote>
<p>dataType</p>
<blockquote>
<p>数据类型</p>
</blockquote>
<p>allowableValues</p>
<blockquote>
<p>允许输入的值；目前好像只针对String类型的有效</p>
</blockquote>
<p>示例</p>
<pre><code>@ApiImplicitParams(&#123;
        @ApiImplicitParam(allowableValues = &quot;zhangsan, lisi&quot;, paramType = &quot;query&quot;, name = &quot;username&quot;, value = &quot;用户姓名&quot;, defaultValue = &quot;zhangsan&quot;, required = true, dataType = &quot;String&quot;),
        @ApiImplicitParam(paramType = &quot;path&quot;, name = &quot;id&quot;, value = &quot;用户ID&quot;, defaultValue = &quot;1001&quot;, required = true, dataType = &quot;Long&quot;),
        @ApiImplicitParam(paramType = &quot;body&quot;, name = &quot;user&quot;, value = &quot;用户详细信息&quot;, required = true, dataType = &quot;User&quot;) &#125;)
public String updateUser(@RequestParam(name = &quot;username&quot;) String username, @PathVariable Long id, @RequestBody User user);
</code></pre>
<p>在接口中返回的数据值段：</p>
<pre><code>parameters: [
    &#123;
        name: &quot;username&quot;,
        in: &quot;query&quot;,
        description: &quot;用户姓名&quot;,
        required: true,
        type: &quot;string&quot;,
        default: &quot;zhangsan&quot;,
        enum: [
            &quot;zhangsan&quot;,
            &quot;lisi&quot;
        ]
    &#125;,
    &#123;
        name: &quot;id&quot;,
        in: &quot;path&quot;,
        description: &quot;用户ID&quot;,
        required: true,
        type: &quot;integer&quot;,
        default: &quot;1001&quot;,
        format: &quot;int64&quot;
    &#125;,
    &#123;
        in: &quot;body&quot;,
        name: &quot;user&quot;,
        description: &quot;用户详细信息&quot;,
        required: true,
        schema: &#123;
            $ref: &quot;#/definitions/User&quot;
        &#125;
    &#125;
]
</code></pre>
<h3 id="ApiResponses-ApiResponse"><a href="#ApiResponses-ApiResponse" class="headerlink" title="@ApiResponses @ApiResponse"></a>@ApiResponses @ApiResponse</h3><p>code</p>
<blockquote>
<p>httpCode编码</p>
</blockquote>
<p>message</p>
<blockquote>
<p>描述信息</p>
</blockquote>
<p>response</p>
<blockquote>
<p>返回数据类型</p>
</blockquote>
<p>responseContainer</p>
<blockquote>
<p>返回数据类型容器，可以选择 List Set Map</p>
</blockquote>
<p>示例</p>
<pre><code>@ApiResponses(value = &#123;
            @ApiResponse(code = 200, message = &quot;更新后的用户信息&quot;),
            @ApiResponse(code = 401, message = &quot;用户名校验错误&quot;, response = User.class),
            @ApiResponse(code = 404, message = &quot;查询的资源不存在&quot;, response = User.class) &#125;)
public List&lt;User&gt; updateUser(@RequestParam(name = &quot;username&quot;) String username, @PathVariable Long id, @RequestBody User user);

responses: &#123;
    200: &#123;
        description: &quot;更新后的全部用户信息&quot;,
        schema: &#123;
            type: &quot;array&quot;,
            items: &#123;
                $ref: &quot;#/definitions/User&quot;
            &#125;
        &#125;
    &#125;,
    400: &#123;
        description: &quot;用户名校验错误&quot;
    &#125;,
    401: &#123;
        description: &quot;Unauthorized&quot;
    &#125;,
    403: &#123;
        description: &quot;Forbidden&quot;
    &#125;,
    404: &#123;
        description: &quot;查询的资源不存在&quot;
    &#125;
&#125;
</code></pre>
<h3 id="ApiModelProperty"><a href="#ApiModelProperty" class="headerlink" title="@ApiModelProperty"></a>@ApiModelProperty</h3><p>实体类属性上使用的注解，建议只使用value属性。</p>
<p>value</p>
<blockquote>
<p>属性列描述信息</p>
</blockquote>
<h3 id="ApiIgnore"><a href="#ApiIgnore" class="headerlink" title="@ApiIgnore"></a>@ApiIgnore</h3><p>用来标注不使用swagger的API方法。</p>
<h3 id="总体描述信息"><a href="#总体描述信息" class="headerlink" title="总体描述信息"></a>总体描述信息</h3><pre><code>@Configuration
@EnableSwagger2
public class Swagger2 &#123;

    @Bean
    public Docket createRestApi() &#123;
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                .select()
                .apis(RequestHandlerSelectors.basePackage(&quot;com.didispace.web&quot;))
                .paths(PathSelectors.any())
                .build();
    &#125;

    private ApiInfo apiInfo() &#123;
        return new ApiInfoBuilder()
                .title(&quot;Spring Boot中使用Swagger2构建RESTful APIs&quot;)
                .description(&quot;用户测试API文档&quot;)
                .termsOfServiceUrl(&quot;https://luminghub.github.io/&quot;)
                .contact(&quot;小明&quot;)
                .version(&quot;1.0.1&quot;)
                .build();
    &#125;

&#125;
</code></pre>
<p>更多有用的信息，请访问：</p>
<p><a target="_blank" rel="noopener" href="http://swagger.io/">swagger官网</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/swagger-api">swagger源码地址</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/swagger-api/swagger-core/wiki/Annotations-1.5.X">swagger注解</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/04/12/swagger/" data-id="cllui4qz6003uq0jaflrgdbte" data-title="spring boot + swagger 快速简单集成" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/swagger/" rel="tag">swagger</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Study/">Study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/improve/">improve</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/technical-article/">technical article</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECS/" rel="tag">ECS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIT/" rel="tag">GIT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA/" rel="tag">JAVA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Snappy/" rel="tag">Snappy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/" rel="tag">Spring Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cassandra/" rel="tag">cassandra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/commons-math3/" rel="tag">commons-math3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gRPC/" rel="tag">gRPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/goreplay/" rel="tag">goreplay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/" rel="tag">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ossutil/" rel="tag">ossutil</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/" rel="tag">postgresql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protobuf/" rel="tag">protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/" rel="tag">swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC/" rel="tag">软件架构师的12项修炼</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ECS/" style="font-size: 10px;">ECS</a> <a href="/tags/GIT/" style="font-size: 17.5px;">GIT</a> <a href="/tags/JAVA/" style="font-size: 20px;">JAVA</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 12.5px;">Redis</a> <a href="/tags/Snappy/" style="font-size: 10px;">Snappy</a> <a href="/tags/Spring-Cloud/" style="font-size: 10px;">Spring Cloud</a> <a href="/tags/Tomcat/" style="font-size: 12.5px;">Tomcat</a> <a href="/tags/cassandra/" style="font-size: 12.5px;">cassandra</a> <a href="/tags/commons-math3/" style="font-size: 10px;">commons-math3</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/gRPC/" style="font-size: 10px;">gRPC</a> <a href="/tags/goreplay/" style="font-size: 10px;">goreplay</a> <a href="/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/ossutil/" style="font-size: 10px;">ossutil</a> <a href="/tags/postgresql/" style="font-size: 12.5px;">postgresql</a> <a href="/tags/protobuf/" style="font-size: 10px;">protobuf</a> <a href="/tags/spring/" style="font-size: 12.5px;">spring</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC/" style="font-size: 15px;">软件架构师的12项修炼</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/08/28/docker%E9%83%A8%E7%BD%B2java%E7%A8%8B%E5%BA%8F%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/">docker部署java程序基本命令</a>
          </li>
        
          <li>
            <a href="/2019/11/21/Springboot%E8%BF%94%E5%9B%9Ejson%E5%92%8Cxml%E8%A7%86%E5%9B%BE/">Springboot返回json和xml视图</a>
          </li>
        
          <li>
            <a href="/2018/04/27/git%E6%B8%85%E7%90%86commits%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95/">Git 清理commits历史记录</a>
          </li>
        
          <li>
            <a href="/2018/04/17/access%E6%97%A5%E5%BF%97%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0OSS%E5%BD%92%E6%A1%A3/">access日志通过OSSutil自动上传OSS归档</a>
          </li>
        
          <li>
            <a href="/2018/01/11/postgis%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/">postgis常用函数</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>