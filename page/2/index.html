<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-mongodb入门" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/09/21/mongodb%E5%85%A5%E9%97%A8/" class="article-date">
  <time class="dt-published" datetime="2017-09-20T16:00:00.000Z" itemprop="datePublished">2017-09-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/21/mongodb%E5%85%A5%E9%97%A8/">mongodb入门</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="导航"><a href="#导航" class="headerlink" title="导航"></a>导航</h3><p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/crud/">mongo官方使用文档</a></p>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><pre><code>mongo --host &lt;ip&gt; --port &lt;端口&gt;
</code></pre>
<h3 id="数据导入导出"><a href="#数据导入导出" class="headerlink" title="数据导入导出"></a>数据导入导出</h3><pre><code>mongoexport --host 127.0.0.1 --port 27110 -d dbName -c collName -o file.dat
mongoimport --host 127.0.0.1 --port 27110 -d dbName -c collName file.dat
</code></pre>
<h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><pre><code>db.getCollection(&#39;alert&#39;).find(&#123;&quot;alert.identifier&quot;:/^21030/&#125;)
</code></pre>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><pre><code>db.inventory.insertOne(&#123; item: &quot;canvas&quot;, qty: 100, tags: [&quot;cotton&quot;], size: &#123; h: 28, w: 35.5, uom: &quot;cm&quot; &#125; &#125;)

db.inventory.insertMany([
   &#123; item: &quot;journal&quot;, qty: 25, tags: [&quot;blank&quot;, &quot;red&quot;], size: &#123; h: 14, w: 21, uom: &quot;cm&quot; &#125; &#125;,
   &#123; item: &quot;mat&quot;, qty: 85, tags: [&quot;gray&quot;], size: &#123; h: 27.9, w: 35.5, uom: &quot;cm&quot; &#125; &#125;,
   &#123; item: &quot;mousepad&quot;, qty: 25, tags: [&quot;gel&quot;, &quot;blue&quot;], size: &#123; h: 19, w: 22.85, uom: &quot;cm&quot; &#125; &#125;
])
</code></pre>
<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><pre><code>查询条件：&#123; &lt;field1&gt;: &lt;value1&gt;, ... &#125;

查询一条记录：db.collection.findOne( )

查询全部：db.inventory.find( &#123;&#125; )

按条件查询：
    db.inventory.find( &#123; status: &quot;D&quot; &#125; )  【SELECT * FROM inventory WHERE status = &quot;D&quot;】

IN查询：
    db.inventory.find( &#123; status: &#123; $in: [ &quot;A&quot;, &quot;D&quot; ] &#125; &#125; )  【SELECT * FROM inventory WHERE status in (&quot;A&quot;, &quot;D&quot;)】

特殊条件AND：
    db.inventory.find( &#123; status: &quot;A&quot;, qty: &#123; $lt: 30 &#125; &#125; )	 【SELECT * FROM inventory WHERE status = &quot;A&quot; AND qty &lt; 30】

特殊条件OR
    db.inventory.find( &#123; $or: [ &#123; status: &quot;A&quot; &#125;, &#123; qty: &#123; $lt: 30 &#125; &#125; ] &#125; )  【SELECT * FROM inventory WHERE status = &quot;A&quot; OR qty &lt; 30】

联合条件

db.inventory.find( &#123; status: &quot;A&quot;, $or: [ &#123; qty: &#123; $lt: 30 &#125; &#125;, &#123; item: /^p/ &#125; ] &#125; )  【SELECT * FROM inventory WHERE status = &quot;A&quot; AND ( qty &lt; 30 OR item LIKE &quot;p%&quot;)】
</code></pre>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><pre><code>db.collection.updateOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)
db.collection.updateMany(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)
db.collection.replaceOne(&lt;filter&gt;, &lt;replacement&gt;, &lt;options&gt;)
</code></pre>
<p>语法</p>
<pre><code>&#123;
  &lt;update operator&gt;: &#123; &lt;field1&gt;: &lt;value1&gt;, ... &#125;,
  &lt;update operator&gt;: &#123; &lt;field2&gt;: &lt;value2&gt;, ... &#125;,
  ...
&#125;
</code></pre>
<p>更新一条记录某字段。使用<code>$set</code>来更新指定字段信息。使用<code>$currentDate</code>将最后修改时间变成当前时间。如果最后修改时间字段<code>lastModified</code>不存在将会自动创建该字段。 </p>
<pre><code>db.inventory.updateOne(
   &#123; item: &quot;paper&quot; &#125;,
   &#123;
     $set: &#123; &quot;size.uom&quot;: &quot;cm&quot;, status: &quot;P&quot; &#125;,
     $currentDate: &#123; lastModified: true &#125;
   &#125;
)
</code></pre>
<p>更新多条记录某字段。</p>
<pre><code>db.inventory.updateMany(
   &#123; &quot;qty&quot;: &#123; $lt: 50 &#125; &#125;,
   &#123;
     $set: &#123; &quot;size.uom&quot;: &quot;in&quot;, status: &quot;P&quot; &#125;,
     $currentDate: &#123; lastModified: true &#125;
   &#125;
)
</code></pre>
<p>替换一条记录。<code>db.collection.replaceOne()</code></p>
<pre><code>&#123; &quot;_id&quot; : ObjectId(&quot;59c3b1145ac95ea59ae660fb&quot;), &quot;item&quot; : &quot;paper&quot;, &quot;qty&quot; : 100, &quot;size&quot; : &#123; &quot;h&quot; : 8.5, &quot;w&quot; : 11, &quot;uom&quot; : &quot;in&quot; &#125;, &quot;status&quot; : &quot;D&quot; &#125;
替换成
&#123; &quot;_id&quot; : ObjectId(&quot;59c3b1145ac95ea59ae660fb&quot;), &quot;item&quot; : &quot;paper&quot;, &quot;instock&quot; : [ &#123; &quot;warehouse&quot; : &quot;A&quot;, &quot;qty&quot; : 60 &#125;, &#123; &quot;warehouse&quot; : &quot;B&quot;, &quot;qty&quot; : 40 &#125; ] &#125;

db.inventory.replaceOne(
   &#123; item: &quot;paper&quot; &#125;,
   &#123; item: &quot;paper&quot;, instock: [ &#123; warehouse: &quot;A&quot;, qty: 60 &#125;, &#123; warehouse: &quot;B&quot;, qty: 40 &#125; ] &#125;
)
</code></pre>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><pre><code>删除多条：
db.inventory.deleteMany(&#123; status : &quot;A&quot; &#125;)

删除一条：
db.inventory.deleteOne( &#123; status: &quot;D&quot; &#125; )
</code></pre>
<h3 id="文本搜索"><a href="#文本搜索" class="headerlink" title="文本搜索"></a>文本搜索</h3><pre><code>db.stores.insert(
   [
     &#123; _id: 1, name: &quot;Java Hut&quot;, description: &quot;Coffee and cakes&quot; &#125;,
     &#123; _id: 2, name: &quot;Burger Buns&quot;, description: &quot;Gourmet hamburgers&quot; &#125;,
     &#123; _id: 3, name: &quot;Coffee Shop&quot;, description: &quot;Just coffee&quot; &#125;,
     &#123; _id: 4, name: &quot;Clothes Clothes Clothes&quot;, description: &quot;Discount clothing&quot; &#125;,
     &#123; _id: 5, name: &quot;Java Shopping&quot;, description: &quot;Indonesian goods&quot; &#125;
   ]
)
创建索引
db.stores.createIndex( &#123; name: &quot;text&quot;, description: &quot;text&quot; &#125; )
使用$text Operator
查询包含java,coffee,shop的
db.stores.find( &#123; $text: &#123; $search: &quot;java coffee shop&quot; &#125; &#125; )
查询包含java或者coffee shop的
db.stores.find( &#123; $text: &#123; $search: &quot;java \&quot;coffee shop\&quot;&quot; &#125; &#125; )
查询包含java或者shop但是不包含coffee的
db.stores.find( &#123; $text: &#123; $search: &quot;java shop -coffee&quot; &#125; &#125; )
排序
db.stores.find(
   &#123; $text: &#123; $search: &quot;java coffee shop&quot; &#125; &#125;,
   &#123; score: &#123; $meta: &quot;textScore&quot; &#125; &#125;
).sort( &#123; score: &#123; $meta: &quot;textScore&quot; &#125; &#125; )
</code></pre>
<p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/operator/projection/meta/#proj._S_meta">更多$meta</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/09/21/mongodb%E5%85%A5%E9%97%A8/" data-id="cllui4qz2002tq0ja5ozucjcc" data-title="mongodb入门" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-java2D" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/07/03/java2D/" class="article-date">
  <time class="dt-published" datetime="2017-07-02T16:00:00.000Z" itemprop="datePublished">2017-07-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/07/03/java2D/">Java2D 简单的应用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="图片裁剪"><a href="#图片裁剪" class="headerlink" title="图片裁剪"></a>图片裁剪</h3><pre><code>/** 
 * 图片裁剪 
 * @param srcImageFile 图片裁剪地址 
 * @param result 图片输出文件夹 
 * @param destWidth 图片裁剪宽度 
 * @param destHeight 图片裁剪高度 
 */  
public final static void cutImage(String srcImageFile, String result,  
        int destWidth, int destHeight) &#123;  
    try &#123;  
        Iterator iterator = ImageIO.getImageReadersByFormatName(&quot;JPEG&quot;);/*PNG,BMP*/     
        ImageReader reader = (ImageReader)iterator.next();/*获取图片尺寸*/  
        InputStream inputStream = new FileInputStream(srcImageFile);    
        ImageInputStream iis = ImageIO.createImageInputStream(inputStream);     
        reader.setInput(iis, true);     
        ImageReadParam param = reader.getDefaultReadParam();     
        Rectangle rectangle = new Rectangle(0,0, destWidth, destHeight);/*指定截取范围*/      
        param.setSourceRegion(rectangle);     
        BufferedImage bi = reader.read(0,param);   
        ImageIO.write(bi, &quot;JPEG&quot;, new File(result));  
    &#125; catch (Exception e) &#123;  
        LOG.error(&quot;图片裁剪出现异常:&quot;+e);  
    &#125;  
&#125; 
</code></pre>
<h3 id="图片叠加"><a href="#图片叠加" class="headerlink" title="图片叠加"></a>图片叠加</h3><pre><code>import java.awt.AlphaComposite;
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;

import javax.imageio.ImageIO;
public class NewImageUtils &#123;
    /**
     * 
     * @Title: 构造图片
     * @Description: 生成水印并返回java.awt.image.BufferedImage
     * @param file
     *            源文件(图片)
     * @param waterFile
     *            水印文件(图片)
     * @param x
     *            距离右下角的X偏移量
     * @param y
     *            距离右下角的Y偏移量
     * @param alpha
     *            透明度, 选择值从0.0~1.0: 完全透明~完全不透明
     * @return BufferedImage
     * @throws IOException
     */
    public static BufferedImage watermark(File file, File waterFile, int x, int y, float alpha) throws IOException &#123;
        // 获取底图
        BufferedImage buffImg = ImageIO.read(file);
        // 获取层图
        BufferedImage waterImg = ImageIO.read(waterFile);
        // 创建Graphics2D对象，用在底图对象上绘图
        Graphics2D g2d = buffImg.createGraphics();
        int waterImgWidth = waterImg.getWidth();// 获取层图的宽度
        int waterImgHeight = waterImg.getHeight();// 获取层图的高度
        // 在图形和图像中实现混合和透明效果
        g2d.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_ATOP, alpha));
        // 绘制
        g2d.drawImage(waterImg, x, y, waterImgWidth, waterImgHeight, null);
        g2d.dispose();// 释放图形上下文使用的系统资源
        return buffImg;
    &#125;

    /**
     * 输出水印图片
     * 
     * @param buffImg
     *            图像加水印之后的BufferedImage对象
     * @param savePath
     *            图像加水印之后的保存路径
     */
    private void generateWaterFile(BufferedImage buffImg, String savePath) &#123;
        int temp = savePath.lastIndexOf(&quot;.&quot;) + 1;
        try &#123;
            ImageIO.write(buffImg, savePath.substring(temp), new File(savePath));
        &#125; catch (IOException e1) &#123;
            e1.printStackTrace();
        &#125;
    &#125;

    /**
     * 
     * @param args
     * @throws IOException
     *             IO异常直接抛出了
     * @author bls
     */
    public static void main(String[] args) throws IOException &#123;
        String sourceFilePath = &quot;D://img//di.png&quot;;
        String waterFilePath = &quot;D://img//ceng.png&quot;;
        String saveFilePath = &quot;D://img//new.png&quot;;
        NewImageUtils newImageUtils = new NewImageUtils();
        // 构建叠加层
        BufferedImage buffImg = NewImageUtils.watermark(new File(sourceFilePath), new File(waterFilePath), 0, 0, 1.0f);
        // 输出水印图片
        newImageUtils.generateWaterFile(buffImg, saveFilePath);
    &#125;
&#125;
</code></pre>
<h3 id="抗锯齿描点"><a href="#抗锯齿描点" class="headerlink" title="抗锯齿描点"></a>抗锯齿描点</h3><pre><code>import java.awt.BasicStroke;
import java.awt.Color;
import java.awt.Graphics2D;
import java.awt.RenderingHints;
import java.awt.geom.Line2D;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.util.List;

public class ImgDrawer2D &#123;

  private BufferedImage image;
  private Graphics2D graphics;

  public ImgDrawer2D(int width, int height) &#123;
    init(width, height);
  &#125;

  public void init(int width, int height) &#123;
    image = new BufferedImage(width, height, BufferedImage.TYPE_4BYTE_ABGR);
    graphics = (Graphics2D) image.getGraphics();
    graphics.setStroke(new BasicStroke(1.6f, BasicStroke.CAP_SQUARE, BasicStroke.JOIN_ROUND)); 
    graphics.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
  &#125;

  public BufferedImage getImg() &#123;
    return this.image;
  &#125;

  /**
   * 绘制一个点-设置颜色，不设置透明度
   * 
   * @param printPoint
   * @throws IOException
   */
  public void drawColorPoint(PrintPoint2D printPoint) throws IOException &#123;
    int[] rgb = printPoint.getRGB();
    graphics.setColor(new Color(rgb[0], rgb[1], rgb[2]));
    graphics.draw(new Line2D.Double(printPoint.getxPixel(), printPoint.getyPixel(),
        printPoint.getxPixel(), printPoint.getyPixel()));
  &#125;

  /**
   * 按照默认颜色绘制一个点，不指定颜色和透明度
   * 
   * @param printPoint
   * @throws IOException
   */
  public void drawPoint(PrintPoint2D printPoint) throws IOException &#123;
    graphics.draw(new Line2D.Double(printPoint.getxPixel(), printPoint.getyPixel(),
        printPoint.getxPixel(), printPoint.getyPixel()));
  &#125;

  /**
   * 绘制一个带透明度的点
   * 
   * @param printPoint
   */
  public void drawAlphaPoint(PrintPoint2D printPoint) &#123;
    int[] rgb = printPoint.getRGB();
    graphics.setColor(new Color(rgb[0], rgb[1], rgb[2], printPoint.getAlpha()));
    graphics.draw(new Line2D.Double(printPoint.getxPixel(), printPoint.getyPixel(),
        printPoint.getxPixel(), printPoint.getyPixel()));
  &#125;

  /**
   * 绘制一堆带透明度的点
   * 
   * @param printPointList
   * @throws IOException
   */
  public void drawAlphaImg(List&lt;PrintPoint2D&gt; printPointList) throws IOException &#123;
    for (int i = 0; i &lt; printPointList.size(); i++) &#123;
      PrintPoint2D printPoint = printPointList.get(i);
      drawAlphaPoint(printPoint);
    &#125;
  &#125;

  /**
   * 绘制
   * 
   * @param printPointList
   * @throws IOException
   */
  public void drawImg(List&lt;PrintPoint2D&gt; printPointList) throws IOException &#123;
    for (int i = 0; i &lt; printPointList.size(); i++) &#123;
      PrintPoint2D printPoint = printPointList.get(i);
      drawColorPoint(printPoint);
    &#125;
  &#125;

&#125;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/07/03/java2D/" data-id="cllui4qz1002iq0jabrq48ogp" data-title="Java2D 简单的应用" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVA/" rel="tag">JAVA</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-mybaties" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/06/27/mybaties/" class="article-date">
  <time class="dt-published" datetime="2017-06-26T16:00:00.000Z" itemprop="datePublished">2017-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/06/27/mybaties/">mybatis常用语法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="mybatis判断是否为空或null"><a href="#mybatis判断是否为空或null" class="headerlink" title="mybatis判断是否为空或null"></a>mybatis判断是否为空或null</h3><pre><code>&lt;select id=&quot; getStudentListLikeName &quot; parameterType=&quot;StudentEntity&quot; resultMap=&quot;studentResultMap&quot;&gt;  
    SELECT * from STUDENT_TBL ST   
    &lt;if test=&quot;studentName!=null and studentName!=&#39;&#39; &quot;&gt;  
        WHERE ST.STUDENT_NAME LIKE CONCAT(CONCAT(&#39;%&#39;, #&#123;studentName&#125;),&#39;%&#39;)   
    &lt;/if&gt;  
&lt;/select&gt;
</code></pre>
<h3 id="mybatis判断集合为空或者元素个数为零"><a href="#mybatis判断集合为空或者元素个数为零" class="headerlink" title="mybatis判断集合为空或者元素个数为零"></a>mybatis判断集合为空或者元素个数为零</h3><pre><code>&lt;if test=&quot;mlhs != null and mlhs.size() != 0&quot;&gt;
  and t.mlh_name not in  
  &lt;foreach collection=&quot;mlhs&quot; item=&quot;item1&quot; open=&quot;(&quot; close=&quot;)&quot; index=&quot;i&quot; separator=&quot;,&quot;&gt; 
    #&#123;item1,jdbcType=VARCHAR&#125;
  &lt;/foreach&gt;
&lt;/if&gt;
</code></pre>
<h3 id="mybatis-插入多条记录"><a href="#mybatis-插入多条记录" class="headerlink" title="mybatis 插入多条记录"></a>mybatis 插入多条记录</h3><pre><code>&lt;insert id=&quot;addSubPoints&quot; parameterType=&quot;java.util.List&quot;&gt;
    INSERT INTO
    ORDERPOINT(ORDERID,POINTNAME,LAT,LON)
    VALUES
    &lt;foreach collection=&quot;list&quot; item=&quot;item&quot; index=&quot;index&quot;
        separator=&quot;,&quot;&gt;
        (#&#123;item.orderId&#125;,#&#123;item.pointName&#125;,#&#123;item.lat&#125;,#&#123;item.lon&#125;)
    &lt;/foreach&gt;
&lt;/insert&gt;
</code></pre>
<h3 id="mybatis使用set-if标签修改后，如果某项为null则不进行更新，而是保持数据库原值。如下示例："><a href="#mybatis使用set-if标签修改后，如果某项为null则不进行更新，而是保持数据库原值。如下示例：" class="headerlink" title="mybatis使用set+if标签修改后，如果某项为null则不进行更新，而是保持数据库原值。如下示例："></a>mybatis使用set+if标签修改后，如果某项为null则不进行更新，而是保持数据库原值。如下示例：</h3><pre><code>&lt;update id=&quot;updateStudent&quot; parameterType=&quot;StudentEntity&quot;&gt;     
    UPDATE STUDENT_TBL      
    &lt;set&gt;     
        &lt;if test=&quot;studentName!=null and studentName!=&#39;&#39; &quot;&gt;     
            STUDENT_TBL.STUDENT_NAME = #&#123;studentName&#125;,      
        &lt;/if&gt;     
        &lt;if test=&quot;studentSex!=null and studentSex!=&#39;&#39; &quot;&gt;     
            STUDENT_TBL.STUDENT_SEX = #&#123;studentSex&#125;,      
        &lt;/if&gt;     
        &lt;if test=&quot;studentBirthday!=null &quot;&gt;     
            STUDENT_TBL.STUDENT_BIRTHDAY = #&#123;studentBirthday&#125;,      
        &lt;/if&gt;     
        &lt;if test=&quot;classEntity!=null and classEntity.classID!=null and classEntity.classID!=&#39;&#39; &quot;&gt;     
            STUDENT_TBL.CLASS_ID = #&#123;classEntity.classID&#125;      
        &lt;/if&gt;     
    &lt;/set&gt;     
    WHERE STUDENT_TBL.STUDENT_ID = #&#123;studentID&#125;;      
&lt;/update&gt;   
</code></pre>
<h3 id="Mybatis自动生成key值（selectKey和useGeneratedKeys）"><a href="#Mybatis自动生成key值（selectKey和useGeneratedKeys）" class="headerlink" title="Mybatis自动生成key值（selectKey和useGeneratedKeys）"></a>Mybatis自动生成key值（selectKey和useGeneratedKeys）</h3><p>如果数据库支持自增长主键字段（比如MySQL、sql server）设置useGeneratedKeys&#x3D;”true”和keyProperty，这样就可以插入主键id值<br>Oracle则不支持自增长id，设置useGeneratedKey&#x3D;”false”，如果设置true则会有报错信息。</p>
<pre><code>&lt;!-- 插入新的问题件 --&gt;
&lt;!-- useGeneratedKeys=&quot;true&quot;把新增加的主键赋值到自己定义的keyProperty（id）中 --&gt;
&lt;insert id=&quot;insert&quot; parameterType=&quot;jw.base.entity.WrongRecApply&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot; keyColumn=&quot;id&quot;&gt;
    insert into tb_wrong_rec_apply (num, cid,
        `type`, `describe`, solution,
        seller_tel, seller_qq, seller_email,
        buyer_tel, buyer_qq, buyer_email,
        submit_time, update_time, r_wrong_id,
        ext1, ext2, img,state
      )
     values (#&#123;num,jdbcType=VARCHAR&#125;, #&#123;cid,jdbcType=INTEGER&#125;,
        #&#123;type,jdbcType=VARCHAR&#125;, #&#123;describe,jdbcType=VARCHAR&#125;, #&#123;solution,jdbcType=VARCHAR&#125;,
        #&#123;sellerTel,jdbcType=VARCHAR&#125;, #&#123;sellerQq,jdbcType=VARCHAR&#125;, #&#123;sellerEmail,jdbcType=VARCHAR&#125;,
        #&#123;buyerTel,jdbcType=VARCHAR&#125;, #&#123;buyerQq,jdbcType=VARCHAR&#125;, #&#123;buyerEmail,jdbcType=VARCHAR&#125;,
        #&#123;submitTime,jdbcType=TIMESTAMP&#125;, #&#123;updateTime,jdbcType=TIMESTAMP&#125;, #&#123;rWrongId,jdbcType=INTEGER&#125;,
        #&#123;ext1,jdbcType=VARCHAR&#125;, #&#123;ext2,jdbcType=VARCHAR&#125;, #&#123;img,jdbcType=LONGVARBINARY&#125;,#&#123;state,jdbcType=INTEGER&#125;
    )
&lt;/insert&gt;
</code></pre>
<h3 id="mybatis的trim是更灵活的去处多余关键字的标签，他可以实践where和set的效果。"><a href="#mybatis的trim是更灵活的去处多余关键字的标签，他可以实践where和set的效果。" class="headerlink" title="mybatis的trim是更灵活的去处多余关键字的标签，他可以实践where和set的效果。"></a>mybatis的trim是更灵活的去处多余关键字的标签，他可以实践where和set的效果。</h3><p> where例子的等效trim语句：</p>
<pre><code>&lt;!-- 查询学生list，like姓名，=性别 --&gt;     
&lt;select id=&quot;getStudentListWhere&quot; parameterType=&quot;StudentEntity&quot; resultMap=&quot;studentResultMap&quot;&gt;     
    SELECT * from STUDENT_TBL ST      
    &lt;trim prefix=&quot;WHERE&quot; prefixOverrides=&quot;AND|OR&quot;&gt;     
        &lt;if test=&quot;studentName!=null and studentName!=&#39;&#39; &quot;&gt;     
            ST.STUDENT_NAME LIKE CONCAT(CONCAT(&#39;%&#39;, #&#123;studentName&#125;),&#39;%&#39;)      
        &lt;/if&gt;     
        &lt;if test=&quot;studentSex!= null and studentSex!= &#39;&#39; &quot;&gt;     
            AND ST.STUDENT_SEX = #&#123;studentSex&#125;      
        &lt;/if&gt;     
    &lt;/trim&gt;     
&lt;/select&gt;     
</code></pre>
<p>set例子的等效trim语句：</p>
<pre><code>&lt;!-- 更新学生信息 --&gt;     
&lt;update id=&quot;updateStudent&quot; parameterType=&quot;StudentEntity&quot;&gt;     
    UPDATE STUDENT_TBL      
    &lt;trim prefix=&quot;SET&quot; suffixOverrides=&quot;,&quot;&gt;     
        &lt;if test=&quot;studentName!=null and studentName!=&#39;&#39; &quot;&gt;     
            STUDENT_TBL.STUDENT_NAME = #&#123;studentName&#125;,      
        &lt;/if&gt;     
        &lt;if test=&quot;studentSex!=null and studentSex!=&#39;&#39; &quot;&gt;     
            STUDENT_TBL.STUDENT_SEX = #&#123;studentSex&#125;,      
        &lt;/if&gt;     
        &lt;if test=&quot;studentBirthday!=null &quot;&gt;     
            STUDENT_TBL.STUDENT_BIRTHDAY = #&#123;studentBirthday&#125;,      
        &lt;/if&gt;     
        &lt;if test=&quot;classEntity!=null and classEntity.classID!=null and classEntity.classID!=&#39;&#39; &quot;&gt;     
            STUDENT_TBL.CLASS_ID = #&#123;classEntity.classID&#125;      
        &lt;/if&gt;     
    &lt;/trim&gt;     
    WHERE STUDENT_TBL.STUDENT_ID = #&#123;studentID&#125;;      
&lt;/update&gt;     
</code></pre>
<h3 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose (when, otherwise)"></a>choose (when, otherwise)</h3><p>有时候我们并不想应用所有的条件，而只是想从多个选项中选择一个。MyBatis提供了choose 元素，按顺序判断when中的条件出否成立，如果有一个成立，则choose结束。当choose中所有when的条件都不满则时，则执行 otherwise中的sql。类似于Java 的switch 语句，choose为switch，when为case，otherwise则为default。</p>
<p>if是与(and)的关系，而choose是或（or）的关系。</p>
<pre><code>&lt;!-- 查询学生list，like姓名、或=性别、或=生日、或=班级，使用choose --&gt;     
&lt;select id=&quot;getStudentListChooseEntity&quot; parameterType=&quot;StudentEntity&quot; resultMap=&quot;studentResultMap&quot;&gt;     
    SELECT * from STUDENT_TBL ST      
    &lt;where&gt;     
        &lt;choose&gt;     
            &lt;when test=&quot;studentName!=null and studentName!=&#39;&#39; &quot;&gt;     
                    ST.STUDENT_NAME LIKE CONCAT(CONCAT(&#39;%&#39;, #&#123;studentName&#125;),&#39;%&#39;)      
            &lt;/when&gt;     
            &lt;when test=&quot;studentSex!= null and studentSex!= &#39;&#39; &quot;&gt;     
                    AND ST.STUDENT_SEX = #&#123;studentSex&#125;      
            &lt;/when&gt;     
            &lt;when test=&quot;studentBirthday!=null&quot;&gt;     
                AND ST.STUDENT_BIRTHDAY = #&#123;studentBirthday&#125;      
            &lt;/when&gt;     
            &lt;when test=&quot;classEntity!=null and classEntity.classID !=null and classEntity.classID!=&#39;&#39; &quot;&gt;     
                AND ST.CLASS_ID = #&#123;classEntity.classID&#125;      
            &lt;/when&gt;     
            &lt;otherwise&gt;     
                      
            &lt;/otherwise&gt;     
        &lt;/choose&gt;     
    &lt;/where&gt;     
&lt;/select&gt;     
</code></pre>
<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h3><p>对于动态SQL 非常必须的，主是要迭代一个集合，通常是用于IN 条件。<br>List 实例将使用“list”做为键，数组实例以“array” 做为键。</p>
<h4 id="参数为list实例的写法："><a href="#参数为list实例的写法：" class="headerlink" title="参数为list实例的写法："></a>参数为list实例的写法：</h4><pre><code>public List&lt;StudentEntity&gt; getStudentListByClassIDs(List&lt;String&gt; classList);
&lt;select id=&quot;getStudentListByClassIDs&quot; resultMap=&quot;studentResultMap&quot;&gt;     
    SELECT * FROM STUDENT_TBL ST      
     WHERE ST.CLASS_ID IN       
     &lt;foreach collection=&quot;list&quot; item=&quot;classList&quot;  open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;     
        #&#123;classList&#125;      
     &lt;/foreach&gt;         
&lt;/select&gt;     
</code></pre>
<h4 id="参数为Array实例的写法："><a href="#参数为Array实例的写法：" class="headerlink" title="参数为Array实例的写法："></a>参数为Array实例的写法：</h4><pre><code>public List&lt;StudentEntity&gt; getStudentListByClassIDs(String[] ids);
&lt;select id=&quot;getStudentListByClassIDs&quot; resultMap=&quot;studentResultMap&quot;&gt;     
    SELECT * FROM STUDENT_TBL ST      
     WHERE ST.CLASS_ID IN       
     &lt;foreach collection=&quot;array&quot; item=&quot;ids&quot;  open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;     
        #&#123;ids&#125;      
     &lt;/foreach&gt;     
&lt;/select&gt;   
</code></pre>
<h3 id="mybatis-与-的区别"><a href="#mybatis-与-的区别" class="headerlink" title="mybatis ${}与#{}的区别"></a>mybatis ${}与#{}的区别</h3><p>简单来说#{} 解析的是占位符？可以防止SQL注入， 比如打印出来的语句<code>select *　from table where id=?</code>,然而${} 则是不能防止SQL注入打印出来的语句 <code>select *　from table where id=2</code>  实实在在的参数。</p>
<p>最简单的区别就是${}解析穿过来的参数值不带单引号，#{}解析传过来参数带单引号。</p>
<p>最后总结一下必须使用$引用参数的情况，那就是参数的int型的时候，必须使用$引用。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/06/27/mybaties/" data-id="cllui4qz30034q0jag7kb3e8a" data-title="mybatis常用语法" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-java8新特性" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/06/21/java8%E6%96%B0%E7%89%B9%E6%80%A7/" class="article-date">
  <time class="dt-published" datetime="2017-06-20T16:00:00.000Z" itemprop="datePublished">2017-06-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/06/21/java8%E6%96%B0%E7%89%B9%E6%80%A7/">JDK1.8 十大新特性详解</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>“Java is still not dead—and people are starting to figure that out.”</p>
<h3 id="接口的默认方法"><a href="#接口的默认方法" class="headerlink" title="接口的默认方法"></a>接口的默认方法</h3><p>java 8允许我们给接口添加一个非抽象的方法实现，只需要使用 default关键字即可，这个特征又叫做扩展方法，示例如下：</p>
<pre><code>interface Formula &#123;
    double calculate(int a);
    default double sqrt(int a) &#123;
        return Math.sqrt(a);
    &#125;
&#125;
</code></pre>
<p>Formula接口在拥有calculate方法之外同时还定义了sqrt方法，实现了Formula接口的子类只需要实现一个calculate方法，默认方法sqrt将在子类上可以直接使用。</p>
<pre><code>Formula formula = new Formula() &#123;
    @Override
    public double calculate(int a) &#123;
        return sqrt(a * 100);
    &#125;
&#125;;
formula.calculate(100);     // 100.0
formula.sqrt(16);           // 4.0
</code></pre>
<p>文中的formula被实现为一个匿名类的实例，该代码非常容易理解，6行代码实现了计算 sqrt(a * 100)。在下一节中，我们将会看到实现单方法接口的更简单的做法。</p>
<p>译者注： 在Java中只有单继承，如果要让一个类赋予新的特性，通常是使用接口来实现，在C++中支持多继承，允许一个子类同时具有多个父类的接口与功能，在其他语言中，让一个类同时具有其他的可复用代码的方法叫做mixin。新的Java 8 的这个特新在编译器实现的角度上来说更加接近Scala的trait。 在C#中也有名为扩展方法的概念，允许给已存在的类型扩展方法，和Java 8的这个在语义上有差别。</p>
<h3 id="Lambda-表达式"><a href="#Lambda-表达式" class="headerlink" title="Lambda 表达式"></a>Lambda 表达式</h3><p>首先看看在老版本的Java中是如何排列字符串的：</p>
<pre><code>List&lt;String&gt; names = Arrays.asList(&quot;peter&quot;, &quot;anna&quot;, &quot;mike&quot;, &quot;xenia&quot;);
Collections.sort(names, new Comparator&lt;String&gt;() &#123;
    @Override
    public int compare(String a, String b) &#123;
        return b.compareTo(a);
    &#125;
&#125;);
</code></pre>
<p>只需要给静态方法 Collections.sort 传入一个List对象以及一个比较器来按指定顺序排列。通常做法都是创建一个匿名的比较器对象然后将其传递给sort方法。</p>
<p>在Java 8 中你就没必要使用这种传统的匿名对象的方式了，Java 8提供了更简洁的语法，lambda表达式：</p>
<pre><code>Collections.sort(names, (String a, String b) -&gt; &#123;
    return b.compareTo(a);
&#125;);
</code></pre>
<p>看到了吧，代码变得更段且更具有可读性，但是实际上还可以写得更短：</p>
<pre><code>Collections.sort(names, (String a, String b) -&gt; b.compareTo(a));
</code></pre>
<p>对于函数体只有一行代码的，你可以去掉大括号{}以及return关键字，但是你还可以写得更短点：</p>
<pre><code>Collections.sort(names, (a, b) -&gt; b.compareTo(a));
</code></pre>
<p>Java编译器可以自动推导出参数类型，所以你可以不用再写一次类型。</p>
<h3 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h3><p>Lambda表达式是如何在java的类型系统中表示的呢？每一个lambda表达式都对应一个类型，通常是接口类型。而“函数式接口”是指仅仅只包含一个抽象方法的接口，每一个该类型的lambda表达式都会被匹配到这个抽象方法。因为 默认方法 不算抽象方法，所以你也可以给你的函数式接口添加默认方法。</p>
<p>我们可以将lambda表达式当作任意只包含一个抽象方法的接口类型，确保你的接口一定达到这个要求，你只需要给你的接口添加 @FunctionalInterface 注解，编译器如果发现你标注了这个注解的接口有多于一个抽象方法的时候会报错的。</p>
<pre><code>@FunctionalInterface
interface Converter&lt;F, T&gt; &#123;
    T convert(F from);
&#125;
Converter&lt;String, Integer&gt; converter = (from) -&gt; Integer.valueOf(from);
Integer converted = converter.convert(&quot;123&quot;);
System.out.println(converted);    // 123
</code></pre>
<p>需要注意如果@FunctionalInterface如果没有指定，上面的代码也是对的。</p>
<p>译者注：将lambda表达式映射到一个单方法的接口上，这种做法在Java 8之前就有别的语言实现，比如Rhino JavaScript解释器，如果一个函数参数接收一个单方法的接口而你传递的是一个function，Rhino 解释器会自动做一个单接口的实例到function的适配器，典型的应用场景有 org.w3c.dom.events.EventTarget 的addEventListener 第二个参数 EventListener。</p>
<h3 id="方法与构造函数引用"><a href="#方法与构造函数引用" class="headerlink" title="方法与构造函数引用"></a>方法与构造函数引用</h3><p>前一节中的代码还可以通过静态方法引用来表示：</p>
<pre><code>Converter&lt;String, Integer&gt; converter = Integer::valueOf;
Integer converted = converter.convert(&quot;123&quot;);
System.out.println(converted);   // 123
</code></pre>
<p>Java 8 允许你使用 :: 关键字来传递方法或者构造函数引用，上面的代码展示了如何引用一个静态方法，我们也可以引用一个对象的方法：</p>
<pre><code>converter = something::startsWith;
String converted = converter.convert(&quot;Java&quot;);
System.out.println(converted);    // &quot;J&quot;
</code></pre>
<p>接下来看看构造函数是如何使用::关键字来引用的，首先我们定义一个包含多个构造函数的简单类：</p>
<pre><code>class Person &#123;
    String firstName;
    String lastName;
    Person() &#123;&#125;
    Person(String firstName, String lastName) &#123;
        this.firstName = firstName;
        this.lastName = lastName;
    &#125;
&#125;
</code></pre>
<p>接下来我们指定一个用来创建Person对象的对象工厂接口：</p>
<pre><code>interface PersonFactory&lt;P extends Person&gt; &#123;
    P create(String firstName, String lastName);
&#125;
</code></pre>
<p>这里我们使用构造函数引用来将他们关联起来，而不是实现一个完整的工厂：</p>
<pre><code>PersonFactory&lt;Person&gt; personFactory = Person::new;
Person person = personFactory.create(&quot;Peter&quot;, &quot;Parker&quot;);
</code></pre>
<p>我们只需要使用 Person::new 来获取Person类构造函数的引用，Java编译器会自动根据PersonFactory.create方法的签名来选择合适的构造函数。</p>
<h3 id="Lambda-作用域"><a href="#Lambda-作用域" class="headerlink" title="Lambda 作用域"></a>Lambda 作用域</h3><p>在lambda表达式中访问外层作用域和老版本的匿名对象中的方式很相似。你可以直接访问标记了final的外层局部变量，或者实例的字段以及静态变量。</p>
<h3 id="访问局部变量"><a href="#访问局部变量" class="headerlink" title="访问局部变量"></a>访问局部变量</h3><p>我们可以直接在lambda表达式中访问外层的局部变量：</p>
<pre><code>final int num = 1;
Converter&lt;Integer, String&gt; stringConverter =
        (from) -&gt; String.valueOf(from + num);
stringConverter.convert(2);     // 3
</code></pre>
<p>但是和匿名对象不同的是，这里的变量num可以不用声明为final，该代码同样正确：</p>
<pre><code>int num = 1;
Converter&lt;Integer, String&gt; stringConverter =
        (from) -&gt; String.valueOf(from + num);
stringConverter.convert(2);     // 3
</code></pre>
<p>不过这里的num必须不可被后面的代码修改。在lambda表达式中试图修改num同样是不允许的。（即隐性的具有final的语义）</p>
<h3 id="访问对象字段与静态变量"><a href="#访问对象字段与静态变量" class="headerlink" title="访问对象字段与静态变量"></a>访问对象字段与静态变量</h3><p>和本地变量不同的是，lambda内部对于实例的字段以及静态变量是即可读又可写。该行为和匿名对象是一致的：</p>
<pre><code>class Lambda4 &#123;
    static int outerStaticNum;
    int outerNum;
    void testScopes() &#123;
        Converter&lt;Integer, String&gt; stringConverter1 = (from) -&gt; &#123;
            outerNum = 23;
            return String.valueOf(from);
        &#125;;
        Converter&lt;Integer, String&gt; stringConverter2 = (from) -&gt; &#123;
            outerStaticNum = 72;
            return String.valueOf(from);
        &#125;;
    &#125;
&#125;
</code></pre>
<h3 id="访问接口的默认方法"><a href="#访问接口的默认方法" class="headerlink" title="访问接口的默认方法"></a>访问接口的默认方法</h3><p>还记得第一节中的formula例子么，接口Formula定义了一个默认方法sqrt可以直接被formula的实例包括匿名对象访问到，但是在lambda表达式中这个是不行的。<br>Lambda表达式中是无法访问到默认方法的。</p>
<p>JDK 1.8 API包含了很多内建的函数式接口，在老Java中常用到的比如Comparator或者Runnable接口，这些接口都增加了@FunctionalInterface注解以便能用在lambda上。<br>Java 8 API同样还提供了很多全新的函数式接口来让工作更加方便，有一些接口是来自Google Guava库里的，即便你对这些很熟悉了，还是有必要看看这些是如何扩展到lambda上使用的。</p>
<h4 id="Predicate接口"><a href="#Predicate接口" class="headerlink" title="Predicate接口"></a>Predicate接口</h4><p>Predicate 接口只有一个参数，返回boolean类型。该接口包含多种默认方法来将Predicate组合成其他复杂的逻辑（比如：与，或，非）：</p>
<pre><code>Predicate&lt;String&gt; predicate = (s) -&gt; s.length() &gt; 0;
predicate.test(&quot;foo&quot;);              // true
predicate.negate().test(&quot;foo&quot;);     // false
Predicate&lt;Boolean&gt; nonNull = Objects::nonNull;
Predicate&lt;Boolean&gt; isNull = Objects::isNull;
Predicate&lt;String&gt; isEmpty = String::isEmpty;
Predicate&lt;String&gt; isNotEmpty = isEmpty.negate();
</code></pre>
<h4 id="Function接口"><a href="#Function接口" class="headerlink" title="Function接口"></a>Function接口</h4><p>Function 接口有一个参数并且返回一个结果，并附带了一些可以和其他函数组合的默认方法（compose, andThen）：</p>
<pre><code>Function&lt;String, Integer&gt; toInteger = Integer::valueOf;
Function&lt;String, String&gt; backToString = toInteger.andThen(String::valueOf);
backToString.apply(&quot;123&quot;);     // &quot;123&quot;
</code></pre>
<h4 id="Supplier接口"><a href="#Supplier接口" class="headerlink" title="Supplier接口"></a>Supplier接口</h4><p>Supplier 接口返回一个任意范型的值，和Function接口不同的是该接口没有任何参数</p>
<pre><code>Supplier&lt;Person&gt; personSupplier = Person::new;
personSupplier.get();   // new Person
</code></pre>
<h4 id="Consumer接口"><a href="#Consumer接口" class="headerlink" title="Consumer接口"></a>Consumer接口</h4><p>Consumer 接口表示执行在单个参数上的操作。</p>
<pre><code>Consumer&lt;Person&gt; greeter = (p) -&gt; System.out.println(&quot;Hello, &quot; + p.firstName);
greeter.accept(new Person(&quot;Luke&quot;, &quot;Skywalker&quot;));
</code></pre>
<h4 id="Comparator接口"><a href="#Comparator接口" class="headerlink" title="Comparator接口"></a>Comparator接口</h4><p>Comparator 是老Java中的经典接口， Java 8在此之上添加了多种默认方法：</p>
<pre><code>Comparator&lt;Person&gt; comparator = (p1, p2) -&gt; p1.firstName.compareTo(p2.firstName);
Person p1 = new Person(&quot;John&quot;, &quot;Doe&quot;);
Person p2 = new Person(&quot;Alice&quot;, &quot;Wonderland&quot;);
comparator.compare(p1, p2);             // &gt; 0
comparator.reversed().compare(p1, p2);  // &lt; 0
</code></pre>
<h4 id="Optional接口"><a href="#Optional接口" class="headerlink" title="Optional接口"></a>Optional接口</h4><p>Optional 不是函数是接口，这是个用来防止NullPointerException异常的辅助类型，这是下一届中将要用到的重要概念，现在先简单的看看这个接口能干什么：<br>Optional 被定义为一个简单的容器，其值可能是null或者不是null。在Java 8之前一般某个函数应该返回非空对象但是偶尔却可能返回了null，而在Java 8中，不推荐你返回null而是返回Optional。</p>
<pre><code>Optional&lt;String&gt; optional = Optional.of(&quot;bam&quot;);
optional.isPresent();           // true
optional.get();                 // &quot;bam&quot;
optional.orElse(&quot;fallback&quot;);    // &quot;bam&quot;
optional.ifPresent((s) -&gt; System.out.println(s.charAt(0)));     // &quot;b&quot;
</code></pre>
<h4 id="Stream接口"><a href="#Stream接口" class="headerlink" title="Stream接口"></a>Stream接口</h4><p>java.util.Stream 表示能应用在一组元素上一次执行的操作序列。Stream 操作分为中间操作或者最终操作两种，最终操作返回一特定类型的计算结果，而中间操作返回Stream本身，这样你就可以将多个操作依次串起来。Stream 的创建需要指定一个数据源，比如 java.util.Collection的子类，List或者Set， Map不支持。Stream的操作可以串行执行或者并行执行。<br>首先看看Stream是怎么用，首先创建实例代码的用到的数据List：</p>
<pre><code>List&lt;String&gt; stringCollection = new ArrayList&lt;&gt;();
stringCollection.add(&quot;ddd2&quot;);
stringCollection.add(&quot;aaa2&quot;);
stringCollection.add(&quot;bbb1&quot;);
stringCollection.add(&quot;aaa1&quot;);
stringCollection.add(&quot;bbb3&quot;);
stringCollection.add(&quot;ccc&quot;);
stringCollection.add(&quot;bbb2&quot;);
stringCollection.add(&quot;ddd1&quot;);
</code></pre>
<p>Java 8扩展了集合类，可以通过 Collection.stream() 或者 Collection.parallelStream() 来创建一个Stream。下面几节将详细解释常用的Stream操作：</p>
<h5 id="Filter-过滤"><a href="#Filter-过滤" class="headerlink" title="Filter 过滤"></a>Filter 过滤</h5><p>过滤通过一个predicate接口来过滤并只保留符合条件的元素，该操作属于中间操作，所以我们可以在过滤后的结果来应用其他Stream操作（比如forEach）。forEach需要一个函数来对过滤后的元素依次执行。forEach是一个最终操作，所以我们不能在forEach之后来执行其他Stream操作。</p>
<pre><code>stringCollection
    .stream()
    .filter((s) -&gt; s.startsWith(&quot;a&quot;))
    .forEach(System.out::println);
// &quot;aaa2&quot;, &quot;aaa1&quot;
</code></pre>
<h5 id="Sort-排序"><a href="#Sort-排序" class="headerlink" title="Sort 排序"></a>Sort 排序</h5><p>排序是一个中间操作，返回的是排序好后的Stream。如果你不指定一个自定义的Comparator则会使用默认排序。</p>
<pre><code>stringCollection
    .stream()
    .sorted()
    .filter((s) -&gt; s.startsWith(&quot;a&quot;))
    .forEach(System.out::println);
// &quot;aaa1&quot;, &quot;aaa2&quot;
</code></pre>
<p>需要注意的是，排序只创建了一个排列好后的Stream，而不会影响原有的数据源，排序之后原数据stringCollection是不会被修改的：</p>
<p>System.out.println(stringCollection);<br>&#x2F;&#x2F; ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1</p>
<h5 id="Map-映射"><a href="#Map-映射" class="headerlink" title="Map 映射"></a>Map 映射</h5><p>中间操作map会将元素根据指定的Function接口来依次将元素转成另外的对象，下面的示例展示了将字符串转换为大写字符串。你也可以通过map来讲对象转换成其他类型，map返回的Stream类型是根据你map传递进去的函数的返回值决定的。</p>
<pre><code>stringCollection
    .stream()
    .map(String::toUpperCase)
    .sorted((a, b) -&gt; b.compareTo(a))
    .forEach(System.out::println);
// &quot;DDD2&quot;, &quot;DDD1&quot;, &quot;CCC&quot;, &quot;BBB3&quot;, &quot;BBB2&quot;, &quot;AAA2&quot;, &quot;AAA1&quot;
</code></pre>
<h5 id="Match-匹配"><a href="#Match-匹配" class="headerlink" title="Match 匹配"></a>Match 匹配</h5><p>Stream提供了多种匹配操作，允许检测指定的Predicate是否匹配整个Stream。所有的匹配操作都是最终操作，并返回一个boolean类型的值。</p>
<pre><code>boolean anyStartsWithA = 
    stringCollection
        .stream()
        .anyMatch((s) -&gt; s.startsWith(&quot;a&quot;));
System.out.println(anyStartsWithA);      // true
boolean allStartsWithA = 
    stringCollection
        .stream()
        .allMatch((s) -&gt; s.startsWith(&quot;a&quot;));
System.out.println(allStartsWithA);      // false
boolean noneStartsWithZ = 
    stringCollection
        .stream()
        .noneMatch((s) -&gt; s.startsWith(&quot;z&quot;));
System.out.println(noneStartsWithZ);      // true
</code></pre>
<h5 id="Count-计数"><a href="#Count-计数" class="headerlink" title="Count 计数"></a>Count 计数</h5><p>计数是一个最终操作，返回Stream中元素的个数，返回值类型是long。</p>
<pre><code>long startsWithB = 
    stringCollection
        .stream()
        .filter((s) -&gt; s.startsWith(&quot;b&quot;))
        .count();
System.out.println(startsWithB);    // 3
</code></pre>
<h5 id="Reduce-规约"><a href="#Reduce-规约" class="headerlink" title="Reduce 规约"></a>Reduce 规约</h5><p>这是一个最终操作，允许通过指定的函数来讲stream中的多个元素规约为一个元素，规越后的结果是通过Optional接口表示的：</p>
<pre><code>Optional&lt;String&gt; reduced =
    stringCollection
        .stream()
        .sorted()
        .reduce((s1, s2) -&gt; s1 + &quot;#&quot; + s2);
reduced.ifPresent(System.out::println);
// &quot;aaa1#aaa2#bbb1#bbb2#bbb3#ccc#ddd1#ddd2&quot;
</code></pre>
<h4 id="并行Streams"><a href="#并行Streams" class="headerlink" title="并行Streams"></a>并行Streams</h4><p>前面提到过Stream有串行和并行两种，串行Stream上的操作是在一个线程中依次完成，而并行Stream则是在多个线程上同时执行。</p>
<p>下面的例子展示了是如何通过并行Stream来提升性能：</p>
<p>首先我们创建一个没有重复元素的大表：</p>
<pre><code>int max = 1000000;
List&lt;String&gt; values = new ArrayList&lt;&gt;(max);
for (int i = 0; i &lt; max; i++) &#123;
    UUID uuid = UUID.randomUUID();
    values.add(uuid.toString());
&#125;
</code></pre>
<p>然后我们计算一下排序这个Stream要耗时多久，<br>串行排序：</p>
<pre><code>long t0 = System.nanoTime();
long count = values.stream().sorted().count();
System.out.println(count);
long t1 = System.nanoTime();
long millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);
System.out.println(String.format(&quot;sequential sort took: %d ms&quot;, millis));
</code></pre>
<p>&#x2F;&#x2F; 串行耗时: 899 ms</p>
<p>并行排序：</p>
<pre><code>long t0 = System.nanoTime();
long count = values.parallelStream().sorted().count();
System.out.println(count);
long t1 = System.nanoTime();
long millis = TimeUnit.NANOSECONDS.toMillis(t1 - t0);
System.out.println(String.format(&quot;parallel sort took: %d ms&quot;, millis));
</code></pre>
<p>&#x2F;&#x2F; 并行排序耗时: 472 ms</p>
<p>上面两个代码几乎是一样的，但是并行版的快了50%之多，唯一需要做的改动就是将stream()改为parallelStream()。</p>
<h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><p>前面提到过，Map类型不支持stream，不过Map提供了一些新的有用的方法来处理一些日常任务。</p>
<pre><code>Map&lt;Integer, String&gt; map = new HashMap&lt;&gt;();
for (int i = 0; i &lt; 10; i++) &#123;
    map.putIfAbsent(i, &quot;val&quot; + i);
&#125;
</code></pre>
<p>map.forEach((id, val) -&gt; System.out.println(val));<br>以上代码很容易理解， putIfAbsent 不需要我们做额外的存在性检查，而forEach则接收一个Consumer接口来对map里的每一个键值对进行操作。</p>
<p>下面的例子展示了map上的其他有用的函数：</p>
<pre><code>map.computeIfPresent(3, (num, val) -&gt; val + num);
map.get(3);             // val33
map.computeIfPresent(9, (num, val) -&gt; null);
map.containsKey(9);     // false
map.computeIfAbsent(23, num -&gt; &quot;val&quot; + num);
map.containsKey(23);    // true
map.computeIfAbsent(3, num -&gt; &quot;bam&quot;);
map.get(3);             // val33
</code></pre>
<p>接下来展示如何在Map里删除一个键值全都匹配的项：</p>
<pre><code>map.remove(3, &quot;val3&quot;);
map.get(3);             // val33
map.remove(3, &quot;val33&quot;);
map.get(3);             // null
</code></pre>
<p>另外一个有用的方法：</p>
<pre><code>map.getOrDefault(42, &quot;not found&quot;);  // not found
</code></pre>
<p>对Map的元素做合并也变得很容易了：</p>
<pre><code>map.merge(9, &quot;val9&quot;, (value, newValue) -&gt; value.concat(newValue));
map.get(9);             // val9
map.merge(9, &quot;concat&quot;, (value, newValue) -&gt; value.concat(newValue));
map.get(9);             // val9concat
</code></pre>
<p>Merge做的事情是如果键名不存在则插入，否则则对原键对应的值做合并操作并重新插入到map中。</p>
<h3 id="Date-API"><a href="#Date-API" class="headerlink" title="Date API"></a>Date API</h3><p>Java 8 在包java.time下包含了一组全新的时间日期API。新的日期API和开源的Joda-Time库差不多，但又不完全一样，下面的例子展示了这组新API里最重要的一些部分：</p>
<h4 id="Clock-时钟"><a href="#Clock-时钟" class="headerlink" title="Clock 时钟"></a>Clock 时钟</h4><p>Clock类提供了访问当前日期和时间的方法，Clock是时区敏感的，可以用来取代 System.currentTimeMillis() 来获取当前的微秒数。某一个特定的时间点也可以使用Instant类来表示，Instant类也可以用来创建老的java.util.Date对象。</p>
<pre><code>Clock clock = Clock.systemDefaultZone();
long millis = clock.millis();
Instant instant = clock.instant();
Date legacyDate = Date.from(instant);   // legacy java.util.Date
</code></pre>
<h4 id="Timezones-时区"><a href="#Timezones-时区" class="headerlink" title="Timezones 时区"></a>Timezones 时区</h4><p>在新API中时区使用ZoneId来表示。时区可以很方便的使用静态方法of来获取到。 时区定义了到UTS时间的时间差，在Instant时间点对象到本地日期对象之间转换的时候是极其重要的。</p>
<pre><code>System.out.println(ZoneId.getAvailableZoneIds());
// prints all available timezone ids
ZoneId zone1 = ZoneId.of(&quot;Europe/Berlin&quot;);
ZoneId zone2 = ZoneId.of(&quot;Brazil/East&quot;);
System.out.println(zone1.getRules());
System.out.println(zone2.getRules());
// ZoneRules[currentStandardOffset=+01:00]
// ZoneRules[currentStandardOffset=-03:00]
</code></pre>
<h4 id="LocalTime-本地时间"><a href="#LocalTime-本地时间" class="headerlink" title="LocalTime 本地时间"></a>LocalTime 本地时间</h4><p>LocalTime 定义了一个没有时区信息的时间，例如 晚上10点，或者 17:30:15。下面的例子使用前面代码创建的时区创建了两个本地时间。之后比较时间并以小时和分钟为单位计算两个时间的时间差：</p>
<pre><code>LocalTime now1 = LocalTime.now(zone1);
LocalTime now2 = LocalTime.now(zone2);
System.out.println(now1.isBefore(now2));  // false
long hoursBetween = ChronoUnit.HOURS.between(now1, now2);
long minutesBetween = ChronoUnit.MINUTES.between(now1, now2);
System.out.println(hoursBetween);       // -3
System.out.println(minutesBetween);     // -239
</code></pre>
<p>LocalTime 提供了多种工厂方法来简化对象的创建，包括解析时间字符串。</p>
<pre><code>LocalTime late = LocalTime.of(23, 59, 59);
System.out.println(late);       // 23:59:59
DateTimeFormatter germanFormatter =
    DateTimeFormatter
        .ofLocalizedTime(FormatStyle.SHORT)
        .withLocale(Locale.GERMAN);
LocalTime leetTime = LocalTime.parse(&quot;13:37&quot;, germanFormatter);
System.out.println(leetTime);   // 13:37
</code></pre>
<h4 id="LocalDate-本地日期"><a href="#LocalDate-本地日期" class="headerlink" title="LocalDate 本地日期"></a>LocalDate 本地日期</h4><p>LocalDate 表示了一个确切的日期，比如 2014-03-11。该对象值是不可变的，用起来和LocalTime基本一致。下面的例子展示了如何给Date对象加减天&#x2F;月&#x2F;年。另外要注意的是这些对象是不可变的，操作返回的总是一个新实例。</p>
<pre><code>LocalDate today = LocalDate.now();
LocalDate tomorrow = today.plus(1, ChronoUnit.DAYS);
LocalDate yesterday = tomorrow.minusDays(2);
LocalDate independenceDay = LocalDate.of(2014, Month.JULY, 4);
DayOfWeek dayOfWeek = independenceDay.getDayOfWeek();

System.out.println(dayOfWeek);    // FRIDAY
</code></pre>
<p>从字符串解析一个LocalDate类型和解析LocalTime一样简单：</p>
<pre><code>DateTimeFormatter germanFormatter =
    DateTimeFormatter
        .ofLocalizedDate(FormatStyle.MEDIUM)
        .withLocale(Locale.GERMAN);
LocalDate xmas = LocalDate.parse(&quot;24.12.2014&quot;, germanFormatter);
System.out.println(xmas);   // 2014-12-24
</code></pre>
<h4 id="LocalDateTime-本地日期时间"><a href="#LocalDateTime-本地日期时间" class="headerlink" title="LocalDateTime 本地日期时间"></a>LocalDateTime 本地日期时间</h4><p>LocalDateTime 同时表示了时间和日期，相当于前两节内容合并到一个对象上了。LocalDateTime和LocalTime还有LocalDate一样，都是不可变的。LocalDateTime提供了一些能访问具体字段的方法。</p>
<pre><code>LocalDateTime sylvester = LocalDateTime.of(2014, Month.DECEMBER, 31, 23, 59, 59);
DayOfWeek dayOfWeek = sylvester.getDayOfWeek();
System.out.println(dayOfWeek);      // WEDNESDAY
Month month = sylvester.getMonth();
System.out.println(month);          // DECEMBER
long minuteOfDay = sylvester.getLong(ChronoField.MINUTE_OF_DAY);
System.out.println(minuteOfDay);    // 1439
</code></pre>
<p>只要附加上时区信息，就可以将其转换为一个时间点Instant对象，Instant时间点对象可以很容易的转换为老式的java.util.Date。</p>
<pre><code>Instant instant = sylvester
        .atZone(ZoneId.systemDefault())
        .toInstant();
Date legacyDate = Date.from(instant);
System.out.println(legacyDate);     // Wed Dec 31 23:59:59 CET 2014
</code></pre>
<p>格式化LocalDateTime和格式化时间和日期一样的，除了使用预定义好的格式外，我们也可以自己定义格式：</p>
<pre><code>DateTimeFormatter formatter =
    DateTimeFormatter
        .ofPattern(&quot;MMM dd, yyyy - HH:mm&quot;);
LocalDateTime parsed = LocalDateTime.parse(&quot;Nov 03, 2014 - 07:13&quot;, formatter);
String string = formatter.format(parsed);
System.out.println(string);     // Nov 03, 2014 - 07:13
</code></pre>
<p>和java.text.NumberFormat不一样的是新版的DateTimeFormatter是不可变的，所以它是线程安全的。<br>关于时间日期格式的详细信息：<br><a target="_blank" rel="noopener" href="http://download.java.net/jdk8/docs/api/java/time/format/DateTimeFormatter.html">http://download.java.net/jdk8/docs/api/java/time/format/DateTimeFormatter.html</a></p>
<h3 id="Annotation-注解"><a href="#Annotation-注解" class="headerlink" title="Annotation 注解"></a>Annotation 注解</h3><p>在Java 8中支持多重注解了，先看个例子来理解一下是什么意思。<br>首先定义一个包装类Hints注解用来放置一组具体的Hint注解：</p>
<pre><code>@interface Hints &#123;
    Hint[] value();
&#125;
@Repeatable(Hints.class)
@interface Hint &#123;
    String value();
&#125;
</code></pre>
<p>Java 8允许我们把同一个类型的注解使用多次，只需要给该注解标注一下@Repeatable即可。</p>
<p>例 1: 使用包装类当容器来存多个注解（老方法）</p>
<pre><code>@Hints(&#123;@Hint(&quot;hint1&quot;), @Hint(&quot;hint2&quot;)&#125;)
class Person &#123;&#125;
</code></pre>
<p>例 2：使用多重注解（新方法）</p>
<pre><code>@Hint(&quot;hint1&quot;)
@Hint(&quot;hint2&quot;)
class Person &#123;&#125;
</code></pre>
<p>第二个例子里java编译器会隐性的帮你定义好@Hints注解，了解这一点有助于你用反射来获取这些信息：</p>
<pre><code>Hint hint = Person.class.getAnnotation(Hint.class);
System.out.println(hint);                   // null
Hints hints1 = Person.class.getAnnotation(Hints.class);
System.out.println(hints1.value().length);  // 2
Hint[] hints2 = Person.class.getAnnotationsByType(Hint.class);
System.out.println(hints2.length);          // 2
</code></pre>
<p>即便我们没有在Person类上定义@Hints注解，我们还是可以通过 getAnnotation(Hints.class) 来获取 @Hints注解，更加方便的方法是使用 getAnnotationsByType 可以直接获取到所有的@Hint注解。</p>
<p>另外Java 8的注解还增加到两种新的target上了：</p>
<pre><code>@Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)
@interface MyAnnotation &#123;&#125;
</code></pre>
<p>关于Java 8的新特性就写到这了，肯定还有更多的特性等待发掘。JDK 1.8里还有很多很有用的东西，比如Arrays.parallelSort, StampedLock和CompletableFuture等等。</p>
<p><a target="_blank" rel="noopener" href="http://www.jb51.net/article/48304.htm">原文链接</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/06/21/java8%E6%96%B0%E7%89%B9%E6%80%A7/" data-id="cllui4qz2002nq0ja0gwgc620" data-title="JDK1.8 十大新特性详解" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JAVA/" rel="tag">JAVA</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-软件架构师的12项修炼3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/06/10/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC3/" class="article-date">
  <time class="dt-published" datetime="2017-06-09T16:00:00.000Z" itemprop="datePublished">2017-06-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/improve/">improve</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/06/10/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC3/">关系技能修炼篇&lt;三&gt;</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="协商"><a href="#协商" class="headerlink" title="协商"></a>协商</h3><p><code>在商业活动中，你不是得到你应得的，而是得到你谈判得来的。 - Chester L.Karrass</code></p>
<p><code>我的父亲曾说过：“你不能每笔生意都赚尽所有的钱。要让其他人也能赢利，因为倘若你有了总是赚尽所有钱的名声，就不会有多少生意了。” - J.Paul Getty</code></p>
<p><code>协商过程中，聪明的做法是不做无礼的事。如果你不进行人身攻击，就能更客观的看到机会。 - Brian Koslow</code></p>
<p>对于架构师而言，协商技巧是将项目推向成功，并使之运转顺畅的第一个关键技能。</p>
<p>当刚成为架构师时，你很可能会在刚开始的几天下班时回想一天所做的事情，却不知道做了什么。你只是想做出个很小的决定，居然像把整个单位闹的鸡犬不宁一样，以致你的上司对你一点都不满意。</p>
<p>逐渐的，在重演事件的顺序时，你开始明白问题的根源不在于技术本身，而是社会性 - 所有技术人员都不擅长的领域。</p>
<p>你开始认识到单位里对某项决定的支持并非现成的；决定尚未被“预先社会化”说明现实还是有许多非技术性的因素在起作用。而你和你的上司必须面对你所暴露出来的单位灾难，这真是一场不愉快的经历。</p>
<p>架构师的角色在一个单位中可以以多种形式出现，从企业架构师到平台架构师，到应用架构师，到研究架构师。每种架构师角色的职责和所要求的协商领域不同，但有一点是肯定的：协商能力是所有架构师的关键财富。</p>
<h4 id="协商原则"><a href="#协商原则" class="headerlink" title="协商原则"></a>协商原则</h4><p>无论何时你从事协商过程，都要遵循一系列协商原则。对于参与的各方，包括你自己，这都是适用的指导性原则。</p>
<p><img src="https://luminghub.github.io/images/imgs/SoftwareArchitects/Part2/01.png"></p>
<blockquote>
<p>架构师的沟通首先基于沟通原则，其实是沟通策略，在此之上是与执行官的有效沟通 </p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/06/10/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC3/" data-id="cllui4qz80049q0ja0737cm45" data-title="关系技能修炼篇&lt;三&gt;" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC/" rel="tag">软件架构师的12项修炼</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Jenkins" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/29/Jenkins/" class="article-date">
  <time class="dt-published" datetime="2017-05-28T16:00:00.000Z" itemprop="datePublished">2017-05-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/29/Jenkins/">Jenkins</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Jenkins功能"><a href="#Jenkins功能" class="headerlink" title="Jenkins功能"></a>Jenkins功能</h2><p>Jenkins是基于Java开发的一种持续集成工具，用于监控持续重复的工作，功能包括：</p>
<ol>
<li><p>持续的软件版本发布&#x2F;测试项目。</p>
</li>
<li><p>监控外部调用执行的工作。</p>
</li>
</ol>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>这里简单介绍如何搭建jenkins运行环境。</p>
<h3 id="安装jdk"><a href="#安装jdk" class="headerlink" title="安装jdk"></a>安装jdk</h3><p><a target="_blank" rel="noopener" href="https://www.oracle.com/index.html">oracle官网</a></p>
<h3 id="安装jenkins"><a href="#安装jenkins" class="headerlink" title="安装jenkins"></a>安装jenkins</h3><p>JDK 1.8.x + tomcat 8.x + Jenkins 2.62</p>
<p><a target="_blank" rel="noopener" href="http://tomcat.apache.org/">tomcat官网</a></p>
<pre><code>wget http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-8/v8.5.15/bin/apache-tomcat-8.5.15.zip
</code></pre>
<p><a target="_blank" rel="noopener" href="https://jenkins.io/download/">Jenkins官网</a></p>
<pre><code>wget http://mirrors.jenkins.io/war/latest/jenkins.war
</code></pre>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/001.png"></p>
<p>将 jenkins.war 复制到tomcat的webapp目录下，启动tomcat。（默认端口为8080）</p>
<p>如果tomcat权限不够无法启动，修改bin目录的下的执行文件权限</p>
<pre><code>chmod u+x *.sh
</code></pre>
<p>输入 <code>http://ip:8080/jenkins/</code>访问jenkins的dashboard。</p>
<h3 id="找到登录密码"><a href="#找到登录密码" class="headerlink" title="找到登录密码"></a>找到登录密码</h3><p><img src="https://luminghub.github.io/images/imgs/jenkins/003.png"></p>
<pre><code>cat /home/ubuntu/.jenkins/secrets/initialAdminPassword
</code></pre>
<h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><p>选择自定义安装插件</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/004.png"></p>
<h3 id="创建管理员用户"><a href="#创建管理员用户" class="headerlink" title="创建管理员用户"></a>创建管理员用户</h3><p>创建完管理员用户，成功后会跳到dashboard的首页。</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/002.png"></p>
<h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><p><a target="_blank" rel="noopener" href="https://git-scm.com/download/linux">官网</a></p>
<pre><code>apt-get install git
</code></pre>
<p>配置gitlab的ssh密钥</p>
<pre><code>ssh-keygen -t rsa -C &quot;luming@mlogcn.com&quot;
</code></pre>
<p>生成路径变换成	<code>/home/ubuntu/.ssh/gitlab_rsa</code></p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/005.png"></p>
<p>获取公钥信息，并复制到gitlab中</p>
<pre><code>cat ~/.ssh/gitlab_rsa.pub
</code></pre>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/006.png"></p>
<p>编辑~&#x2F;.ssh&#x2F;config文件，如果没有，就创建一个，在其中写入如下配置内容</p>
<pre><code>Host gitlab.mlogcn.com
     IdentityFile ~/.ssh/gitlab_rsa
</code></pre>
<p>初始化GIT信息</p>
<pre><code>git config --global user.name &quot;luming&quot;
git config --global user.email &quot;luming@mlogcn.com&quot;
</code></pre>
<p>测试git的ssh key 配置情况</p>
<pre><code>git clone xxx
</code></pre>
<h3 id="安装maven"><a href="#安装maven" class="headerlink" title="安装maven"></a>安装maven</h3><p><a target="_blank" rel="noopener" href="http://maven.apache.org/download.cgi">官网</a></p>
<pre><code>wget http://apache.fayea.com/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.zip
</code></pre>
<p>设置maven环境变量</p>
<pre><code>vim /etc/profile
export PATH=/home/ubuntu/apache-maven-3.3.9/bin:$PATH
source /etc/profile
</code></pre>
<p>测试maven：编译git中clone下来的项目</p>
<pre><code>mvn clean install -Dmaven.test.skip=true
</code></pre>
<h3 id="配置jenkins"><a href="#配置jenkins" class="headerlink" title="配置jenkins"></a>配置jenkins</h3><p>系统管理 -&gt; Global Tool Configuration</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/013.jpg"></p>
<h4 id="配置JDK"><a href="#配置JDK" class="headerlink" title="配置JDK"></a>配置JDK</h4><p>如图，勾掉自动安装，填写jdk环境信息</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/014.jpg"></p>
<h4 id="配置git"><a href="#配置git" class="headerlink" title="配置git"></a>配置git</h4><p>如图，勾掉自动安装，填写git环境信息</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/015.jpg"></p>
<h4 id="配置maven"><a href="#配置maven" class="headerlink" title="配置maven"></a>配置maven</h4><p>查看maven安装信息</p>
<pre><code>mvn --version
</code></pre>
<p>如图，勾掉自动安装，填写maven环境信息</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/016.jpg"></p>
<h2 id="使用jenkins"><a href="#使用jenkins" class="headerlink" title="使用jenkins"></a>使用jenkins</h2><h3 id="创建一个新任务"><a href="#创建一个新任务" class="headerlink" title="创建一个新任务"></a>创建一个新任务</h3><p>点击创建一个新任务，进入任务创建页面</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/007.png"></p>
<p>创建一个maven工程</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/008.png"></p>
<h3 id="配置项目属性"><a href="#配置项目属性" class="headerlink" title="配置项目属性"></a>配置项目属性</h3><h4 id="General"><a href="#General" class="headerlink" title="General"></a>General</h4><p>填写项目名称和描述信息。</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/009.png"></p>
<h4 id="源码管理"><a href="#源码管理" class="headerlink" title="源码管理"></a>源码管理</h4><p>选择Git，填写源码GIT地址和分支</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/010.jpg"></p>
<h4 id="构建触发器"><a href="#构建触发器" class="headerlink" title="构建触发器"></a>构建触发器</h4><p>选择当gitlab分支发生push动作的时候构建。<code>Build when a change is pushed to GitLab</code>。并填写允许的分支。</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/011.png"></p>
<p>将<code>GitLab CI Service URL</code>填入到gitlab项目中。</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/012.png"></p>
<h4 id="build"><a href="#build" class="headerlink" title="build"></a>build</h4><p>填写需要编译的pom.xml文件，并填写mvn编译命令</p>
<pre><code>clean install -Dmaven.test.skip=true
</code></pre>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/017.jpg"></p>
<h4 id="立即构建"><a href="#立即构建" class="headerlink" title="立即构建"></a>立即构建</h4><p>保存设置，进入刚刚创建的任务，然后执行立即构建来创建工作区。</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/019.jpg"></p>
<p>点击当前编译，可以查看编译信息，如日志：</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/020.jpg"></p>
<p>编译完成后，进入到jenkins的工作目录，可以看到成功创建了workspace目录，并从git上获取了对应的项目代码， 并执行了maven编译。</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/021.jpg"></p>
<p>在jenkins的工作区间页面上也能看到项目文件</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/022.jpg"></p>
<p>到目前为止，我们只完成了在指定分支上push代码的时候，自动获取并编译项目的步骤。接下来我们配置自动部署编译好的文件到指定目标服务器。</p>
<h3 id="自动部署"><a href="#自动部署" class="headerlink" title="自动部署"></a>自动部署</h3><p>如何让jenkins实现自动部署呢？这里提供我的思路：</p>
<p>让jenkins在编译成功后，执行shell脚本，将工作目录下的编译好的包扔到目标服务器上，然后运行。</p>
<h4 id="设置任务Post-Steps"><a href="#设置任务Post-Steps" class="headerlink" title="设置任务Post Steps"></a>设置任务Post Steps</h4><p>选择当编译成功的时候执行Shell脚本</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/018.jpg"></p>
<p>这里我们执行编写的deploy.bash 脚本</p>
<pre><code>bash deploy.bash koala
</code></pre>
<h4 id="编写运行脚本"><a href="#编写运行脚本" class="headerlink" title="编写运行脚本"></a>编写运行脚本</h4><p>下面是我自己写的执行脚本，主要功能是从config.json中读取配置信息，将编译好的包扔到指定服务器，并传送一个执行脚本到该服务器，执行该脚本，完成自动部署流程。</p>
<blockquote>
<p>因为是用json做的配置文件，这里用jq作为json解析器</p>
</blockquote>
<p>安装jq</p>
<pre><code>apt-get install jq
</code></pre>
<p>下面是config.sh配置文件</p>
<pre><code>[
 &#123;
   &quot;name&quot;: &quot;koala-meta&quot;,
   &quot;version&quot;: &quot;v1&quot;,
   &quot;path&quot;: &quot;koala-meta/koala-meta-service&quot;,
   &quot;deploys&quot;: [
   &#123;
   &quot;ip&quot;: &quot;10.172.167.0&quot;,
   &quot;port&quot;: &quot;8085&quot;,
   &quot;dpath&quot;: &quot;/home/ubuntu/apps/koala&quot;
   &#125;,
   &#123;
   &quot;ip&quot;: &quot;10.172.167.0&quot;,
   &quot;port&quot;: &quot;8086&quot;,
   &quot;dpath&quot;: &quot;/home/ubuntu/apps/koala&quot;
   &#125;
  ]
 &#125;
]
</code></pre>
<p>下面是deploy.sh 脚本</p>
<pre><code>#!/bin/bash
#定义配置文件
JENKINSPACE=/home/ubuntu/.jenkins/workspace
BASH_PATH=/home/ubuntu/.jenkins/workspace/publish.sh
PROJECTNAME=$1
CONFIG_FILE=$&#123;JENKINSPACE&#125;/$&#123;PROJECTNAME&#125;/config.json
INDEX=0
for NAME in `cat $CONFIG_FILE | jq -r .[].name` ; do
 VERSION=`cat $CONFIG_FILE | jq -r .[$INDEX].version`
 FPATH=`cat $CONFIG_FILE | jq -r .[$INDEX].path`
 echo &quot;MODULE : $NAME  $VERSION $FPATH&quot;
 D_INDEX=0
 for IP in `cat $CONFIG_FILE | jq -r .[$INDEX].deploys[].ip` ; do
  PORT=`cat $CONFIG_FILE | jq -r .[$INDEX].deploys[$D_INDEX].port`
  DPATH=`cat $CONFIG_FILE | jq -r .[$INDEX].deploys[$D_INDEX].dpath`
  ((D_INDEX++))
  echo &quot;IP is $IP PORT is $PORT dpath is $DPATH&quot;
  #创建目标服务器目录
  ssh -t -t -p 1022 $IP &quot;mkdir -p $DPATH&quot;
  #将文件scp到目标服务器
  scp -P 1022 $&#123;JENKINSPACE&#125;/$&#123;PROJECTNAME&#125;/$&#123;FPATH&#125;/target/*.zip $&#123;IP&#125;:$&#123;DPATH&#125;/$&#123;NAME&#125;_$&#123;VERSION&#125;_$&#123;PORT&#125;.zip
  scp -P 1022 $&#123;BASH_PATH&#125; $&#123;IP&#125;:$&#123;DPATH&#125;/.
  ssh -t -t -p 1022 $IP &quot;bash $DPATH/publish.sh $PORT $&#123;DPATH&#125;/$&#123;NAME&#125;_$&#123;VERSION&#125;_$&#123;PORT&#125; $&#123;DPATH&#125;/$&#123;NAME&#125;_$&#123;VERSION&#125;_$&#123;PORT&#125;.zip&quot;
  done
 ((INDEX++))
done
#结束退出
exit
</code></pre>
<p>下面是publish.sh脚本</p>
<pre><code>#!/bin/bash
PORT=$1
FILEPATH=$2
ZIPPATH=$3
function killByPort()&#123;
 for kpid in `sudo lsof -t -i:$&#123;PORT&#125;` ; do
 echo &quot;THE PID IS $kpid&quot;
 kill $kpid
 done
&#125;
function readandreplace()&#123;
 compstr=$1
 replacestr=$2
 filepath=$3
 filebakpath=$filepath&quot;_bak&quot;
 mv $filepath $filebakpath
 while read LINE
 do
  echo &quot;READ LINE INFO : $LINE&quot;
  case &quot;$LINE&quot; in
   &quot;$compstr&quot;* ) LINE=$compstr&quot;=&quot;$replacestr
   ;;
  esac
 echo $LINE &gt;&gt; $filepath
 done &lt; $filebakpath
&#125;
killByPort
rm -rf $2
unzip -o -d $2 $3
readandreplace server.port $PORT $&#123;FILEPATH&#125;/conf/bootstrap.properties
readandreplace port $PORT $&#123;FILEPATH&#125;/conf/appinfo.properties
pwd
cd $&#123;FILEPATH&#125;
pwd
nohup bash start.sh
exit
</code></pre>
<p>下面是start.sh 执行文件</p>
<pre><code>#!/bin/sh
source config.sh
nohup java $JAVA_OPTS  $AGENT_OPTS -cp $classpath com.mlog.koala.meta.MetaStationApplication  &gt;&gt;out.log &amp;
pid=$!
echo $pid&gt;koala.pid
</code></pre>
<p>下面是config.sh 执行文件</p>
<pre><code>#!/bin/sh
classpath=&quot;./conf&quot;
for file in lib/*.jar
do
  if [[ ! -f &quot;$file&quot; ]]
  then
      continue
  fi
  classpath=&quot;$classpath:$file&quot;
done
JAVA_OPTS=&quot;-Duser.timezone=GMT+08&quot;
AGENT_OPTS=&quot;&quot;
if [ -f lib/sharelibs-health*.jar ];then
    healthAgent=`ls -lrt lib/sharelibs-health-*.jar |awk -F&quot; &quot; &#39;&#123;print $NF&#125;&#39;`
    AGENT_OPTS=&quot;$AGENT_OPTS  -javaagent:$healthAgent&quot;
fi

if [ -f lib/mlog-log*.jar ];then
    logAgent=`ls -lrt lib/mlog-log*.jar |awk -F&quot; &quot; &#39;&#123;print $NF&#125;&#39;`
    AGENT_OPTS=&quot;$AGENT_OPTS  -javaagent:$logAgent=catch_error=true&quot;
fi
export AGENT_OPTS
export classpath
export JAVA_OPTS
echo $AGENT_OPTS
</code></pre>
<h4 id="设置jenkins服务器到目标服务器的免密登录"><a href="#设置jenkins服务器到目标服务器的免密登录" class="headerlink" title="设置jenkins服务器到目标服务器的免密登录"></a>设置jenkins服务器到目标服务器的免密登录</h4><p>生成ssh key</p>
<pre><code>ssh-keygen -t rsa -f jenkins_rsa
</code></pre>
<p>将公钥scp到目标服务器</p>
<pre><code>scp -p 22 ~/.ssh/jenkins_rsa.pub 10.172.167.0:~/.ssh/.
</code></pre>
<p>配置config文件</p>
<pre><code>Host 10.172.167.0
     IdentityFile ~/.ssh/jenkins_rsa
</code></pre>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>将脚本放到jenkins目录下。</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/023.jpg"></p>
<p>在koala项目下，进行一次代码提交。</p>
<h5 id="在非发布分支下提交"><a href="#在非发布分支下提交" class="headerlink" title="在非发布分支下提交"></a>在非发布分支下提交</h5><p>在luming分支下做代码提交</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/024.jpg"></p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/025.jpg"></p>
<p>进入jenkins的koala任务页面，可以看到jenkins并没有反应。</p>
<p>切换到testpub分支，重复一遍上述步骤</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/026.jpg"></p>
<p>然后在jenkins上看到了我们想要的结果</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/027.jpg"></p>
<p>进入部署服务器，确认一下部署结果</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/028.jpg"></p>
<h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><h4 id="jenkins执行Shell脚本结束后，显示执行失败如果解决？"><a href="#jenkins执行Shell脚本结束后，显示执行失败如果解决？" class="headerlink" title="jenkins执行Shell脚本结束后，显示执行失败如果解决？"></a>jenkins执行Shell脚本结束后，显示执行失败如果解决？</h4><p>在最末尾加上</p>
<pre><code>echo commonder quit!
</code></pre>
<p>修改 设置任务Post Steps</p>
<p>选择当编译成功的时候执行Shell脚本</p>
<p><img src="https://luminghub.github.io/images/imgs/jenkins/018.jpg"></p>
<p>这里我们执行编写的deploy.bash 脚本</p>
<pre><code>bash /home/ubuntu/.jenkins/workspace/deploy.bash koala
</code></pre>
<p>调整为</p>
<pre><code>#!/bin/bash
bash /home/ubuntu/.jenkins/workspace/deploy.sh koala 
echo commonder quit!
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/29/Jenkins/" data-id="cllui4qyo0007q0ja42u7457q" data-title="Jenkins" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-sudo权限配置" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/27/sudo%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE/" class="article-date">
  <time class="dt-published" datetime="2017-05-26T16:00:00.000Z" itemprop="datePublished">2017-05-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/27/sudo%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE/">sudo权限配置</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>使用root用户登录，创建目标用户，例如创建test用户：</p>
<pre><code>useradd test
</code></pre>
<p>为用户创建密码</p>
<pre><code>passwd test
</code></pre>
<h3 id="将用户添加到sudo用户权限组"><a href="#将用户添加到sudo用户权限组" class="headerlink" title="将用户添加到sudo用户权限组"></a>将用户添加到sudo用户权限组</h3><p>进入 <code>/etc/sudoers.d</code> 目录。</p>
<p>在该目录下创建任意一个文本文件：</p>
<pre><code>vim testsudo
</code></pre>
<p>输入下列信息，格式为 <code>username ALL=(ALL:ALL) ALL</code></p>
<pre><code>test ALL=(ALL:ALL) ALL
</code></pre>
<h3 id="免密设置"><a href="#免密设置" class="headerlink" title="免密设置"></a>免密设置</h3><p>将 ALL&#x3D;(ALL:ALL) ALL 修改成 ALL&#x3D;(ALL:ALL) NOPASSWD ALL</p>
<pre><code>test ALL=(ALL:ALL) NOPASSWD ALL
</code></pre>
<blockquote>
<p>检验sudo不要密码时，要重新登录一下，因为sudo的有效时间大概为5分钟左右。<br>配置sudo也就有了root权限，需要注意安全</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/27/sudo%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE/" data-id="cllui4qz5003kq0ja40pjeyrq" data-title="sudo权限配置" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Shell处理Json" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/26/Shell%E5%A4%84%E7%90%86Json/" class="article-date">
  <time class="dt-published" datetime="2017-05-25T16:00:00.000Z" itemprop="datePublished">2017-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/26/Shell%E5%A4%84%E7%90%86Json/">Shell处理Json</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="jq安装"><a href="#jq安装" class="headerlink" title="jq安装"></a>jq安装</h2><pre><code>apt-get install jq
</code></pre>
<h2 id="jq命令格式"><a href="#jq命令格式" class="headerlink" title="jq命令格式"></a>jq命令格式</h2><pre><code>jq [options] filter [files]
**options：**
--version：输出jq的版本信息并退出
--slurp/-s：读入整个输入流到一个数组。
--raw-input/-R：不作为JSON解析，将每一行的文本作为字符串输出到屏幕。
--null-input/ -n：不读取任何输入，过滤器运行使用null作为输入。一般用作从头构建JSON数据。
--compact-output /-c：使输出紧凑，而不是把每一个JSON对象输出在一行。
--colour-output / -C：打开颜色显示
--monochrome-output / -M：关闭颜色显示

--ascii-output /-a：指定输出格式为ASCII

-raw-output /-r ：如果过滤的结果是一个字符串，那么直接写到标准输出（去掉字符串的引号）

**filter：**
.   : 默认输出
.foo: 输出指定属性，foo代表属性。
.[foo] ：输出指定数组元素。foo代表数组下标。
.[]：输出指定数组中全部元素
， ：指定多个属性作为过滤条件时，用逗号分隔
| ： 将指定的数组元素中的某个属性作为过滤条件

**files：**
    JOSN格式文件。
</code></pre>
<h2 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h2><p>假设存在json.txt文件，且内容为：</p>
<pre><code>cat json.txt 
&#123;&quot;name&quot;:&quot;Google&quot;,&quot;location&quot;:&#123;&quot;street&quot;:&quot;1600 Amphitheatre Parkway&quot;,&quot;city&quot;:&quot;Mountain View&quot;,&quot;state&quot;:&quot;California&quot;,&quot;country&quot;:&quot;US&quot;&#125;,&quot;employees&quot;:[&#123;&quot;name&quot;:&quot;Michael&quot;,&quot;division&quot;:&quot;Engineering&quot;&#125;,&#123;&quot;name&quot;:&quot;Laura&quot;,&quot;division&quot;:&quot;HR&quot;&#125;,&#123;&quot;name&quot;:&quot;Elise&quot;,&quot;division&quot;:&quot;Marketing&quot;&#125;]&#125;
</code></pre>
<h3 id="格式化json"><a href="#格式化json" class="headerlink" title="格式化json"></a>格式化json</h3><pre><code>cat json.txt | jq .
</code></pre>
<h3 id="根据key获取value"><a href="#根据key获取value" class="headerlink" title="根据key获取value"></a>根据key获取value</h3><pre><code>jq .key
</code></pre>
<p>如果没有对应属性则返回null。</p>
<p>获取 name</p>
<pre><code>cat json.txt | jq .name
cat json.txt | jq -r .name
</code></pre>
<p>嵌套获取</p>
<pre><code>cat json.txt | jq .location.state
</code></pre>
<p>获取数组</p>
<pre><code>cat json.txt | jq .employees[1].name
</code></pre>
<h3 id="内建函数"><a href="#内建函数" class="headerlink" title="内建函数"></a>内建函数</h3><p>keys：获取json中的key元素</p>
<pre><code>cat json.txt | jq keys	
</code></pre>
<p>has：判断是否存在某个key</p>
<pre><code>cat json.txt | jq &#39;has(&quot;name&quot;)&#39;
</code></pre>
<p><a target="_blank" rel="noopener" href="https://stedolan.github.io/jq/manual/">更多有用信息</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/26/Shell%E5%A4%84%E7%90%86Json/" data-id="cllui4qyq000cq0ja3v8t70bh" data-title="Shell处理Json" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Ubuntu免密登录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/26/Ubuntu%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2017-05-25T16:00:00.000Z" itemprop="datePublished">2017-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/26/Ubuntu%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/">SSH免密登录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>使用证书来管理连接至少有如下两个好处</p>
<ul>
<li><p>安全，目前生成证书的方式不管是RSA还是DSA无论从位数上还是加密方式上都比自己生成的密码安全许多。</p>
</li>
<li><p>方便，有了证书以后你就不用再记忆密码了，系统会自动使用证书跟服务器接驳，这一过程不需要人工干预</p>
</li>
</ul>
<p>使用证书连接ssh也非常简单，首先你得生成一个证书，在shell中输入如下命令</p>
<pre><code>ssh-keygen -t rsa -C joyqi -f my-key-file
</code></pre>
<ul>
<li><p>-t 定义的是加密方式，一般有rsa和dsa两种</p>
</li>
<li><p>-C 定义的是注释，一般也可以不写</p>
</li>
<li><p>-f 定义了输出的证书文件名，不需要写后缀，因为生成的证书包含了公钥和私钥两个文件，它会自动帮你加文件名</p>
</li>
</ul>
<p>我们执行后可以看到如下结果</p>
<pre><code>$ ssh-keygen -t rsa -C joyqi -f my-key-file
Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in my-key-file.
Your public key has been saved in my-key-file.pub.
The key fingerprint is:
57:75:20:37:e2:53:29:ef:86:09:8e:1b:47:2b:6f:88 joyqi
The key&#39;s randomart image is:
+--[ RSA 2048]----+
|            o *o.|
|           ..*.o |
|            +o   |
|          o. ..  |
|        S+.o +   |
|        +.+ o o  |
|       . B   .   |
|      E o o      |
|         .       |
+-----------------+
$ ls
my-key-file     my-key-file.pub
</code></pre>
<p>可以在上面的命令执行完成，我们已经得到两个文件my-key-file和my-key-file.pub。前者就是你的私钥，是由你自己个人保存的，后者是公钥，你需要把它上传到任何你想用这个私钥来登录的服务器上。</p>
<p>ok，现在你需要把公钥文件上传到服务器上，一般我建议用scp命令</p>
<pre><code>scp my-key-file.pub loginname@yourdomain.com:~/.
</code></pre>
<blockquote>
<p>在后面我们都用loginname来特指你自己的登录名，用yourdomain.com来特指你的服务器地址，请自行脑补</p>
</blockquote>
<p>将文件拷贝到.ssh目录下（确认已经安装ssh），目录下是否存在一个名为“authorized_keys”的文件，<br>若不存在，创建一个空文件，</p>
<pre><code>touch authorized_keys 
</code></pre>
<p>然后将公钥信息写入该文件</p>
<pre><code>cat my-key-file.pub &gt;&gt; authorized_keys
</code></pre>
<p>为了安全起见，将authorized_keys文件权限修改为600。</p>
<pre><code>chmod 600  authorized_keys
</code></pre>
<p>现在我们还要告诉本机，连接yourdomain.com的时候使用my-key-file这个私钥来登录</p>
<p>退出ssh连接，回到本地。将刚才生成的my-key-file文件拷贝到~&#x2F;.ssh目录下</p>
<pre><code>cp my-key-file ~/.ssh/
</code></pre>
<p>然后编辑~&#x2F;.ssh&#x2F;config文件，如果没有，就创建一个，在其中写入如下配置内容</p>
<pre><code>Host yourdomain.com
 IdentityFile ~/.ssh/my-key-file
</code></pre>
<blockquote>
<p>可以替换成目标机器IP</p>
</blockquote>
<p>很简单吧，一看就懂，根据你的需要自行修改。最后还有一步，别忘了将本地缓存的公钥文件删掉，因为那是你以前没有上传公钥时，缓存的服务器默认公钥，现在你用了自己生成的公钥就得把这个老的记录删掉</p>
<p>打开~&#x2F;.ssh&#x2F;known_hosts文件，找到包含yourdomain.com的那一行，将它删掉，然后保存退出</p>
<p>现在，你就可以正常登录服务器了，输入ssh <a href="mailto:&#x6c;&#x6f;&#x67;&#x69;&#110;&#110;&#x61;&#x6d;&#101;&#x40;&#x79;&#x6f;&#x75;&#x72;&#x64;&#111;&#109;&#x61;&#105;&#110;&#46;&#99;&#111;&#109;">&#x6c;&#x6f;&#x67;&#x69;&#110;&#110;&#x61;&#x6d;&#101;&#x40;&#x79;&#x6f;&#x75;&#x72;&#x64;&#111;&#109;&#x61;&#105;&#110;&#46;&#99;&#111;&#109;</a>，第一次登录会出现</p>
<pre><code>The authenticity of host &#39;yourdomain.com (xxx.xxx.xxx.xxx)&#39; can&#39;t be established.
RSA key fingerprint is xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx.
Are you sure you want to continue connecting (yes/no)?
</code></pre>
<p>这是因为你刚才把公钥删掉了，系统在连接本地没有缓存公钥的服务器时会询问下你，输入yes即可，然后你没输入密码就登入了服务器。怎么样，是不是很方便。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/26/Ubuntu%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/" data-id="cllui4qyw0019q0ja82z2ar2w" data-title="SSH免密登录" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Tomcat配置编码集" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/05/25/Tomcat%E9%85%8D%E7%BD%AE%E7%BC%96%E7%A0%81%E9%9B%86/" class="article-date">
  <time class="dt-published" datetime="2017-05-24T16:00:00.000Z" itemprop="datePublished">2017-05-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study/">Study</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/05/25/Tomcat%E9%85%8D%E7%BD%AE%E7%BC%96%E7%A0%81%E9%9B%86/">Tomcat配置编码集</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="设置系统默认文件编码"><a href="#设置系统默认文件编码" class="headerlink" title="设置系统默认文件编码"></a>设置系统默认文件编码</h2><p>file.encoding跟操作系统默认字符集有关，Windows下默认的是gbk，但我们程序一般IO流中字符编码一般都设置的是utf-8，这样会导致中文乱码。因此需要修改file.encoding为utf-8。</p>
<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>  修改catalina.bat</p>
<p>tomcat7以下:</p>
<pre><code>set JAVA_OPTS=%JAVA_OPTS% %LOGGING_CONFIG%的后面加上 -Dfile.encoding=&quot;UTF-8&quot;
</code></pre>
<p>tomcat7:</p>
<pre><code>set &quot;JAVA_OPTS=%JAVA_OPTS% %LOGGING_CONFIG% -Dfile.encoding=UTF-8&quot;
</code></pre>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>  修改catalina.sh </p>
<pre><code>JAVA_OPTS=&quot;-Dfile.encoding=UTF-8&quot;
</code></pre>
<h2 id="设置tomcat编码方式"><a href="#设置tomcat编码方式" class="headerlink" title="设置tomcat编码方式"></a>设置tomcat编码方式</h2><p>默认情况下，tomcat使用的的编码方式：iso8859-1，修改tomcat下的conf&#x2F;server.xml文件，找到如下代码：    </p>
<pre><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt;
</code></pre>
<p>这段代码规定了Tomcat监听HTTP请求的端口号等信息。<br>可以在这里添加一个属性：URIEncoding，将该属性值设置为UTF-8，即可让Tomcat（默认ISO-8859-1编码）以UTF-8的编码处理get请求。<br>修改完成后：</p>
<pre><code>&lt;Connector port=&quot;8080&quot;  protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; URIEncoding=&quot;UTF-8&quot; /&gt;
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/05/25/Tomcat%E9%85%8D%E7%BD%AE%E7%BC%96%E7%A0%81%E9%9B%86/" data-id="cllui4qys000mq0jacobkb8rs" data-title="Tomcat配置编码集" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Study/">Study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/improve/">improve</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/technical-article/">technical article</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECS/" rel="tag">ECS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GIT/" rel="tag">GIT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JAVA/" rel="tag">JAVA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jenkins/" rel="tag">Jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Snappy/" rel="tag">Snappy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring-Cloud/" rel="tag">Spring Cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cassandra/" rel="tag">cassandra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/commons-math3/" rel="tag">commons-math3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gRPC/" rel="tag">gRPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/goreplay/" rel="tag">goreplay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/" rel="tag">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/" rel="tag">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ossutil/" rel="tag">ossutil</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postgresql/" rel="tag">postgresql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/protobuf/" rel="tag">protobuf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swagger/" rel="tag">swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC/" rel="tag">软件架构师的12项修炼</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ECS/" style="font-size: 10px;">ECS</a> <a href="/tags/GIT/" style="font-size: 17.5px;">GIT</a> <a href="/tags/JAVA/" style="font-size: 20px;">JAVA</a> <a href="/tags/Jenkins/" style="font-size: 10px;">Jenkins</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Redis/" style="font-size: 12.5px;">Redis</a> <a href="/tags/Snappy/" style="font-size: 10px;">Snappy</a> <a href="/tags/Spring-Cloud/" style="font-size: 10px;">Spring Cloud</a> <a href="/tags/Tomcat/" style="font-size: 12.5px;">Tomcat</a> <a href="/tags/cassandra/" style="font-size: 12.5px;">cassandra</a> <a href="/tags/commons-math3/" style="font-size: 10px;">commons-math3</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/gRPC/" style="font-size: 10px;">gRPC</a> <a href="/tags/goreplay/" style="font-size: 10px;">goreplay</a> <a href="/tags/gradle/" style="font-size: 10px;">gradle</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/mongodb/" style="font-size: 15px;">mongodb</a> <a href="/tags/mybatis/" style="font-size: 10px;">mybatis</a> <a href="/tags/ossutil/" style="font-size: 10px;">ossutil</a> <a href="/tags/postgresql/" style="font-size: 12.5px;">postgresql</a> <a href="/tags/protobuf/" style="font-size: 10px;">protobuf</a> <a href="/tags/spring/" style="font-size: 12.5px;">spring</a> <a href="/tags/swagger/" style="font-size: 10px;">swagger</a> <a href="/tags/%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%8412%E9%A1%B9%E4%BF%AE%E7%82%BC/" style="font-size: 15px;">软件架构师的12项修炼</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/08/28/docker%E9%83%A8%E7%BD%B2java%E7%A8%8B%E5%BA%8F%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/">docker部署java程序基本命令</a>
          </li>
        
          <li>
            <a href="/2019/11/21/Springboot%E8%BF%94%E5%9B%9Ejson%E5%92%8Cxml%E8%A7%86%E5%9B%BE/">Springboot返回json和xml视图</a>
          </li>
        
          <li>
            <a href="/2018/04/27/git%E6%B8%85%E7%90%86commits%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95/">Git 清理commits历史记录</a>
          </li>
        
          <li>
            <a href="/2018/04/17/access%E6%97%A5%E5%BF%97%E8%87%AA%E5%8A%A8%E4%B8%8A%E4%BC%A0OSS%E5%BD%92%E6%A1%A3/">access日志通过OSSutil自动上传OSS归档</a>
          </li>
        
          <li>
            <a href="/2018/01/11/postgis%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/">postgis常用函数</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>